<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Introduce Null Object</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Introduce Null Object</h1>
<blockquote>原文：<a href="https://refactoringguru.cn/introduce-null-object">https://refactoringguru.cn/introduce-null-object</a></blockquote>
    
    

    <script type="text/javascript">
        // Shorten examples titles for users.
        var h1 = document.getElementsByTagName("H1")[0];
        if (h1.offsetHeight &amp;gt; 160) {
            h1.className += ' smaller';
        }

        // Small beautification for pattern examples.
        var title = h1.innerHTML;
        title = title.replace(/^(Java|C\+\+|C#|PHP|Python|Ruby|Delphi): (.*)$/, '&amp;lt;strong&amp;gt;$1:&amp;lt;/strong&amp;gt; $2');
        h1.innerHTML = title;
    </script>

    
    

    <div class="before-after-container">
        <div class="before">
            <h3>Problem</h3>
            <p>Since some methods return <code>null</code> instead of real objects, you have many checks for <code>null</code> in your code.</p>

        </div>
        <div class="after">
            <h3>Solution</h3>
            <p>Instead of <code>null</code>, return a null object that exhibits the default behavior.</p>

        </div>
    </div>

        <div class="examples">
                    <div class="before-after before-after-container java" data-lang="java">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="java">if (customer == null) {
  plan = BillingPlan.basic();
}
else {
  plan = customer.getPlan();
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="java">class NullCustomer extends Customer {
  boolean isNull() {
    return true;
  }
  Plan getPlan() {
    return new NullPlan();
  }
  // Some other NULL functionality.
}

// Replace null values with Null-object.
customer = (order.customer != null) ?
  order.customer : new NullCustomer();

// Use Null-object as if it's normal subclass.
plan = customer.getPlan();</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container csharp" data-lang="csharp">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="csharp">if (customer == null) 
{
  plan = BillingPlan.Basic();
}
else 
{
  plan = customer.GetPlan();
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="csharp">public sealed class NullCustomer: Customer 
{
  public override bool IsNull 
  {
    get { return true; }
  }
  
  public override Plan GetPlan() 
  {
    return new NullPlan();
  }
  // Some other NULL functionality.
}

// Replace null values with Null-object.
customer = order.customer ?? new NullCustomer();

// Use Null-object as if it's normal subclass.
plan = customer.GetPlan();</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container php" data-lang="php">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="php">if ($customer === null) {
  $plan = BillingPlan::basic();
} else {
  $plan = $customer-&gt;getPlan();
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="php">class NullCustomer extends Customer {
  public function isNull() {
    return true;
  }
  public function getPlan() {
    return new NullPlan();
  }
  // Some other NULL functionality.
}

// Replace null values with Null-object.
$customer = ($order-&gt;customer !== null) ?
  $order-&gt;customer :
  new NullCustomer;

// Use Null-object as if it's normal subclass.
$plan = $customer-&gt;getPlan();</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container python" data-lang="python">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="python">if customer is None:
    plan = BillingPlan.basic()
else:
    plan = customer.getPlan()</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="python">class NullCustomer(Customer):

    def isNull(self):
        return True

    def getPlan(self):
        return self.NullPlan()

    # Some other NULL functionality.

# Replace null values with Null-object.
customer = order.customer or NullCustomer()

# Use Null-object as if it's normal subclass.
plan = customer.getPlan()</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container typescript" data-lang="typescript">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="typescript">if (customer == null) {
  plan = BillingPlan.basic();
}
else {
  plan = customer.getPlan();
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="typescript">class NullCustomer extends Customer {
  isNull(): boolean {
    return true;
  }
  getPlan(): Plan {
    return new NullPlan();
  }
  // Some other NULL functionality.
}

// Replace null values with Null-object.
let customer = (order.customer != null) ?
  order.customer : new NullCustomer();

// Use Null-object as if it's normal subclass.
plan = customer.getPlan();</pre>
                                    </div>
            </div>
            </div>
    
    <h3>Why Refactor</h3>
<p>Dozens of checks for <code>null</code> make your code longer and uglier.</p>
<h3>Drawbacks</h3>
<ul>
<li>The price of getting rid of conditionals is creating yet another new class.</li>
</ul>
<h3>How to Refactor</h3>
<ol>
<li>
<p>From the class in question, create a subclass that will perform the role of null object.</p>
</li>
<li>
<p>In both classes, create the method <code>isNull()</code>, which will return <code>true</code> for a null object and <code>false</code> for a real class.</p>
</li>
<li>
<p>Find all places where the code may return <code>null</code> instead of a real object. Change the code so that it returns a null object.</p>
</li>
<li>
<p>Find all places where the variables of the real class are compared with <code>null</code>. Replace these checks with a call for <code>isNull()</code>.</p>
</li>
<li>
<ul><li>If methods of the original class are run in these conditionals when a value doesn't equal <code>null</code>, redefine these methods in the null class and insert the code from the <code>else</code> part of the condition there. Then you can delete the entire conditional and differing behavior will be implemented via polymorphism.</li><li>If things aren't so simple and the methods can't be redefined, see if you can simply extract the operators that were supposed to be performed in the case of a <code>null</code> value to new methods of the null object. Call these methods instead of the old code in <code>else</code> as the operations by default.</li></ul>
</li>
</ol>


    <div class="prom banner-content banner banner-striped banner-with-image" data-id="Ref: Part of the ebook" data-creative-id="animated-en" data-position="content_bottom">
        <div class="banner-image">
            <a href="/refactoring/course">
                <video id="banner-zzz" loop="" muted="" playsinline="" width="200" height="200">
                    <source src="/images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56" type="video/mp4">
                    <source src="/images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4" type="image/png">
                    Your browser does not support HTML video.
                </source></source></video>
            </a>
        </div>
        <script>
            if (/CPU (?:iPhone )?OS [1-9]_/.test(navigator.userAgent)) {
                // Don't autoplay on old iOS, since it doesn not support playsinline.
            }
            else {
                document.getElementById('banner-zzz').play();
            }
        </script>

        <div class="banner-text">
            <h3 class="title">Tired of reading?</h3>
            <p class="big">No wonder, it takes <span class="blue">7 hours</span> to read all of the text we have here.</p>
            <p>Try our interactive course on refactoring. It offers a less tedious approach to learning new stuff.</p>
            <a class="btn btn-secondary" href="/refactoring/course"><i class="fa fa-star" aria-hidden="true"/> Let's see…</a>
        </div>
    </div>


        
</body>
</html>