<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Replace Temp with Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Replace Temp with Query</h1>
<blockquote>原文：<a href="https://refactoringguru.cn/replace-temp-with-query">https://refactoringguru.cn/replace-temp-with-query</a></blockquote>
    
    

    <script type="text/javascript">
        // Shorten examples titles for users.
        var h1 = document.getElementsByTagName("H1")[0];
        if (h1.offsetHeight &amp;gt; 160) {
            h1.className += ' smaller';
        }

        // Small beautification for pattern examples.
        var title = h1.innerHTML;
        title = title.replace(/^(Java|C\+\+|C#|PHP|Python|Ruby|Delphi): (.*)$/, '&amp;lt;strong&amp;gt;$1:&amp;lt;/strong&amp;gt; $2');
        h1.innerHTML = title;
    </script>

    
    

    <div class="before-after-container">
        <div class="before">
            <h3>Problem</h3>
            <p>You place the result of an expression in a local variable for later use in your code.</p>

        </div>
        <div class="after">
            <h3>Solution</h3>
            <p>Move the entire expression to a separate method and return the result from it. Query the method instead of using a variable. Incorporate the new method in other methods, if necessary.</p>

        </div>
    </div>

        <div class="examples">
                    <div class="before-after before-after-container java" data-lang="java">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="java">double calculateTotal() {
  double basePrice = quantity * itemPrice;
  if (basePrice &gt; 1000) {
    return basePrice * 0.95;
  }
  else {
    return basePrice * 0.98;
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="java">double calculateTotal() {
  if (basePrice() &gt; 1000) {
    return basePrice() * 0.95;
  }
  else {
    return basePrice() * 0.98;
  }
}
double basePrice() {
  return quantity * itemPrice;
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container csharp" data-lang="csharp">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="csharp">double CalculateTotal() 
{
  double basePrice = quantity * itemPrice;
  
  if (basePrice &gt; 1000) 
  {
    return basePrice * 0.95;
  }
  else 
  {
    return basePrice * 0.98;
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="csharp">double CalculateTotal() 
{
  if (BasePrice() &gt; 1000) 
  {
    return BasePrice() * 0.95;
  }
  else 
  {
    return BasePrice() * 0.98;
  }
}
double BasePrice() 
{
  return quantity * itemPrice;
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container php" data-lang="php">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="php">$basePrice = $this-&gt;quantity * $this-&gt;itemPrice;
if ($basePrice &gt; 1000) {
  return $basePrice * 0.95;
} else {
  return $basePrice * 0.98;
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="php">if ($this-&gt;basePrice() &gt; 1000) {
  return $this-&gt;basePrice() * 0.95;
} else {
  return $this-&gt;basePrice() * 0.98;
}

...

function basePrice() {
  return $this-&gt;quantity * $this-&gt;itemPrice;
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container python" data-lang="python">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="python">def calculateTotal():
    basePrice = quantity * itemPrice
    if basePrice &gt; 1000:
        return basePrice * 0.95
    else:
        return basePrice * 0.98</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="python">def calculateTotal():
    if basePrice() &gt; 1000:
        return basePrice() * 0.95
    else:
        return basePrice() * 0.98

def basePrice():
    return quantity * itemPrice</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container typescript" data-lang="typescript">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="typescript"> calculateTotal(): number {
  let basePrice = quantity * itemPrice;
  if (basePrice &gt; 1000) {
    return basePrice * 0.95;
  }
  else {
    return basePrice * 0.98;
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="typescript">calculateTotal(): number {
  if (basePrice() &gt; 1000) {
    return basePrice() * 0.95;
  }
  else {
    return basePrice() * 0.98;
  }
}
basePrice(): number {
  return quantity * itemPrice;
}</pre>
                                    </div>
            </div>
            </div>
    
    <h3>Why Refactor</h3>
<p>This refactoring can lay the groundwork for applying <a href="/extract-method">Extract Method</a> for a portion of a very long method.</p>
<p>The same expression may sometimes be found in other methods as well, which is one reason to consider creating a common method.</p>
<h3>Benefits</h3>
<ul>
<li>
<p>Code readability. It's much easier to understand the purpose of the method <code>getTax()</code> than the line <code>orderPrice() * 0.2</code>.</p>
</li>
<li>
<p>Slimmer code via deduplication, if the line being replaced is used in multiple methods.</p>
</li>
</ul>
<h3>Good to Know</h3>
<h4>Performance</h4>
<p>This refactoring may prompt the question of whether this approach is liable to cause a performance hit. The honest answer is: yes, it is, since the resulting code may be burdened by querying a new method. But with today's fast CPUs and excellent compilers, the burden will almost always be minimal. By contrast, readable code and the ability to reuse this method in other places in program code—thanks to this refactoring approach—are very noticeable benefits.</p>
<p>Nonetheless, if your temp variable is used to cache the result of a truly time-consuming expression, you may want to stop this refactoring after extracting the expression to a new method.</p>
<h3>How to Refactor</h3>
<ol>
<li>
<p>Make sure that a value is assigned to the variable once and only once within the method. If not, use <a href="/split-temporary-variable">Split Temporary Variable</a> to ensure that the variable will be used only to store the result of your expression.</p>
</li>
<li>
<p>Use <a href="/extract-method">Extract Method</a> to place the expression of interest in a new method. Make sure that this method only returns a value and doesn't change the state of the object. If the method affects the visible state of the object, use <a href="/separate-query-from-modifier">Separate Query from Modifier</a>.</p>
</li>
<li>
<p>Replace the variable with a query to your new method.</p>
</li>
</ol>


    <div class="prom banner-content banner banner-striped banner-with-image" data-id="Ref: Part of the ebook" data-creative-id="animated-en" data-position="content_bottom">
        <div class="banner-image">
            <a href="/refactoring/course">
                <video id="banner-zzz" loop="" muted="" playsinline="" width="200" height="200">
                    <source src="/images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56" type="video/mp4">
                    <source src="/images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4" type="image/png">
                    Your browser does not support HTML video.
                </source></source></video>
            </a>
        </div>
        <script>
            if (/CPU (?:iPhone )?OS [1-9]_/.test(navigator.userAgent)) {
                // Don't autoplay on old iOS, since it doesn not support playsinline.
            }
            else {
                document.getElementById('banner-zzz').play();
            }
        </script>

        <div class="banner-text">
            <h3 class="title">Tired of reading?</h3>
            <p class="big">No wonder, it takes <span class="blue">7 hours</span> to read all of the text we have here.</p>
            <p>Try our interactive course on refactoring. It offers a less tedious approach to learning new stuff.</p>
            <a class="btn btn-secondary" href="/refactoring/course"><i class="fa fa-star" aria-hidden="true"/> Let's see…</a>
        </div>
    </div>


        
</body>
</html>