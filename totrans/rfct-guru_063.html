<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Duplicate Observed Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Duplicate Observed Data</h1>
<blockquote>原文：<a href="https://refactoringguru.cn/duplicate-observed-data">https://refactoringguru.cn/duplicate-observed-data</a></blockquote>
    
    

    <script type="text/javascript">
        // Shorten examples titles for users.
        var h1 = document.getElementsByTagName("H1")[0];
        if (h1.offsetHeight &amp;gt; 160) {
            h1.className += ' smaller';
        }

        // Small beautification for pattern examples.
        var title = h1.innerHTML;
        title = title.replace(/^(Java|C\+\+|C#|PHP|Python|Ruby|Delphi): (.*)$/, '&amp;lt;strong&amp;gt;$1:&amp;lt;/strong&amp;gt; $2');
        h1.innerHTML = title;
    </script>

    
    

    <div class="before-after-container">
        <div class="before">
            <h3>Problem</h3>
            <p>Is domain data stored in classes responsible for the GUI?</p>

        </div>
        <div class="after">
            <h3>Solution</h3>
            <p>Then it's a good idea to separate the data into separate classes, ensuring connection and synchronization between the domain class and the GUI.</p>

        </div>
    </div>

        <div class="examples">
                    <div class="before-after before-after-container ">
                <div class="before">
                    <div class="ba">Before</div>
                                            <div class="ba-container"><img src="../Images/d474b659b984c093e310fcc415160b12.png" alt="Duplicate Observed Data - Before" width="227" data-original-src="https://refactoringguru.cn/images/refactoring/diagrams/Duplicate Observed Data - Before.png?id=bd26ed6d7d9921504165fd46b7f6124c"/></div>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <div class="ba-container"><img src="../Images/e4d42f7bc1219ac9900b28e6908ee2eb.png" alt="Duplicate Observed Data - After" width="227" data-original-src="https://refactoringguru.cn/images/refactoring/diagrams/Duplicate Observed Data - After.png?id=b86fa0ff2f9ff7c76d4a183607153458"/></div>
                                    </div>
            </div>
            </div>
    
    <h3>Why Refactor</h3>
<p>You want to have multiple interface views for the same data (for example, you have both a desktop app and a mobile app). If you fail to separate the GUI from the domain, you will have a very hard time avoiding code duplication and a large number of mistakes.</p>
<h3>Benefits</h3>
<ul>
<li>
<p>You split responsibility between business logic classes and presentation classes (cf. the <em>Single Responsibility Principle</em>), which makes your program more readable and understandable.</p>
</li>
<li>
<p>If you need to add a new interface view, create new presentation classes; you don't need to touch the code of the business logic (cf. the <em>Open/Closed Principle</em>).</p>
</li>
<li>
<p>Now different people can work on the business logic and the user interfaces.</p>
</li>
</ul>
<h3>When Not to Use</h3>
<ul>
<li>
<p>This refactoring technique, which in its classic form is performed using the <a href="/design-patterns/observer">Observer</a> template, isn't applicable for web apps, where all classes are recreated between queries to the web server.</p>
</li>
<li>
<p>All the same, the general principle of extracting business logic into separate classes can be justified for web apps as well. But this will be implemented using different refactoring techniques depending on how your system is designed.</p>
</li>
</ul>
<h3>How to Refactor</h3>
<ol>
<li>
<p>Hide direct access to domain data in the <em>GUI class</em>. For this, it's best to use <a href="/self-encapsulate-field">Self Encapsulate Field</a>. So you create the getters and setters for this data.</p>
</li>
<li>
<p>In handlers for <em>GUI class</em> events, use setters to set new field values. This will let you pass these values to the associated <em>domain object</em>.</p>
</li>
<li>
<p>Create a domain class and copy necessary fields from the <em>GUI class</em> to it. Create getters and seters for all these fields.</p>
</li>
<li>
<p>Create an Observer pattern for these two classes:</p>
<ul>
<li>
<p>In the <em>domain class</em>, create an array for storing observer objects (<em>GUI objects</em>), as well as methods for registering, deleting and notifying them.</p>
</li>
<li>
<p>In the <em>GUI class</em>, create a field for storing references to the <em>domain class</em> as well as the <code>update()</code> method, which will be reacting to changes in the object and update the values of fields in the <em>GUI class</em>. Note that value updates should be established directly in the method, in order to avoid recursion.</p>
</li>
<li>
<p>In the <em>GUI class</em> constructor, create an instance of <em>domain class</em> and save it in the field you have created. Register the <em>GUI object</em> as an observer in the <em>domain object</em>.</p>
</li>
<li>
<p>In the setters for <em>domain class</em> fields, call the method for notifying the observer (in other words, method for updating in the <em>GUI class</em>), in order to pass the new values to the GUI.</p>
</li>
<li>
<p>Change the setters of the <em>GUI class</em> fields so that they set new values in the domain object directly. Watch out to make sure that values aren't set through a <em>domain class</em> setter—otherwise infinite recursion will result.</p>
</li>
</ul>
</li>
</ol>


    <div class="prom banner-content banner banner-striped banner-with-image" data-id="Ref: Part of the ebook" data-creative-id="animated-en" data-position="content_bottom">
        <div class="banner-image">
            <a href="/refactoring/course">
                <video id="banner-zzz" loop="" muted="" playsinline="" width="200" height="200">
                    <source src="/images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56" type="video/mp4">
                    <source src="/images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4" type="image/png">
                    Your browser does not support HTML video.
                </source></source></video>
            </a>
        </div>
        <script>
            if (/CPU (?:iPhone )?OS [1-9]_/.test(navigator.userAgent)) {
                // Don't autoplay on old iOS, since it doesn not support playsinline.
            }
            else {
                document.getElementById('banner-zzz').play();
            }
        </script>

        <div class="banner-text">
            <h3 class="title">Tired of reading?</h3>
            <p class="big">No wonder, it takes <span class="blue">7 hours</span> to read all of the text we have here.</p>
            <p>Try our interactive course on refactoring. It offers a less tedious approach to learning new stuff.</p>
            <a class="btn btn-secondary" href="/refactoring/course"><i class="fa fa-star" aria-hidden="true"/> Let's see…</a>
        </div>
    </div>


        
</body>
</html>