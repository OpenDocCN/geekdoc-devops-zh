<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Replace Type Code with Class</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Replace Type Code with Class</h1>
<blockquote>原文：<a href="https://refactoringguru.cn/replace-type-code-with-class">https://refactoringguru.cn/replace-type-code-with-class</a></blockquote>
    
    

    <script type="text/javascript">
        // Shorten examples titles for users.
        var h1 = document.getElementsByTagName("H1")[0];
        if (h1.offsetHeight &amp;gt; 160) {
            h1.className += ' smaller';
        }

        // Small beautification for pattern examples.
        var title = h1.innerHTML;
        title = title.replace(/^(Java|C\+\+|C#|PHP|Python|Ruby|Delphi): (.*)$/, '&amp;lt;strong&amp;gt;$1:&amp;lt;/strong&amp;gt; $2');
        h1.innerHTML = title;
    </script>

    
    <blockquote>
<p><strong>What's type code?</strong> Type code occurs when, instead of a separate data type, you have a set of numbers or strings that form a list of allowable values for some entity. Often these specific numbers and strings are given understandable names via constants, which is the reason for why such type code is encountered so much.</p>
</blockquote>


    <div class="before-after-container">
        <div class="before">
            <h3>Problem</h3>
            <p>A class has a field that contains type code. The values of this type aren't used in operator conditions and don't affect the behavior of the program.</p>

        </div>
        <div class="after">
            <h3>Solution</h3>
            <p>Create a new class and use its objects instead of the type code values.</p>

        </div>
    </div>

        <div class="examples">
                    <div class="before-after before-after-container ">
                <div class="before">
                    <div class="ba">Before</div>
                                            <div class="ba-container"><img src="../Images/f2c2339ea0a1ae755cc26fa3e34bc06a.png" alt="Replace Type Code with Class - Before" width="152" data-original-src="https://refactoringguru.cn/images/refactoring/diagrams/Replace Type Code with Class - Before.png?id=1b492169f36a1b9da5bb6d9e6f857f45"/></div>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <div class="ba-container"><img src="../Images/2cea81c57dd8c0ba9a3c2dfce78eda64.png" alt="Replace Type Code with Class - After" width="152" data-original-src="https://refactoringguru.cn/images/refactoring/diagrams/Replace Type Code with Class - After.png?id=c3be25afb117027a6d56cc489d0e7ae6"/></div>
                                    </div>
            </div>
            </div>
    
    <h3>Why Refactor</h3>
<p>One of the most common reasons for type code is working with databases, when a database has fields in which some complex concept is coded with a number or string.</p>
<p>For example, you have the class <code>User</code> with the field <code>user_role</code>, which contains information about the access privileges of each user, whether administrator, editor, or ordinary user. So in this case, this information is coded in the field as <code>A</code>, <code>E</code>, and <code>U</code> respectively.</p>
<p>What are the shortcomings of this approach? The field setters often don't check which value is sent, which can cause big problems when someone sends unintended or wrong values to these fields.</p>
<p>In addition, type verification is impossible for these fields. It's possible to send any number or string to them, which won't be type checked by your IDE and even allow your program to run (and crash later).</p>
<h3>Benefits</h3>
<ul>
<li>
<p>We want to turn sets of primitive values—which is what coded types are—into full-fledged classes with all the benefits that object-oriented programming has to offer.</p>
</li>
<li>
<p>By replacing type code with classes, we allow type hinting for values passed to methods and fields at the level of the programming language.</p>
<p>For example, while the compiler previously didn't see difference between your numeric constant and some arbitrary number when a value is passed to a method, now when data that doesn't fit the indicated type class is passed, you're warned of the error inside your IDE.</p>
</li>
<li>
<p>Thus we make it possible to move code to the classes of the type. If you needed to perform complex manipulations with type values throughout the whole program, now this code can "live" inside one or multiple type classes.</p>
</li>
</ul>
<h3>When Not to Use</h3>
<p>If the values of a coded type are used inside control flow structures (<code>if</code>, <code>switch</code>, etc.) and control a class behavior, you should use one of the two refactoring techniques for type code:</p>
<ul>
<li>
<p><a href="/replace-type-code-with-subclasses">Replace Type Code with Subclasses</a></p>
</li>
<li>
<p><a href="/replace-type-code-with-state-strategy">Replace Type Code with State/Strategy</a></p>
</li>
</ul>
<h3>How to Refactor</h3>
<ol>
<li>
<p>Create a new class and give it a new name that corresponds to the purpose of the coded type. Here we'll call it <em>type class</em>.</p>
</li>
<li>
<p>Copy the field containing type code to the <em>type class</em> and make it private. Then create a getter for the field. A value will be set for this field only from the constructor.</p>
</li>
<li>
<p>For each value of the coded type, create a static method in <em>type class</em>. It'll be creating a new <em>type class</em> object corresponding to this value of the coded type.</p>
</li>
<li>
<p>In the original class, replace the type of the coded field with <em>type class</em>. Create a new object of this type in the constructor as well as in the field setter. Change the field getter so that it calls the <em>type class</em> getter.</p>
</li>
<li>
<p>Replace any mentions of values of the coded type with calls of the relevant <em>type class</em> static methods.</p>
</li>
<li>
<p>Remove the coded type constants from the original class.</p>
</li>
</ol>


    <div class="prom banner-content banner banner-striped banner-with-image" data-id="Ref: Part of the ebook" data-creative-id="animated-en" data-position="content_bottom">
        <div class="banner-image">
            <a href="/refactoring/course">
                <video id="banner-zzz" loop="" muted="" playsinline="" width="200" height="200">
                    <source src="/images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56" type="video/mp4">
                    <source src="/images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4" type="image/png">
                    Your browser does not support HTML video.
                </source></source></video>
            </a>
        </div>
        <script>
            if (/CPU (?:iPhone )?OS [1-9]_/.test(navigator.userAgent)) {
                // Don't autoplay on old iOS, since it doesn not support playsinline.
            }
            else {
                document.getElementById('banner-zzz').play();
            }
        </script>

        <div class="banner-text">
            <h3 class="title">Tired of reading?</h3>
            <p class="big">No wonder, it takes <span class="blue">7 hours</span> to read all of the text we have here.</p>
            <p>Try our interactive course on refactoring. It offers a less tedious approach to learning new stuff.</p>
            <a class="btn btn-secondary" href="/refactoring/course"><i class="fa fa-star" aria-hidden="true"/> Let's see…</a>
        </div>
    </div>


        
</body>
</html>