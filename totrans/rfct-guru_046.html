<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Replace Method with Method Object</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Replace Method with Method Object</h1>
<blockquote>原文：<a href="https://refactoringguru.cn/replace-method-with-method-object">https://refactoringguru.cn/replace-method-with-method-object</a></blockquote>
    
    

    <script type="text/javascript">
        // Shorten examples titles for users.
        var h1 = document.getElementsByTagName("H1")[0];
        if (h1.offsetHeight &amp;gt; 160) {
            h1.className += ' smaller';
        }

        // Small beautification for pattern examples.
        var title = h1.innerHTML;
        title = title.replace(/^(Java|C\+\+|C#|PHP|Python|Ruby|Delphi): (.*)$/, '&amp;lt;strong&amp;gt;$1:&amp;lt;/strong&amp;gt; $2');
        h1.innerHTML = title;
    </script>

    
    

    <div class="before-after-container">
        <div class="before">
            <h3>Problem</h3>
            <p>You have a long method in which the local variables are so intertwined that you can't apply <i>Extract Method</i>.</p>

        </div>
        <div class="after">
            <h3>Solution</h3>
            <p>Transform the method into a separate class so that the local variables become fields of the class. Then you can split the method into several methods within the same class.</p>

        </div>
    </div>

        <div class="examples">
                    <div class="before-after before-after-container java" data-lang="java">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="java">class Order {
  // ...
  public double price() {
    double primaryBasePrice;
    double secondaryBasePrice;
    double tertiaryBasePrice;
    // Perform long computation.
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="java">class Order {
  // ...
  public double price() {
    return new PriceCalculator(this).compute();
  }
}

class PriceCalculator {
  private double primaryBasePrice;
  private double secondaryBasePrice;
  private double tertiaryBasePrice;
  
  public PriceCalculator(Order order) {
    // Copy relevant information from the
    // order object.
  }
  
  public double compute() {
    // Perform long computation.
  }
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container csharp" data-lang="csharp">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="csharp">public class Order 
{
  // ...
  public double Price() 
  {
    double primaryBasePrice;
    double secondaryBasePrice;
    double tertiaryBasePrice;
    // Perform long computation.
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="csharp">public class Order 
{
  // ...
  public double Price() 
  {
    return new PriceCalculator(this).Compute();
  }
}

public class PriceCalculator 
{
  private double primaryBasePrice;
  private double secondaryBasePrice;
  private double tertiaryBasePrice;
  
  public PriceCalculator(Order order) 
  {
    // Copy relevant information from the
    // order object.
  }
  
  public double Compute() 
  {
    // Perform long computation.
  }
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container php" data-lang="php">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="php">class Order {
  // ...
  public function price() {
    $primaryBasePrice = 10;
    $secondaryBasePrice = 20;
    $tertiaryBasePrice = 30;
    // Perform long computation.
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="php">class Order {
  // ...
  public function price() {
    return (new PriceCalculator($this))-&gt;compute();
  }
}

class PriceCalculator {
  private $primaryBasePrice;
  private $secondaryBasePrice;
  private $tertiaryBasePrice;
  
  public function __construct(Order $order) {
      // Copy relevant information from the
      // order object.
  }
  
  public function compute() {
    // Perform long computation.
  }
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container python" data-lang="python">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="python">class Order:
    # ...
    def price(self):
        primaryBasePrice = 0
        secondaryBasePrice = 0
        tertiaryBasePrice = 0
        # Perform long computation.</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="python">class Order:
    # ...
    def price(self):
        return PriceCalculator(self).compute()


class PriceCalculator:
    def __init__(self, order):
        self._primaryBasePrice = 0
        self._secondaryBasePrice = 0
        self._tertiaryBasePrice = 0
        # Copy relevant information from the
        # order object.

    def compute(self):
        # Perform long computation.</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container typescript" data-lang="typescript">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="typescript">class Order {
  // ...
  price(): number {
    let primaryBasePrice;
    let secondaryBasePrice;
    let tertiaryBasePrice;
    // Perform long computation.
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="typescript">class Order {
  // ...
  price(): number {
    return new PriceCalculator(this).compute();
  }
}

class PriceCalculator {
  private _primaryBasePrice: number;
  private _secondaryBasePrice: number;
  private _tertiaryBasePrice: number;
  
  constructor(order: Order) {
    // Copy relevant information from the
    // order object.
  }
  
  compute(): number {
    // Perform long computation.
  }
}</pre>
                                    </div>
            </div>
            </div>
    
    <h3>Why Refactor</h3>
<p>A method is too long and you can't separate it due to tangled masses of local variables that are hard to isolate from each other.</p>
<p>The first step is to isolate the entire method into a separate class and turn its local variables into fields of the class.</p>
<p>Firstly, this allows isolating the problem at the class level. Secondly, it paves the way for splitting a large and unwieldy method into smaller ones that wouldn't fit with the purpose of the original class anyway.</p>
<h3>Benefits</h3>
<ul>
<li>Isolating a long method in its own class allows stopping a method from ballooning in size. This also allows splitting it into submethods within the class, without polluting the original class with utility methods.</li>
</ul>
<h3>Drawbacks</h3>
<ul>
<li>Another class is added, increasing the overall complexity of the program.</li>
</ul>
<h3>How to Refactor</h3>
<ol>
<li>
<p>Create a new class. Name it based on the purpose of the method that you're refactoring.</p>
</li>
<li>
<p>In the new class, create a private field for storing a reference to an instance of the class in which the method was previously located. It could be used to get some required data from the original class if needed.</p>
</li>
<li>
<p>Create a separate private field for each local variable of the method.</p>
</li>
<li>
<p>Create a constructor that accepts as parameters the values of all local variables of the method and also initializes the corresponding private fields.</p>
</li>
<li>
<p>Declare the main method and copy the code of the original method to it, replacing the local variables with private fields.</p>
</li>
<li>
<p>Replace the body of the original method in the original class by creating a method object and calling its main method.</p>
</li>
</ol>


    <div class="prom banner-content banner banner-striped banner-with-image" data-id="Ref: Part of the ebook" data-creative-id="animated-en" data-position="content_bottom">
        <div class="banner-image">
            <a href="/refactoring/course">
                <video id="banner-zzz" loop="" muted="" playsinline="" width="200" height="200">
                    <source src="/images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56" type="video/mp4">
                    <source src="/images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4" type="image/png">
                    Your browser does not support HTML video.
                </source></source></video>
            </a>
        </div>
        <script>
            if (/CPU (?:iPhone )?OS [1-9]_/.test(navigator.userAgent)) {
                // Don't autoplay on old iOS, since it doesn not support playsinline.
            }
            else {
                document.getElementById('banner-zzz').play();
            }
        </script>

        <div class="banner-text">
            <h3 class="title">Tired of reading?</h3>
            <p class="big">No wonder, it takes <span class="blue">7 hours</span> to read all of the text we have here.</p>
            <p>Try our interactive course on refactoring. It offers a less tedious approach to learning new stuff.</p>
            <a class="btn btn-secondary" href="/refactoring/course"><i class="fa fa-star" aria-hidden="true"/> Let's see…</a>
        </div>
    </div>


        
</body>
</html>