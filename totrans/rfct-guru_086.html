<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Separate Query from Modifier</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Separate Query from Modifier</h1>
<blockquote>原文：<a href="https://refactoringguru.cn/separate-query-from-modifier">https://refactoringguru.cn/separate-query-from-modifier</a></blockquote>
    
    

    <script type="text/javascript">
        // Shorten examples titles for users.
        var h1 = document.getElementsByTagName("H1")[0];
        if (h1.offsetHeight &amp;gt; 160) {
            h1.className += ' smaller';
        }

        // Small beautification for pattern examples.
        var title = h1.innerHTML;
        title = title.replace(/^(Java|C\+\+|C#|PHP|Python|Ruby|Delphi): (.*)$/, '&amp;lt;strong&amp;gt;$1:&amp;lt;/strong&amp;gt; $2');
        h1.innerHTML = title;
    </script>

    
    

    <div class="before-after-container">
        <div class="before">
            <h3>Problem</h3>
            <p>Do you have a method that returns a value but also changes something inside an object?</p>

        </div>
        <div class="after">
            <h3>Solution</h3>
            <p>Split the method into two separate methods. As you would expect, one of them should return the value and the other one modifies the object.</p>

        </div>
    </div>

        <div class="examples">
                    <div class="before-after before-after-container ">
                <div class="before">
                    <div class="ba">Before</div>
                                            <div class="ba-container"><img src="../Images/b677d404e57bd619bcb7e6c70e82c178.png" alt="Separate Query from Modifier - Before" width="415" data-original-src="https://refactoringguru.cn/images/refactoring/diagrams/Separate Query from Modifier - Before.png?id=b28976c01f67d02e8b4574b1c825d10d"/></div>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <div class="ba-container"><img src="../Images/e57843da4ccd7e78aea0a90c2a1b9bbd.png" alt="Separate Query from Modifier - After" width="227" data-original-src="https://refactoringguru.cn/images/refactoring/diagrams/Separate Query from Modifier - After.png?id=c2b8e0722c1c8500302326ab60db80e5"/></div>
                                    </div>
            </div>
            </div>
    
    <h3>Why Refactor</h3>
<p>This factoring technique implements <em>Command and Query Responsibility Segregation</em>. This principle tells us to separate code responsible for getting data from code that changes something inside an object.</p>
<p>Code for getting data is named a <em>query</em>. Code for changing things in the <em>visible state</em> of an object is named a <em>modifier</em>. When a <em>query</em> and <em>modifier</em> are combined, you don't have a way to get data without making changes to its condition. In other words, you ask a question and can change the answer even as it's being received. This problem becomes even more severe when the person calling the query may not know about the method's "side effects", which often leads to runtime errors.</p>
<p>But remember that side effects are dangerous only in the case of <em>modifiers</em> that change the <strong>visible</strong> state of an object. These could be, for example, fields accessible from an object's public interface, entry in a database, in files, etc. If a <em>modifier</em> only caches a complex operation and saves it within the private field of a class, it can hardly cause any side effects.</p>
<h3>Benefits</h3>
<ul>
<li>If you have a <em>query</em> that doesn't change the state of your program, you can call it as many times as you like without having to worry about unintended changes in the result caused by the mere fact of you calling the method.</li>
</ul>
<h3>Drawbacks</h3>
<ul>
<li>In some cases it's convenient to get data after performing a command. For example, when deleting something from a database you want to know how many rows were deleted.</li>
</ul>
<h3>How to Refactor</h3>
<ol>
<li>
<p>Create a new <em>query method</em> to return what the original method did.</p>
</li>
<li>
<p>Change the original method so that it returns only the result of calling the new <em>query method</em>.</p>
</li>
<li>
<p>Replace all references to the original method with a call to the <em>query method</em>. Immediately before this line, place a call to the <em>modifier method</em>. This will save you from side effects in case if the original method was used in a condition of a conditional operator or loop.</p>
</li>
<li>
<p>Get rid of the value-returning code in the original method, which now has become a proper <em>modifier method</em>.</p>
</li>
</ol>


    <div class="prom banner-content banner banner-striped banner-with-image" data-id="Ref: Part of the ebook" data-creative-id="animated-en" data-position="content_bottom">
        <div class="banner-image">
            <a href="/refactoring/course">
                <video id="banner-zzz" loop="" muted="" playsinline="" width="200" height="200">
                    <source src="/images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56" type="video/mp4">
                    <source src="/images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4" type="image/png">
                    Your browser does not support HTML video.
                </source></source></video>
            </a>
        </div>
        <script>
            if (/CPU (?:iPhone )?OS [1-9]_/.test(navigator.userAgent)) {
                // Don't autoplay on old iOS, since it doesn not support playsinline.
            }
            else {
                document.getElementById('banner-zzz').play();
            }
        </script>

        <div class="banner-text">
            <h3 class="title">Tired of reading?</h3>
            <p class="big">No wonder, it takes <span class="blue">7 hours</span> to read all of the text we have here.</p>
            <p>Try our interactive course on refactoring. It offers a less tedious approach to learning new stuff.</p>
            <a class="btn btn-secondary" href="/refactoring/course"><i class="fa fa-star" aria-hidden="true"/> Let's see…</a>
        </div>
    </div>


        
</body>
</html>