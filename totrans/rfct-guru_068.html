<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Encapsulate Collection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Encapsulate Collection</h1>
<blockquote>原文：<a href="https://refactoringguru.cn/encapsulate-collection">https://refactoringguru.cn/encapsulate-collection</a></blockquote>
    
    

    <script type="text/javascript">
        // Shorten examples titles for users.
        var h1 = document.getElementsByTagName("H1")[0];
        if (h1.offsetHeight &amp;gt; 160) {
            h1.className += ' smaller';
        }

        // Small beautification for pattern examples.
        var title = h1.innerHTML;
        title = title.replace(/^(Java|C\+\+|C#|PHP|Python|Ruby|Delphi): (.*)$/, '&amp;lt;strong&amp;gt;$1:&amp;lt;/strong&amp;gt; $2');
        h1.innerHTML = title;
    </script>

    
    

    <div class="before-after-container">
        <div class="before">
            <h3>Problem</h3>
            <p>A class contains a collection field and a simple getter and setter for working with the collection.</p>

        </div>
        <div class="after">
            <h3>Solution</h3>
            <p>Make the getter-returned value read-only and create methods for adding/deleting elements of the collection.</p>

        </div>
    </div>

        <div class="examples">
                    <div class="before-after before-after-container ">
                <div class="before">
                    <div class="ba">Before</div>
                                            <div class="ba-container"><img src="../Images/d61c9af4590593edec45f293fecc0885.png" alt="Encapsulate Collection - Before" width="227" data-original-src="https://refactoringguru.cn/images/refactoring/diagrams/Encapsulate Collection - Before.png?id=0c01860495c763043a13ce47086e49f1"/></div>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <div class="ba-container"><img src="../Images/72ab1dc242723ae23322fc28d823464e.png" alt="Encapsulate Collection - After" width="284" data-original-src="https://refactoringguru.cn/images/refactoring/diagrams/Encapsulate Collection - After.png?id=e8f5624c8d63963421680121d49a43de"/></div>
                                    </div>
            </div>
            </div>
    
    <h3>Why Refactor</h3>
<p>A class contains a field that contains a collection of objects. This collection could be an array, list, set or vector. A normal getter and setter have been created for working with the collection.</p>
<p>But the collections should be used by a protocol that's a bit different from the one used by other data types. The getter method shouldn't return the collection object itself, since this would let clients change collection contents without the knowledge of the owner class. In addition, this would show too much of the internal structures of the object data to clients. The method for getting collection elements should return a value that doesn't allow changing the collection or disclose excessive data about its structure.</p>
<p>In addition, there shouldn't be a method that assigns a value to the collection. Instead, there should be operations for adding and deleting elements. Thanks to this, the owner object gains control over addition and deletion of collection elements.</p>
<p>Such a protocol properly encapsulates a collection, which ultimately reduces the degree of association between the owner class and the client code.</p>
<h3>Benefits</h3>
<ul>
<li>
<p>The collection field is encapsulated inside a class. When the getter is called, it returns a copy of the collection, which prevents accidental changing or overwriting of the collection elements without the knowledge of the class that contains the collection.</p>
</li>
<li>
<p>If collection elements are contained inside a primitive type, such as an array, you create more convenient methods for working with the collection.</p>
</li>
<li>
<p>If collection elements are contained inside a non-primitive container (standard collection class), by encapsulating the collection you can restrict access to unwanted standard methods of the collection (such as by restricting addition of new elements).</p>
</li>
</ul>
<h3>How to Refactor</h3>
<ol>
<li>
<p>Create methods for adding and deleting collection elements. They must accept collection elements in their parameters.</p>
</li>
<li>
<p>Assign an empty collection to the field as the initial value if this isn't done in the class constructor.</p>
</li>
<li>
<p>Find the calls of the collection field setter. Change the setter so that it uses operations for adding and deleting elements, or make these operations call client code.</p>
</li>
</ol>
<p>Note that setters can be used only to replace all collection elements with other ones. Therefore it may be advisable to change the setter name (<a href="/rename-method">Rename Method</a>) to <code>replace</code>.</p>
<ol start="4">
<li>
<p>Find all calls of the collection getter after which the collection is changed. Change the code so that it uses your new methods for adding and deleting elements from the collection.</p>
</li>
<li>
<p>Change the getter so that it returns a read-only representation of the collection.</p>
</li>
<li>
<p>Inspect the client code that uses the collection for code that would look better inside of the collection class itself.</p>
</li>
</ol>


    <div class="prom banner-content banner banner-striped banner-with-image" data-id="Ref: Part of the ebook" data-creative-id="animated-en" data-position="content_bottom">
        <div class="banner-image">
            <a href="/refactoring/course">
                <video id="banner-zzz" loop="" muted="" playsinline="" width="200" height="200">
                    <source src="/images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56" type="video/mp4">
                    <source src="/images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4" type="image/png">
                    Your browser does not support HTML video.
                </source></source></video>
            </a>
        </div>
        <script>
            if (/CPU (?:iPhone )?OS [1-9]_/.test(navigator.userAgent)) {
                // Don't autoplay on old iOS, since it doesn not support playsinline.
            }
            else {
                document.getElementById('banner-zzz').play();
            }
        </script>

        <div class="banner-text">
            <h3 class="title">Tired of reading?</h3>
            <p class="big">No wonder, it takes <span class="blue">7 hours</span> to read all of the text we have here.</p>
            <p>Try our interactive course on refactoring. It offers a less tedious approach to learning new stuff.</p>
            <a class="btn btn-secondary" href="/refactoring/course"><i class="fa fa-star" aria-hidden="true"/> Let's see…</a>
        </div>
    </div>


        
</body>
</html>