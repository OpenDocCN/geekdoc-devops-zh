<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Extract Variable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Extract Variable</h1>
<blockquote>原文：<a href="https://refactoringguru.cn/extract-variable">https://refactoringguru.cn/extract-variable</a></blockquote>
    
    

    <script type="text/javascript">
        // Shorten examples titles for users.
        var h1 = document.getElementsByTagName("H1")[0];
        if (h1.offsetHeight &amp;gt; 160) {
            h1.className += ' smaller';
        }

        // Small beautification for pattern examples.
        var title = h1.innerHTML;
        title = title.replace(/^(Java|C\+\+|C#|PHP|Python|Ruby|Delphi): (.*)$/, '&amp;lt;strong&amp;gt;$1:&amp;lt;/strong&amp;gt; $2');
        h1.innerHTML = title;
    </script>

    
    

    <div class="before-after-container">
        <div class="before">
            <h3>Problem</h3>
            <p>You have an expression that's hard to understand.</p>

        </div>
        <div class="after">
            <h3>Solution</h3>
            <p>Place the result of the expression or its parts in separate variables that are self-explanatory.</p>

        </div>
    </div>

        <div class="examples">
                    <div class="before-after before-after-container java" data-lang="java">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="java">void renderBanner() {
  if ((platform.toUpperCase().indexOf("MAC") &gt; -1) &amp;&amp;
       (browser.toUpperCase().indexOf("IE") &gt; -1) &amp;&amp;
        wasInitialized() &amp;&amp; resize &gt; 0 )
  {
    // do something
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="java">void renderBanner() {
  final boolean isMacOs = platform.toUpperCase().indexOf("MAC") &gt; -1;
  final boolean isIE = browser.toUpperCase().indexOf("IE") &gt; -1;
  final boolean wasResized = resize &gt; 0;

  if (isMacOs &amp;&amp; isIE &amp;&amp; wasInitialized() &amp;&amp; wasResized) {
    // do something
  }
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container csharp" data-lang="csharp">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="csharp">void RenderBanner() 
{
  if ((platform.ToUpper().IndexOf("MAC") &gt; -1) &amp;&amp;
       (browser.ToUpper().IndexOf("IE") &gt; -1) &amp;&amp;
        wasInitialized() &amp;&amp; resize &gt; 0 )
  {
    // do something
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="csharp">void RenderBanner() 
{
  readonly bool isMacOs = platform.ToUpper().IndexOf("MAC") &gt; -1;
  readonly bool isIE = browser.ToUpper().IndexOf("IE") &gt; -1;
  readonly bool wasResized = resize &gt; 0;

  if (isMacOs &amp;&amp; isIE &amp;&amp; wasInitialized() &amp;&amp; wasResized) 
  {
    // do something
  }
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container php" data-lang="php">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="php">if (($platform-&gt;toUpperCase()-&gt;indexOf("MAC") &gt; -1) &amp;&amp;
     ($browser-&gt;toUpperCase()-&gt;indexOf("IE") &gt; -1) &amp;&amp;
      $this-&gt;wasInitialized() &amp;&amp; $this-&gt;resize &gt; 0)
{
  // do something
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="php">$isMacOs = $platform-&gt;toUpperCase()-&gt;indexOf("MAC") &gt; -1;
$isIE = $browser-&gt;toUpperCase()-&gt;indexOf("IE")  &gt; -1;
$wasResized = $this-&gt;resize &gt; 0;

if ($isMacOs &amp;&amp; $isIE &amp;&amp; $this-&gt;wasInitialized() &amp;&amp; $wasResized) {
  // do something
}</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container python" data-lang="python">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="python">def renderBanner(self):
    if (self.platform.toUpperCase().indexOf("MAC") &gt; -1) and \
       (self.browser.toUpperCase().indexOf("IE") &gt; -1) and \
       self.wasInitialized() and (self.resize &gt; 0):
        # do something</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="python">def renderBanner(self):
    isMacOs = self.platform.toUpperCase().indexOf("MAC") &gt; -1
    isIE = self.browser.toUpperCase().indexOf("IE") &gt; -1
    wasResized = self.resize &gt; 0

    if isMacOs and isIE and self.wasInitialized() and wasResized:
        # do something</pre>
                                    </div>
            </div>
                    <div class="before-after before-after-container typescript" data-lang="typescript">
                <div class="before">
                    <div class="ba">Before</div>
                                            <pre class="code" lang="typescript">renderBanner(): void {
  if ((platform.toUpperCase().indexOf("MAC") &gt; -1) &amp;&amp;
       (browser.toUpperCase().indexOf("IE") &gt; -1) &amp;&amp;
        wasInitialized() &amp;&amp; resize &gt; 0 )
  {
    // do something
  }
}</pre>
                                    </div>
                <div class="after">
                    <div class="ba">After</div>
                                            <pre class="code" lang="typescript">renderBanner(): void {
  const isMacOs = platform.toUpperCase().indexOf("MAC") &gt; -1;
  const isIE = browser.toUpperCase().indexOf("IE") &gt; -1;
  const wasResized = resize &gt; 0;

  if (isMacOs &amp;&amp; isIE &amp;&amp; wasInitialized() &amp;&amp; wasResized) {
    // do something
  }
}</pre>
                                    </div>
            </div>
            </div>
    
    <h3>Why Refactor</h3>
<p>The main reason for extracting variables is to make a complex expression more understandable, by dividing it into its intermediate parts. These could be:</p>
<ul>
<li>
<p>Condition of the <code>if()</code> operator or a part of the <code>?:</code> operator in C-based languages</p>
</li>
<li>
<p>A long arithmetic expression without intermediate results</p>
</li>
<li>
<p>Long multipart lines</p>
</li>
</ul>
<p>Extracting a variable may be the first step towards performing <a href="/extract-method">Extract Method</a> if you see that the extracted expression is used in other places in your code.</p>
<h3>Benefits</h3>
<ul>
<li>More readable code! Try to give the extracted variables good names that announce the variable's purpose loud and clear. More readability, fewer long-winded comments. Go for names like <code>customerTaxValue</code>, <code>cityUnemploymentRate</code>, <code>clientSalutationString</code>, etc.</li>
</ul>
<h3>Drawbacks</h3>
<ul>
<li>
<p>More variables are present in your code. But this is counterbalanced by the ease of reading your code.</p>
</li>
<li>
<p>When refactoring conditional expressions, remember that the compiler will most likely optimize it to minimize the amount of calculations needed to establish the resulting value. Say you have a following expression <code>if (a() || b()) ...</code>. The program won't call the method <code>b</code>  if the method <code>a</code> returns <code>true</code> because the resulting value will still be <code>true</code>, no matter what value returns <code>b</code>.</p>
<p>However, if you extract parts of this expression into variables, both methods will always be called, which might hurt performance of the program, especially if these methods do some heavyweight work.</p>
</li>
</ul>
<h3>How to Refactor</h3>
<ol>
<li>
<p>Insert a new line before the relevant expression and declare a new variable there. Assign part of the complex expression to this variable.</p>
</li>
<li>
<p>Replace that part of the expression with the new variable.</p>
</li>
<li>
<p>Repeat the process for all complex parts of the expression.</p>
</li>
</ol>


    <div class="prom banner-content banner banner-striped banner-with-image" data-id="Ref: Part of the ebook" data-creative-id="animated-en" data-position="content_bottom">
        <div class="banner-image">
            <a href="/refactoring/course">
                <video id="banner-zzz" loop="" muted="" playsinline="" width="200" height="200">
                    <source src="/images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56" type="video/mp4">
                    <source src="/images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4" type="image/png">
                    Your browser does not support HTML video.
                </source></source></video>
            </a>
        </div>
        <script>
            if (/CPU (?:iPhone )?OS [1-9]_/.test(navigator.userAgent)) {
                // Don't autoplay on old iOS, since it doesn not support playsinline.
            }
            else {
                document.getElementById('banner-zzz').play();
            }
        </script>

        <div class="banner-text">
            <h3 class="title">Tired of reading?</h3>
            <p class="big">No wonder, it takes <span class="blue">7 hours</span> to read all of the text we have here.</p>
            <p>Try our interactive course on refactoring. It offers a less tedious approach to learning new stuff.</p>
            <a class="btn btn-secondary" href="/refactoring/course"><i class="fa fa-star" aria-hidden="true"/> Let's see…</a>
        </div>
    </div>


        
</body>
</html>