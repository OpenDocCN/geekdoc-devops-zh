# 添加 Jenkins 代理节点

> 原文：<https://acloudguru.com/blog/engineering/adding-a-jenkins-agent-node>

主/控制器是中央协调进程，它存储配置、加载插件并为 Jenkins 呈现各种用户界面。

代理通常是连接到 Jenkins 主服务器的机器或容器，用于在主服务器的指导下执行任务。

单一的整体式 Jenkins 安装对于项目数量相对较少的小团队来说非常有用。但是，随着您需求的增长，通常有必要扩大规模。Jenkins 提供了一种叫做“主代理连接”的方法。您可以为 Jenkins 提供代理来处理作业的执行，而主服务器为 Jenkins UI 提供服务并充当控制节点，而不是在单个系统上运行所有的构建作业。

* * *

## 加速您的职业发展

[从 ACG 开始](https://acloudguru.com/pricing)通过 AWS、Microsoft Azure、Google Cloud 等领域的课程和实际动手实验室改变你的职业生涯。

* * *

在这篇文章中，我想给你一个如何建立一个 Jenkins 代理的简单介绍。你可以在这里找到关于 Jenkins 代理节点的更多信息。**你将需要:**

我根据詹金斯版本 *2.89.4 LTS* 编写了这个指南。我将提供一些命令，可以用来在 CentOS 7 机器上完成所有这些步骤。

### 步骤 1:安装必要的软件包。

您需要在代理节点上安装一些包，比如 Java，以及运行您的构建可能需要的任何工具(Git、Maven、Ant、Gradle 等)。).我来安装 *Java* 和*GitT5:*

```
sudo yum -y install java-1.8.0-openjdk git
```

### 步骤 2:在代理上创建一个供 Jenkins 使用的用户。

现在我们需要在代理上创建一个用户。Jenkins 主服务器将以此用户身份登录代理，所有构建作业将以此用户身份执行。将这个用户称为 *jenkins* 是有意义的，我们将为他们提供一个特殊的主目录，jenkins 代理的文件将存放在这个目录中:

```
sudo useradd -d /var/lib/jenkins jenkins
```

### 步骤 3:生成一个 ssh 密钥。

接下来，我们需要生成一个 ssh 密钥。Jenkins 将使用这个密钥向代理节点进行验证，并作为 *jenkins* 用户登录。这个密钥几乎可以在任何 Linux 机器上生成，但是您也可以在代理节点本身上生成:

```
ssh-keygen
```

该命令将提供一系列提示。请随意使用默认值。从安全角度来看，在出现提示时输入密码可能是一个好主意，如果您这样做，请确保记下您使用的密码，因为您以后会需要它。该命令将输出两个文件: *id_rsa* 和 *id_rsa.pub* 。如果您已经熟悉了在 Linux 中使用 ssh 密钥的过程，那么这将是您非常熟悉的，但是如果没有，不要担心。我会教你如何使用这些钥匙！默认情况下，这些文件位于 *~/中。ssh/* 。当您运行 *ssh-keygen* 时，您可以选择指定另一个位置。

### 第四步:在*代理*节点将公钥添加到*詹金斯*用户的 *authorized_keys* 文件中。

接下来，我们需要将公钥( *id_rsa.pub* 的内容)添加到我们之前创建的 *jenkins* 用户的 *authorized_keys* 文件中。这将允许任何拥有私钥的人(在我们的例子中是 Jenkins master)作为 *jenkins* 用户登录到*代理*节点。首先，我们需要创建 *authorized_keys* 文件所属的目录，然后我们可以创建文件本身:

```
sudo mkdir /var/lib/jenkins/.sshsudo vi /var/lib/jenkins/.ssh/authorized_keys
```

复制前面生成的 *id_rsa.pub* 文件的全部内容( *~/)。ssh/id_rsa.pub* 默认)粘贴到 *authorized_keys* 中，然后保存。

### 第五步:通过 Jenkins UI 添加 Jenkins *代理*节点。

现在我们准备好通过 Jenkins UI 完成节点的设置。在 Jenkins 中，进入**管理 Jenkins** ，然后**管理节点**，再点击**新建节点**。在这里你可以给你的代理节点起一个名字，然后选择**永久代理**，点击 **OK** 。这里有多种选项可以用来定制您的节点。我们现在关心的是**发射方式**。

1.  对于**启动方式**，选择**通过 SSH** 启动从代理。
2.  在*主机*字段中输入您的*代理*节点的主机名或 IP 地址。
3.  点击*证件*旁边的**添加**按钮，选择**詹金斯**范围。
4.  对于凭证，使用私钥将**种类**设置为 **SSH 用户名。**
5.  输入 *jenkins* 作为用户名。
6.  对于私钥，选择**直接输入**。然后，复制您的私钥文件的内容( *~/)。ssh/id_rsa* 默认)并粘贴到 **Key** 框中。
7.  如果您在生成密钥时使用了密码短语，请为**密码短语**输入密码短语，否则，将其留空。
8.  输入一个*描述 id* 和*描述*，然后点击**添加**。
9.  点击**保存**保存新节点。

### 第六步:确保一切正常。

您的新节点现在应该出现在节点列表中。您可能会注意到节点图标上有一个红色的 X。这表明它没有连接，但那是因为我们刚刚添加它，它还没有机会连接。等待几秒钟并刷新页面，红色 X 将消失，表示节点已连接。**恭喜你！**您已经成功创建了一个 Jenkins 代理节点！

* * *

有兴趣了解更多关于 Jenkins 的信息吗？查看我们的[詹金斯基础](https://acloudguru.com/course/jenkins-fundamentals)课程，积累基础知识。或者，试试我们的[认证詹金斯工程师课程](https://acloudguru.com/course/certified-jenkins-engineer)，为你准备认证詹金斯工程师考试。

* * *

## 掌握最受欢迎的技能

无论您是云新手还是经验丰富的专家，云专家都可以让您轻松(而且非常棒)地提升您的云职业生涯。查看 [ACG 的免费课程](https://acloudguru.com/blog/news/whats-free-at-acg-june-2021)或立即开始免费试用。