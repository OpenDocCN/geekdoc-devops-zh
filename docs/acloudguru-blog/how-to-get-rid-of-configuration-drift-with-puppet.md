# 借助 Puppet ，摆脱配置漂移的困扰

> 原文：<https://acloudguru.com/blog/engineering/how-to-get-rid-of-configuration-drift-with-puppet>

不幸的是，在您的环境中有同事说不要碰的服务器是很常见的。这些脆弱、陈旧的机器只会通过票证和断电提醒你它们的存在。

这些是**漂移服务器**(这也将是一个乐队令人敬畏的名字)。使用像 [Puppet](https://acloudguru.com/course/introduction-to-puppet) 这样的配置管理工具将这些错误的服务器恢复到正常状态是对您最有利的。

## **什么是配置漂移？**

配置漂移是指机器被调整和更改到不再匹配原始状态的程度。

像这样难以控制的系统需要花费时间和精力来管理和排除故障。让它们回到正常工作的稳定状态需要不断检查并确保它们配置正确，就像制造厂的质量控制人员一样。

## 如何用 Puppet 修复配置漂移

Puppet 可以通过将配置(文件、注册表、软件等等)转换成易读、易懂，而且最重要的是可执行的代码来帮助您解决配置漂移问题。下面是怎么做的！

* * *

[![Cloud Adventure](img/a312d94930ad6b6293401f6bb5f5286d.png)](https://get.acloudguru.com/cloud-migration-role-playing-game-webinar)

**[云迁移:角色扮演游戏](https://get.acloudguru.com/cloud-migration-role-playing-game-webinar)** 云迁移活动需要策略和知识——有点像龙与地下城&的游戏。加入这一独特的角色扮演练习，让专家通过真实的云迁移场景进行游戏。

* * *

### 1.从信息收集开始

第一步是尽可能找到关于该机器配置的所有信息。

您找到的任何文档都会有所帮助，但是很有可能自服务器部署后就没有更新过。毕竟，上一次有人在修复服务器故障后检查文档更新是什么时候？这变成了事后的想法，这也是为什么代码为的[基础设施不仅是部署的更好方式，而且是跟踪您的变更和配置的更好方式。](https://acloudguru.com/blog/engineering/cloudformation-terraform-or-cdk-guide-to-iac-on-aws)

请确保您还检查了票务系统，以了解有关该服务器的事件和更改。最重要的是，看一下系统，确保它匹配。环境中发生了许多未记录的变化，最好是识别出那些潜在的“陷阱”

* * *

***使用 Puppet 却不想自己编写模块？***

*尝试使用 [Puppet Forge](https://acloudguru.com/hands-on-labs/using-modules-from-the-puppet-forge) 的动手实验室，这是一个由 PuppetLabs 托管的在线存储库，存储在 Puppet 基础设施中使用的公共模块。*

* * *

### 2.构建一个副本

一旦确定了所有的配置，就该将这些知识转化为代码，并构建一台与原始机器完全一样的机器(没有奇怪的问题)。

从最基本的选项开始，逐步深入到更复杂、更具体的细节。您可能会注意到，并非所有的配置都是工作状态所必需的，这是很自然的。绷带被放在伤口上，你在建造一个新的身体。(弗兰肯斯坦会骄傲的。)

如果这不是您第一次使用 Puppet，那么您可能已经有了一套可以参考和重用的基本配置，而不是重新发明轮子。如果没有，恭喜你！你现在也在为你所有的未来构建创建它们。回收是节省时间和制定标准的关键。说到标准，这让我们进入下一步。

### 3.试图标准化

大多数容易出问题的构建往往不会经常被触及，这意味着过时的软件需要升级。

将配置转化为[基础设施的代码](https://acloudguru.com/blog/engineering/how-to-get-started-with-infrastructure-as-code-iac-on-gcp)可以让你的部门有一个特殊的交换筹码。特别是更新、升级和更改系统软件和操作系统以符合稳定性和安全性标准的能力。您需要部署的软件越少，环境就越容易管理和修复。

想想看，如果一个机械师只需要和一个制造商和一种型号的汽车打交道，他们的工作会有多容易。管理基础架构也是如此！只要确保你的新标准版本仍然与应用程序或平台一起工作。

* * *

[![Complete guide to the Cloud and Dictionary ](img/93ebf63b88ab7fbd48705a01952ba688.png)](https://get.acloudguru.com/cloud-dictionary-of-pain)

[**获得痛苦的云词典**](https://get.acloudguru.com/cloud-dictionary-of-pain)
说云不一定要努力。我们分析了数以百万计的回复，找出了最容易让人犯错的概念。抓住这个[云指南](https://get.acloudguru.com/cloud-dictionary-of-pain)获取一些最痛苦的云术语的简洁定义。

* * *

### 4.测试，测试，部署

因为您的代码将成为管理和重新部署服务器的事实标准，所以请确保它能够工作！保持对每个版本的测试，并确保系统在部署后立即工作，无需额外的配置。如果没有，找出原因并修改代码。

当该说的都说了，该做的都做了，并且您准备好实现时，您将不得不决定是将您的代码应用到现有的系统中，还是用一个新的系统来替换它。不管怎样，高兴吧！。。。把旧系统踢到路边。

### 5.重复使用你创造的东西

现在，您的机器已经重新联机，不会再给您带来任何麻烦，是时候用另一台机器重新开始了。

这不可能是唯一需要修理的机器。像以前一样，从信息收集开始，然后继续下一步。将您所编写的代码应用到您企业的其他系统中。

控制失控的服务器对您部门的底线和您的心理健康非常重要。使用 Puppet，您会慢慢地发现自己有了更好的基础设施，需要解决的问题更少，并且有更多的时间从被动转变为主动。

* * *

## 做一个**木偶大师**

准备好成为傀儡大师了吗？(假设你不是想成为一名口技表演者或组建一支重金属乐队，那你来对地方了！)在 ACG 对初学者友好的[木偶入门](https://acloudguru.com/course/introduction-to-puppet)课程中学习木偶如何工作以及何时使用它。