# 使用 Route 53 配置 DNS

> 原文：<https://acloudguru.com/blog/engineering/configure-dns-with-route-53>

如果你是一个网站所有者，从 GoDaddy(或一些其他注册商)购买了一个域名，并开始探索 AWS 以利用云计算的能力，你需要解决的一个问题是:我的应用程序/网站服务器托管在 AWS 上，但我如何与我从 GoDaddy 购买的域名集成？最简单的答案是更新你的 GoDaddy NS 记录，指向亚马逊的域名服务器。在本教程中，我们将看看这个过程是如何工作的。请注意，我们将查看 GoDaddy，这样我们就有了一个特定的示例，但是无论您在哪里购买域名，这个过程都是非常相似的。

## 背景

在我们开始行动之前，让我们试着理解这个过程中涉及的一些基本组件，以及它们是如何协同工作的。让我们假设你是域名 mywebsite.com 的所有者。在典型设置中，当用户在其浏览器中键入您的网站 URL 时，会发生以下情况:

1.  浏览器向域名系统服务器查询您的域的 IP 地址。请注意，在确定使用哪个 DNS 服务器时，查找的顺序是:
    1.  本地缓存
    2.  局域网
    3.  ISP 级缓存服务器
    4.  权威 DNS 服务器
2.  然后，浏览器查询权威的 DNS 域名服务器(根服务器)以找出**的“顶级域名”(TLD)域名服务器。com** 域名。
3.  接下来，浏览器查询 TLD 域名服务器以获取**mywebsite.com 的域名服务器(您通过注册商配置的)。**
4.  最后，它查询域名服务器以获得运行**https://mywebsite.com**的主机的 IP 地址。

回顾一下，涉及的主要组件有:

*   **根域名服务器**–这些服务器直接响应“根区域”中的记录请求，但它们也可以通过 TLD 域名服务器列表来响应其他请求。
*   **TLD 域名服务器**–这些域名服务器响应特定顶级域名的查询，并返回给定 FQDN(完全合格域名)的域名服务器。
*   **域名**的域名服务器–在顶级域名中，可能有数百万个 FQDNs。每一个域名都将分布在一个域名服务器网络中，这些服务器对用户想要访问的特定域名的请求作出响应。

现在，如果我们将这些信息放在我们试图实现的上下文中，新的流程将保持 DNS 提供商作为“GoDaddy”，但只是作为一个代理。我们可以使用 AWS 名称服务器来解析您的主机 IP。

## 使用路由 53 配置 DNS

注意，我们这里讨论的步骤是针对“简单”DNS 配置的，比如托管一个基本的网站或应用程序。如果您当前的 DNS 设置很复杂，步骤可能会略有不同。 [AWS 文档](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/migrate-dns-domain-in-use.html) 在我们继续之前，有一个声明值得一读:

> “当您将 DNS 服务从另一个提供商迁移到 [AWS Route 53](https://acloudguru.com/blog/engineering/how-to-deploy-a-custom-domain-with-the-amplify-console) 时，您将在 Route 53 中复制您当前的 DNS 配置。 *I* *n Route 53，您创建了一个与您的域同名的托管区域，并且您在托管区域中创建了记录。每条记录表明您希望如何为指定的域名或子域名路由流量。*

在一个简单的场景中，您从当前的 DNS 提供商(在我们的示例中是 GoDaddy)向 AWS 迁移以下一项或多项内容:

*   a(地址)记录–将域名或子域名与相应资源的 IPv4 地址(例如，*192.0.2.3*)相关联。
*   AAAA(地址)记录-将域名或子域名与相应资源的 IPv6 地址(例如，*2001:0 db 8:85 a3:::ABCD:0001:234*5)相关联。
*   MX(邮件服务器)记录–将流量路由到邮件服务器。
*   CNAME 记录–将一个域的流量重新路由到另一个域。

### 步骤 1:创建托管区域

登录 [AWS 管理控制台](https://console.aws.amazon.com/route53/)并导航至 Route 53 菜单。然后点击**创建托管区域**。创建区域后，您将在页面右侧看到一个表单。在字段中输入以下信息:

*   **域名:**您的域名；在我们的例子中，mywebsite.com。
*   **点评:**你可以在这里输入任何你喜欢的东西。
*   **类型:**根据该区域的可用性类型进行选择。默认为“公共托管区域”，这意味着可以从互联网访问该区域。“私人托管区域”可从 AWS VPC 内部访问，不可用于公共互联网。

默认情况下，该步骤将在您的托管区域中创建两个条目:NS(名称服务器)和 SOA(授权起始)记录。记下 NS(名称服务器)条目。下一步，我们将使用 GoDaddy 配置这些。

### 步骤 2:创建 DNS 记录

单击新创建的托管区域，这将带您进入“托管区域详细信息”屏幕。点击**创建资源记录**，您将看到一个新的表单。为以下内容选择适当的值:

*   **Name** :如果你是*而不是*配置子域，请留空。
*   **类型** : 参考 GoDaddy 找出你当前的类型是什么，在这里使用相同的值。对于建立一个基本的网站，这将最有可能是一个或 AAAA。
*   **别名**:选择一个合适的值。AWS 文档的[部分提供了更多关于选择什么(和什么时候)的信息。](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-choosing-alias-non-alias.html)
*   **值/别名目标**:根据别名是(或)否，您将指向一个 IP 地址或一些其他别名条目。
*   **路由策略**:默认为“简单”。但是如果你想要一个不同的路由策略，你可以参考 [AWS 文档](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy.html)来理解基于场景选择哪一个。

### 步骤 3:通过您的域注册商管理 DNS 设置

在这一步，我们将我们的域映射到我们的服务器。回到我们列出的 DNS 查找的三个组成部分，这种映射在最后一个层面上有所帮助。在向 TLD 域名服务器发出请求后，存放你的记录的亚马逊域名服务器将被返回。这允许用户为您的网站或应用程序解析域名。登录 GoDaddy 控制台，导航到您的域，然后为您要配置的域单击**管理**。接下来，点击附加设置部分下的**管理 DNS** (这将在页面底部):点击**添加**(在页面顶部的记录部分)并将类型设置为*名称服务器*。在*主机*字段中，输入您的域名。在*指向*字段中，输入您在配置 AWS 托管区域记录时在步骤 1 中获得的一个 NS IP 地址。重复此过程，从步骤 1 中的托管区域添加每个 NS 记录。就是这样！您的配置完成了！现在，您需要做的就是花一些时间来传播这些设置。这些相同的原则将适用于这样的情况，你想离开根域与 GoDaddy，但有子域 DNS 的 AWS。除了将 DNS“委托(或)代理”给 AWS 之外，另一种方法是“迁移注册”。关于[将域名注册转移到 Amazon Route 53](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-transfer-to-route-53.html) 的 AWS 文档中有关于如何做的详细信息。