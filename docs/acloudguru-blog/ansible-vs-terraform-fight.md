# Ansible vs. Terraform:战斗！

> 原文：<https://acloudguru.com/blog/engineering/ansible-vs-terraform-fight>

![](img/f1924661eb5341d40e4715428028ff77.png)

### 什么是 Ansible 和 Terraform？

如果你在或者想要进入“DevOps”世界，Terraform 和 Ansible 将会是你经常听到的两个名字。这是有充分理由的！两者都是优秀的产品，用于将基础设施创建为可用于部署可重复环境的代码，以满足各种各样的复杂性需求。但是这两者有什么区别呢？为什么你应该选择一个而不是另一个…或者你应该？让我们再深入一点，谈谈这些应用程序的一些相似之处和不同之处。

### **配置管理与流程编排**

对于那些读过我以前的文章(博客、指南等)的人来说。)，你已经知道我非常喜欢类比、明喻、隐喻等。这一块也不会有什么不同！Ansible 和 Terraform 是两个非常相似的应用程序，但有一些关键的区别。其中一个关键区别涉及两个非常常见的 DevOps 概念:配置管理和编排。这些术语通常描述工具的类型。

Ansible 主要是一个配置管理工具，通常缩写为“CM”，Terraform 是一个编排工具。现在，要明白有重叠，这些术语不一定是相互排斥的。使用与其优势相匹配的工具会有所帮助，所以让我们来谈一谈每种类型的工具针对什么进行优化。好了，如我所承诺的，类比的时间到了！把这些工具想象成音乐家的管弦乐队。编排工具类似于指挥。指挥确保有正确数量的乐器，并且所有的乐器都能正确演奏。如果出现问题，编排工具通常会移除行为不当的乐器，并用另一个乐器替换它。编排工具通常关注最终结果，并有助于确保环境始终处于该“状态”。Terraform 是这样的。Terraform 将存储环境的状态，如果有任何东西出了问题或丢失，它将在再次运行时自动提供该资源。这对于需要非常稳定状态的环境来说是极好的。如果出现问题，另一个“Terraform Apply”将纠正问题！另一方面，配置管理工具更像是一个仪器维修人员。配置管理工具，如 Ansible，将配置每个仪器，以确保它是正确的，没有损坏，并正常工作。如果仪器有问题，CM 工具将修复问题，而不仅仅是更换整个仪器。请记住，Ansible 在这方面是一个混合体，能够替代基础设施并执行编排任务，但 Terraform 通常被认为是这方面的一个优秀产品，因为它具有更高级的状态管理功能。

*通过 [Terraform 认证](https://acloudguru.com/course/hashicorp-certified-terraform-associate)展示你的 IaC 技能。*

### **程序性与声明性**

大多数 DevOps 工具都可以归为描述它们如何执行操作的两个类别之一。这些类别是“程序性的”和“声明性的”。现在，这些术语的定义非常简洁，但是工具之间有很大的重叠，并不总是完全符合其中一个或另一个的模型。Procedural 描述了一个应用程序，它需要在代码中安排确切的步骤。例如，如果您需要在您的环境中扩展 EC2 实例，您将指定需要创建多少实例。如果需要缩小，可以指定要删除的数字。回到我们的管弦乐队比喻，这就像一个指挥要求 5 个小号，却得到了 5 个以上的小号。声明性“声明”的正是需要什么，而不是实现结果的过程。因此，如果指挥需要 5 个小号，或者您需要 5 个 EC2 实例，这正是代码执行后您将拥有的数量。如果您有 10 个，而您需要 5 个，您只需指定计数为 5。在程序上，如果你有 10 个，而你需要 5 个，你必须指定 5 个被删除。 那么，我要带着这一切去哪里呢？Terraform 是严格声明性的。您将定义您的环境，如果该环境发生变化，将在下一次“Terraform Apply”中进行修正。另一方面，Ansible 是一个混合体。您可以执行允许过程式配置的特殊命令，或者使用大多数执行声明式配置的模块。请务必阅读您所阅读的任何可回答角色的文档，以确保您理解预期的行为，并知道您是否需要明确指出所需的资源，或者您是否需要增加或减少这些资源以获得正确的结果。

### 什么对我最合适？

我真希望能给你一个简单的答案。Ansible 和 Terraform 都把很多事情做得很好。我个人更喜欢使用 Terraform 进行编排，Ansible 进行配置管理。为什么？因为我发现 Terraform 在基础设施协调方面更加直观。编排是 Terraform 创建的目的，也是它的主要目的。Terraform 的所有更新都集中在编排上，而且看起来更加完美。此外，“地形图”是一个优秀的工具，它提供了比`Ansible --dry-run`命令更多的有用信息。另一方面，Ansible 针对配置管理进行了优化。它可以执行编排任务，但这只是它工作的一部分。正如我在 Linux Academy 上的“[使用 Terraform 和 Ansible](https://linuxacademy.com/amazon-web-services/training/course/name/deploying-to-aws-with-ansible-and-terraform) 部署到 AWS”课程所证明的，我更喜欢使用最好的工具来完成任务。你可能会发现你更喜欢用一个工具做所有的事情，这是完全可以接受的！