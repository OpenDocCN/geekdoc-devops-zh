# 使用 Azure AD 应用程序代理远程访问内部应用程序

> 原文：<https://acloudguru.com/blog/engineering/remotely-access-on-premises-apps-with-azure-ad-app-proxy>

您是否有必须保留在本地的应用程序？也许你已经在 Azure 中托管了很多，但是你也有一个顽固的、遗留的或其他的、受限的应用程序不能被迁移。

随着世界上许多工作人员现在远程工作，您可能想知道如何最好地提供对这些应用程序的安全远程访问，而不增加 VPN 或 VDI 所需的基础架构和入站连接。

如果您*确实*想要提供对具有单点登录(SSO)的本地应用程序的安全远程访问、对各种身份验证协议的支持以及其他 Azure AD 安全功能，那么只需看看 Azure AD 应用程序代理就可以了。

* * *

**通往更好职业的钥匙**

[立即开始 ACG](https://acloudguru.com/pricing) 通过 AWS、Microsoft Azure、Google Cloud 等领域的课程和实际动手实验室来改变你的职业生涯。

* * *

这款 Azure AD Premium 授权产品允许您为您的远程员工发布本地应用。它只需要到 Azure 的出站网络连接，因此您的网络安全团队会很高兴不需要入站防火墙规则。它通过 Azure 广告功能(如条件接收策略)为这些应用程序增加了额外的保护。它支持多种身份验证协议的单点登录，例如:

*   集成 Windows 身份验证(IWA)
*   基于报头的认证
*   基于表单和基于密码的身份验证
*   SAML 认证

如果这听起来有助于在您的环境中提供安全的应用程序访问，那就留下来吧！我们将对 Azure 广告应用程序代理的架构和实现进行一个高层次的介绍，并提供一些额外的技巧来帮助我们。

在我们深入研究如何使用 Azure 广告应用程序代理之前，让我们快速总结一些重要的需求:

*   Azure AD 应用程序代理需要 Azure AD Premium P1 或 P2 许可
*   本地应用程序必须在 Azure AD 中注册
*   必须在内部安装一个或多个 Azure AD 应用程序代理连接器
*   连接器必须能够访问 Azure AD 和内部应用程序
*   您的内部应用可以是私有的，并且不需要访问 Azure AD
*   单点登录和条件访问等功能需要预认证

* * *

* * *

## 如何使用 Azure AD 应用程序代理

### 步骤 1:配置连接器

为了帮助提供对本地应用程序的安全访问，您需要安装 Azure AD 应用程序代理连接器。如果您刚刚开始，您可以通过安装一个连接器来简化您的设置。但是可以使用多个来提供弹性，建议在生产环境中使用。

要安装连接器，您应该登录到将用作连接器的 Windows 服务器。此服务器应该具有到 Azure AD 的出站连接，以及到你的应用的内部私有连接(理想情况下是紧密/低延迟)。

从该服务器登录到 Azure 门户。然后，您可以导航到 Azure Active Directory >应用程序代理，并选择下载和安装连接器。

成功安装后，您应该会在门户中看到连接器列为“活动”。

![](img/0a778ee084888b111d0614cd3ce3894f.png)

### 步骤 2:配置 Azure AD 应用程序

要使您的内部部署应用程序可通过 Azure AD 应用程序代理访问，它必须在 Azure AD 中注册。如果需要，此注册还允许您配置访问限制和单点登录(SSO)设置。

要注册该应用程序，请登录 Azure AD 门户并导航到 Azure Active Directory >企业应用程序。选择创建新的应用程序。

每个人的应用程序注册对于他们自己的环境都是独特的，但是以下几点提供了一些通用的指导:

*   您可以使用“内部部署应用程序”选项之一创建应用程序，或者您可能已经配置了应用程序——在任何情况下，一旦您的应用程序配置完毕，您就可以在应用程序注册后的“应用程序代理”部分找到所有重要选项
*   内部 URL 指的是应用程序的内部可访问地址，例如，如果您登录到连接器服务器，并试图从该服务器访问您的本地应用程序
*   预身份验证(使用 Azure AD 进行身份验证)允许您使用附加功能，如条件访问和 MFA 如果您使用此选项，您的用户帐户必须存在于 Azure AD 中，或者从内部同步到 Azure AD
*   直通身份验证意味着用户不会首先在 Azure AD 进行身份验证，而是所有身份验证将由应用程序在内部处理

一旦您的应用程序被注册，确保您已经配置了用户访问。您可以允许所有用户或仅选择用户访问您的应用程序。这是通过注册的应用程序在“用户和组”部分中配置的。

### 步骤 3:测试远程访问

在进行任何额外的配置之前，我建议您使用这些基本设置来测试应用程序现在是否可以像预期的那样远程工作。

您可以在已注册应用程序的“应用程序代理”设置中使用“测试应用程序”功能。在本节中，您还将找到您的“外部 URL ”,您可以使用它来执行测试并确保访问正常工作。

* * *

**千里之行始于 SQL 步骤**

*[立即在 ACG 开始免费试用](https://acloudguru.com/pricing)，通过我们的一系列 Azure data cert 课程、SQL 课程、动手实验室和其他出色的学习功能加快您的职业发展。不确定从哪里开始？我们将一步一步地指导您掌握在我们的学习道路上前进所需的知识和技能。无论你在旅途中的哪个地方，请通过我们的原创系列 [Azure This Week](https://acloudguru.com/videos/azure-this-week) 了解最新的 Azure 新闻。*

* * *

### 步骤 4:配置 SSO 和其他功能

您现在已经成功配置了 Azure AD 应用程序代理来为您的用户提供远程访问。在这个阶段，您可能已经拥有了您需要的一切，但是值得注意的是，您可以配置不同的场景和附加功能。例如:

*   使用受支持的身份验证方法之一进行单点登录:
    *   导航到您注册的应用程序中的“单点登录”设置
    *   配置您的应用程序使用的身份验证方法
*   条件接收
    *   配置条件访问策略，为您的内部应用程序启用细粒度的身份验证要求
    *   请注意，这受 Azure AD Premium P1 授权支持，并且您必须使用 Azure AD 预身份验证方法
*   自定义域和 SSL
    *   如果你有一个为 Azure AD 注册的自定义域，你可以将你注册的应用程序的“外部 URL”更改为更加用户友好的名称
    *   如果使用 SSL，您还可以在 Azure AD 中上传已注册应用程序的 SSL 证书，并进一步保护应用程序访问

无论您是通过 MyApps 门户为用户提供集中的应用程序访问，还是直接使用外部 URL，我们的远程用户现在都可以访问本地应用程序，所有这些都增加了 Azure AD 的安全性。

如果你想了解更多关于 Azure 广告的其他功能，或者你想观看 Azure 广告应用程序代理设置演示，那么你可能会发现[我的 AZ-305 课程很有用](https://learn.acloud.guru/course/az-305-designing-microsoft-azure-infrastructure-solutions/overview)。

在云专家这里查看一下吧。我浏览了 Azure AD、各种各样的 Azure 服务、应用程序安全性和大量其他内容，以帮助您为 Azure 设计解决方案！