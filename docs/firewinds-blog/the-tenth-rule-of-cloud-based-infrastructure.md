# 基于云的基础设施的第十条规则

> 原文：<https://www.fairwinds.com/blog/the-tenth-rule-of-cloud-based-infrastructure>

 我想我想分享一些关于 Fairwinds(又名反应性操作)起源的想法——关于我们做什么以及为什么要做。我先讲一点历史。

回到大学，我创办了一家两人科技创业公司，我身兼数职——程序员、系统管理员、数据库管理员。早期，我学会了欣赏伟大的基础设施的商业价值。

毕业后，我做了一名程序员，获得了 MBA 学位，随后成为了许多使用 Heroku 的初创公司的首席技术官，Heroku 是一种无需人工干预的云平台即服务基础设施。像许多已经迁移到云的公司一样，这些初创公司使用 Heroku，因为它有一个很好的 web 界面，无需管理服务器，以及良好的 DUX(开发者用户体验)。基础设施是具有挑战性的东西，Heroku 提供了许多人力难以替代的服务。然而，最终 Heroku 的成本超过了收益，我们将遇到该平台一刀切的限制。

公司往往希望在自己的平台上运行类似 Heroku 的环境，我创办的创业公司也不例外。在每种情况下，我们都会用内部的 DevOps 工程师替换 Heroku。它总是变成一个昂贵的烂摊子。

也许你熟悉互联网先驱  [菲利普·格林斯潘的](https://twitter.com/PhilipGreenspun) 第十条编程规则:“任何足够复杂的 C 或 Fortran 程序都包含一个临时的、非正式指定的、错误百出的、缓慢的普通 Lisp 的一半的实现。”换句话说，Common Lisp 的灵活性和可扩展性使它成为衡量其他编程语言的标准。

我有我自己的第十条规则(我没有其他规则)——任何足够复杂的基于云的基础设施都包含一个特别的、非正式指定的、充满 bug 的、缓慢的(并且更昂贵的)Heroku 实现。

## 80/20 甜蜜点

在像  Ruby on Rails 这样的开源框架出现之前，公司构建了大量与业务运营无关的代码。这与选择模板语言或数据库库没有什么不同——虽然重要，但这些活动通常与核心业务挑战无关。

Ruby on Rails 采用了许多它的创造者  大卫·海涅迈尔·汉森(DHH)没有自己创造的惯例和技术(MVC，ActiveRecord)。他的战略性集成方法得到了回报，今天，不使用 Ruby on Rails 这样的成熟框架从头开始开发 web 或 SaaS 应用程序是不可想象的——尤其是因为 Ruby on Rails 有一个 80/20 的最佳点，这意味着它对大多数应用程序都很有效。既然 Ruby on Rails 已经存在，为什么还要构建自己的 Ruby on Rails 呢？

## 2015 年，ReactiveOps 诞生了

良好的基础设施是优秀应用程序和优秀 DUX 的先决条件，但是，像 Ruby on Rails 一样，大多数公司不需要拥有自己的基础设施架构和代码。

当我大约两年前开始 ReactiveOps 时，我们着手为云上的  [AWS](https://aws.amazon.com/) 创建一个类似 Ruby on Rails 的框架——将最好的开源组件缝合在一起，并尽可能少地编写我们自己的代码，从而提供比其各部分之和更大的东西。我们的目标是为中小型公司提供该基础架构，使他们能够利用该平台，而不是雇佣内部开发团队并构建自己的团队。

因此，我们构建了 Omnia，一种不可变的基于基础设施的方法，它使用不同的技术，如  [Ansible](https://www.ansible.com/) 、  [Terraform](https://www.terraform.io/) 和[Packer](https://www.packer.io/)来创建按钮式环境。我们的客户获得了他们需要的基础设施，没有 Heroku 的限制，也没有雇佣内部 DevOps 员工的麻烦和成本。

虽然我们的客户使用 Omnia 取得了成功，但它不可伸缩，也没有很好的 DUX。例如，如果我们客户的工程师想要升级 Ruby，他们必须学习所有的工具或者让我们来处理。没有我们的帮助，这些开发人员无法部署应用程序。

就在那时，我们了解到一个改变一切的工具…

## 进入 Kubernetes

在我们开始 ReactiveOps 大约一年后，我们重新评估了一个名为  [Kubernetes](https://github.com/kubernetes) 的工具，这是一个开源平台，用于跨主机集群自动部署、扩展和管理应用容器。Kubernetes 的基础设施承诺让公司能够大规模快速部署应用程序，轻松推出新功能，同时只使用所需的资源。

起初我们持怀疑态度。虽然我们的团队在实现基于 Amazon 机器映像(AMI)的可靠  方法方面有几十年的经验，但我们缺乏对容器的概念性理解。让事情更加复杂的是，容器的工作和行为方式在很大程度上没有定义。码头化和集装箱化真的对大多数公司有利吗？

2016 年 4 月发布的 Kubernetes 1.2 包含了更多面向通用用途的功能。它被吹捧为下一个大事件，我们决定对它进行测试。我们很快发现 Kubernetes 是一个优雅的、结构化的、现实世界的大规模集装箱化解决方案，它解决了其他技术没有解决的关键挑战。它有 1000 多名贡献者的 160 多万行代码——它的功能比我们能构建的要多得多。我们没有切实可行的方法与之竞争。

就在那时，我们做出了艰难但具有战略意义的决定，用 Kubernetes 取代 Omnia。

## Kubernetes 是未来

Kubernetes 是一个非凡的下一代框架，可以运行任何工作负载。它提供了很好的 DUX，创新的速度正在加快，它背后有谷歌的承诺，所以它不会去任何地方。借助 Kubernetes，我们的客户可以在自己的  Google cloud、AWS 或本地环境中运行自己的 Heroku。他们甚至可以在没有我们帮助的情况下将自己的应用程序部署到 it 中。

像 Ruby on Rails 一样，Kubernetes 包含了许多智能的架构决策，有助于在容器化中构建应用程序。许多事情仍在你的掌控之中。例如，您可以决定如何设置、维护和监控不同的 Kubernetes 集群，以及如何将这些集群集成到其余的基于云的基础设施中。

## 我们最擅长什么

我们的一些竞争对手已经建立了自己的基础设施来与 Kubernetes 竞争，就像我们过去做的那样。其他人构建了他们自己的 Kubernetes 专有发行版，然后出售企业支持许可证。还有一些是定制的试错式操作商店，它们努力以艰难的方式解决单个客户端的挑战，而不是首先从一组旨在协同工作的工具和库开始。

我们用 Kubernetes。虽然放弃 Omnia 的决定并不容易，但我们并没有坚持自己的实现。因为我们不对外部投资者负责，我们有在正确的时间做出正确的商业决策的自由。

## 我们如何工作

我们从为期 1-2 周的深度基础设施审计开始，我们查看客户的系统和应用程序，以确定他们的应用程序是否能在 Kubernetes 中工作。如果是这样，我们将推出可扩展的、基于结果的实施方案。传统上，我们会在 2-4 个月内让我们的客户在 Kubernetes 上运行起来。

我们专注的方法是构建一个以 Kubernetes 为核心的平台即服务解决方案。我们的解决方案基于标准技术，因此您可以获得经过深思熟虑的商业现成工具。我们提供的商业价值是我们卓越的 DevOps 服务和专业知识。

我们的工作是为客户提供优秀的基础设施。Kubernetes 使我们能够做我们最擅长的事情，这使我们的客户能够专注于他们最擅长的事情。