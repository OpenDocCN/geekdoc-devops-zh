# K8s 诊所:如何安全高效地运行 Kubernetes

> 原文：<https://www.fairwinds.com/blog/k8s-clinic-how-to-run-kubernetes-securely-and-efficiently>

 ## 为什么组织选择 Kubernetes

随着容器的采用，软件打包越来越左移，这意味着(取决于您的组织)开发人员正在承担应用程序容器化的责任。开发人员也可能负责 Kubernetes 配置的某些部分。随着这一过程的左移，开发人员需要支持来为组织做出正确的决策，以便安全有效地运行 Kubernetes。

许多公司正在采用云原生技术来提高市场速度。对于寻求在当今市场竞争的企业来说，发布新功能并满足客户需求非常重要，而且这些需求越来越多地通过软件来满足。

## 主要挑战

尽管从云原生技术中获得了很多好处，但是迁移到容器和 Kubernetes 并不是没有潜在的挑战。根据云本地计算基金会(CNCF)最近的一项调查，在这种类型的转型中通常会出现三个关键挑战。

![CNCF: What are your challenges in using/deploying containers? ](img/78502c66566d248c5dc578f4fa2a6750.png)

*来源:* [*CNCF 调查 2020*](https://www.cncf.io/wp-content/uploads/2020/11/CNCF_Survey_Report_2020.pdf)

并列第一，复杂性和迁移到云原生技术所涉及的文化变革。这些类型的变化通常意味着改变开发过程，并可能[将一些责任转移给不同的团队](https://www.fairwinds.com/blog/enable-cloud-native-service-ownership)，迫使工程师学习新的概念，并迫使运营工程师适应“一切如代码”的心态。

第三个挑战与云原生技术的安全性考虑有关。我们正在处理改变您对安全性的看法的新概念和技术考虑，特别是当您在云中运行容器和 Kubernetes 技术时，或者如果您在多云或混合云场景中使用它。所有这一切的复杂性导致安全团队后退一步，真正理解云原生技术带来的新威胁形势。

安全部门需要与开发人员和开发运维人员合作，因此他们不仅需要跟上新变化的步伐，还需要了解这些风险可能存在于何处。当涉及到实际的容器技术本身时，出现了新类型的问题，例如了解这些容器中有哪些已知的漏洞([常见漏洞和暴露(CVEs)](https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures) ，以及了解 Kubernetes 可以被配置为不安全、不可靠或低效的方式。

## 新的决策点和复杂性

转向 Kubernetes 和 containers 引入了许多新的决策点；去年，一篇文章强调了 69%的 Kubernetes 事件实际上与错误配置有关。为了成功地向市场交付产品，您需要一个协作环境来快速解决配置错误的问题。记住:Kubernetes 中的一切都是配置驱动的，安全性是默认内置的 ***而不是*** 。

组织的复杂性是另一个起作用的重要因素。在这个过程中涉及到不同的角色，他们每个人都有不同的问题需要回答，所以让我们站在他们的角度想想:

*   **开发者:**有偿编写代码，构建新功能，将应用交付生产。他们需要对 Kubernetes 和 containers 有足够的了解，以便继续做好他们的工作，将应用程序发布给客户。
*   **站点可靠性工程师(SREs):** 需要确保应用程序的可靠性和稳定性。sre 还需要确保应用程序使用最佳实践进行配置，并启用运行状况探测和运行状况检查，以便应用程序能够在生产中可靠运行。
*   **安全团队:**需要知道组织是否正在运行易受攻击的容器版本，以及应用程序是否被配置为安全的。
*   **工程副总裁:** [需要安全可靠的基础设施](https://www.fairwinds.com/blog/vpes-kubernetes-configuration-audits)来支持下一波增长。

在这些环境中，你需要建立流程并设置防护栏，以满足这些不同角色的需求。

## 安全性和效率的技术含义

对于所有这些团队来说，在他们寻求构建和向市场交付应用程序和服务时，配置是一个需要考虑的因素。对于转向容器和 Kubernetes 的组织来说，什么样的技术含义会影响安全性和效率？堆栈中有几个不同的层，您需要注意其中的错误配置。

*   **容器:**将应用程序与操作系统打包在一起的地方。注意被打包的已知漏洞，无论是在操作系统级别还是在被放入容器的应用程序内部。
*   **部署配置:**这可能是 Kubernetes YAML 或 Helm 图表。注意这一级的错误配置。确保正在设置 CPU 和内存设置，正在为应用程序设置活动和就绪探测，并且没有向这些部署添加不必要的安全权限。
*   **Kubernetes 集群:**可能被错误配置为在互联网上公开访问。确保你有[基于角色的访问控制](https://github.com/FairwindsOps/rbac-manager)。还有许多附加组件需要保持最新，如入口和证书管理。

## 政策和治理如何有所帮助

您可以通过使用策略和治理来帮助防止常见的错误配置。实施策略来检查安全错误配置，例如底层 Kubernetes 集群和附加组件中的漏洞。不断扫描和监控基础设施以发现新的漏洞并根据需要修补，这一点很重要。策略和治理还可以通过确保资源使用效率来帮助您优化成本，例如，检查 CPU 和内存设置以确保您的应用程序拥有足够的计算资源，但不会消耗不必要的资源。

当你创建护栏来防止错误被推向生产时，你也可以在适当的时候向开发人员和做出配置决策的服务所有者提供反馈。您可以使用策略来创建护栏的一些方法示例包括:只允许来自可信存储库的映像，确保设置了 CPU 和内存请求，以及要求健康探测。有不同的方法来[实现策略和治理](https://www.fairwinds.com/blog/make-your-kubernetes-policies-stick-use-an-effective-enforcement-plan)并使您的策略坚持下去，您的选择可能取决于您的组织的规模、您的 Kubernetes 环境的[成熟度等级](https://www.fairwinds.com/kubernetes-maturity-model)以及其他考虑因素。无论您如何进行，您都需要跨团队和集群的可见性，以及有效和一致地管理策略的方法，以便安全和高效地运行 Kubernetes。

[![Use Fairwinds Insights for Free Security, Cost and Developer Enablement In One](img/7c86296320eb01b215d8e2755e9c5b9d.png)](https://cta-redirect.hubspot.com/cta/redirect/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a)