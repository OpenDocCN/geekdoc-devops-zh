# 经由 GKE 从 Heroku 迁徙到 Kubernetes

> 原文：<https://www.fairwinds.com/blog/migrating-from-heroku-to-kubernetes-via-gke>

 利用平台即服务(PaaS)是快速构建、创新和部署新产品或服务的好方法。通过利用 PaaS 供应商的服务器、负载平衡、应用程序扩展和第三方集成，您的工程团队可以专注于构建面向客户的功能，从而为您的业务增加价值。

然而，有一点是，许多组织已经无法满足其一刀切的平台即服务的需求。一些常见的原因包括:

*   性价比
*   控件和自定义
*   平台限制和可用技术

在 Fairwinds，我们经常被问到“我们如何从 Heroku 转移，但仍然支持我们最喜爱的平台功能？”

这是一个很好的问题，也是 Heroku 的一些优势的核心:

*   简单、标准化的滚动部署方法
*   自动化 SSL 证书管理和基础设施扩展
*   机密/配置管理
*   独立的测试环境
*   轻松访问应用程序日志输出

从团队速度的角度来看，这些特性是非常可取的，并且是我们在客户询问交换机时看到的最常见的问题。

# 迁移的目标

让我们深入了解 Kubernetes 如何帮助实现这些特性，以及解决在一刀切的 PaaS 中工作的一些限制。对于这个例子，我们将利用谷歌云平台(GCP)，因为其中一些功能需要云平台的支持才能实现。在 Fairwinds，我们专门从事云迁移和集成，以帮助您在迁移基础架构时获得最大回报。

## 标准化部署和秘密管理

当利用 Fairwinds 的 ClusterOps 服务时，我们会帮助您建立一套基于标准的 Google Kubernetes 引擎(GKE)集群，在此基础上安排您的集装箱化工作负载。我们的一些板载功能包括帮助将您的应用程序放入容器中，以便它可以很好地在 Kubernetes 生态系统中运行。

标准部署由 Helm 和 Reckoner 等工具支持，以支持部署您的工作负载以及 Kubernetes 中的核心基础设施工具。

Kubernetes 本身支持滚动部署，并为您提供了合理的缺省值来定制您想要的滚动策略。除此之外，Kubernetes 还支持 12 因素应用程序，能够将秘密和配置挂载到环境变量(如果需要，还可以挂载到文件)，因此您可以将应用程序配置作为部署资源的一部分进行管理。这一核心工具与 GitOps 相结合，可以帮助您获得更符合您的业务交付需求的 CI/CD 工作流。

Kubernetes 强大的 RBAC 还可以用来在集群中保护您的秘密和凭证的安全。虽然 RBAC 有时很复杂，但是你可以利用另一个叫做 RBAC 管理器的工具来帮助减轻这些复杂性。我们的 ClusterOps on-boarding 还设置了一个核心，通过它可以扩展您的访问策略，允许您的开发人员访问 Kubernetes 以及 CI/CD 等自动化系统。

## 基础设施管理和 SSL 证书管理

您可能知道，当您的应用程序开始被大量使用时，您需要开始增加您的辅助组件，如负载平衡器和数据库。Kubernetes via GKE 进行了深度集成，能够为单个服务自动供应云负载平衡器，并在“入口控制器”下进行统一管理，以便您可以在适应增长时根据需要分割应用的流量。

Nginx-ingress-controller 是我们最常用的工具之一，它允许您将流量路由到集群中的不同容器。如果您正在拆分整体或测试新服务的想法，这可能会特别有帮助。

与 web 服务器负载平衡携手而来的是安全性和加密。如果您从事过运营工作，您可能会经历过客户端面临证书过期的恐慌，以及必须使用正确的凭据更新未知数量的服务器，以便您的客户端不会在其浏览器中显示“站点不安全”消息。Kubernetes 生态系统拥有强大的工具，可以自动为您提供证书，并使用 Let's Encrypt 自动旋转它们，因此您不必担心这一点。这减轻了运营负担，同时保证了您的流量安全。

无论您目前是基于微服务、事件总线还是 monolith(或者三者都是！)，Kubernetes 可以在您成长和变化时提供一些可靠的默认设置，帮助您减轻负担。

## 独立的测试环境

Kubernetes 具有可爱的特性和功能，使您能够分离工作负载，并为您的应用程序提供服务发现上下文。我们最常见的使用情形是在一个群集中同时容纳一个开发环境和一个试运行/生产前环境。这是由 Kubernetes 名称空间实现的。名称空间是分组权限和发现的逻辑边界，有助于减少应用程序配置中的配置差异，并在工作负载之间提供安全隔离。我们的一些 ClusterOps 客户端也有定制的解决方案，允许它们利用特性分支，这些特性分支可以将您的拉请求部署到单独名称空间中的应用程序。

## 访问日志和输出

过渡平台时最大的问题之一是如何访问我调试产品所需的应用程序数据。没有人希望迁移到一个新的系统，并感觉自己失去了对服务于客户端流量的应用程序的可见性。

GKE 上的 Kubernetes 通过自动集成谷歌的日志聚合工具 StackDriver 来提供帮助，所以你不会错过任何这些消息。StackDriver 还支持结构化日志，因此您可以在日志中获得更好的索引和搜索能力。

所有这些日志都可以通过 Kubernetes API 获得，因此您可以从一个端点同时实时传输来自多个容器的日志。

## 临时演员

一旦你在 Kubernetes 中感觉到自己的进步，通常会开始考虑自动扩展工作负载和集群的一些额外功能。幸运的是，GKE 的 Kubernetes 使您能够进行集群节点扩展和工作负载扩展！HorizontalPodAutoscaling 可以帮助您根据所有容器的总负载来扩展您的应用程序，一旦您的集群达到其 CPU 或内存限制，它还可以添加额外的计算节点来帮助您的应用程序在其界限内扩展，但不会在系统负载较低时浪费节点。

# 成本呢？

我们上面概述的很多东西听起来很贵，或者可能会产生一些其他的隐性成本。事实是，由于 Kubernetes 是一种迁移，而不是替代，所以您的一些流程和程序可能会发生变化。需要考虑的一些事情包括使用 Terraform 这样的工具学习基础设施作为代码实践，以及建立对新的自动化交付管道的信心以可靠地交付代码。Fairwinds ClusterOps 是一个坚实的基础和后盾，有助于减轻一些压力，利用行业资深人士和经验来帮助您保持速度和增长。

当您一对一地比较您的平台即服务(PaaS)的资源成本和来自 GCP(和其他地方)的云提供商托管资源时，还可以实现额外的成本节约。我们经常看到每月节省 2 到 5 倍！这再加上更多的灵活性和定制选项，为我们的客户讲述了最好的故事。

云提供商可以通过将 CloudSQL 用于数据库或者将 MemoryStore 用于 Redis 服务器来帮助您避免运营负担。这使您能够专注于不断增长的客户和数据集，而不是专注于数据库管理。

# 摘要

我们希望这篇文章为缓解您从 PaaS 迁移到 Kubernetes 的担忧提供了一个跳板。要了解更多信息，请下载我们的完整指南 : [“从 Heroku 迁移到 Kubernetes”](/migratin-off-heroku)

我们随时可以在 sales@fairwinds.com 或 twitter (@fairwindsops)上发表更多意见。归根结底，我们都需要可靠、可重复的技术解决方案来推动您的业务发展，并且不会增加开销。这些是我们支持并与客户一起创造的解决方案。