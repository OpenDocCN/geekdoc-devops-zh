# 再看亚马逊弹性搜索服务

> 原文：<https://www.fairwinds.com/blog/another-look-at-amazon-elasticsearch-service>

 [亚马逊弹性搜索服务](https://aws.amazon.com/elasticsearch-service/) 是一项托管服务，旨在简化 AWS 云中弹性搜索集群的部署、操作和扩展。当亚马逊 Elasticsearch 服务于 2015 年 10 月日  [发布后不久，我们第一次看到它时，我们并没有留下很深的印象。Amazon Elasticsearch 服务的几个方面和功能当时没有满足我们或我们客户的需求，其中主要的是提供的相当过时的版本和有限的访问控制。](https://aws.amazon.com/blogs/aws/new-amazon-elasticsearch-service/)

我最近又看了一下，许多观察结果令人惊讶(这些观察结果是基于运行  [Kubernetes 5.1.1](https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG.md#v151) 的集群)。下面，我将重点介绍一些观察结果，包括支持的版本、访问控制和更多专用的主选择，以及一些附加功能。

## 支持的版本

总的来说，Elasticsearch 现在比它第一次发布时更流行。  [AWS](https://aws.amazon.com/) 现在提供三个版本的 Elasticsearch，这是我注意到的最大变化。亚马逊 Elasticsearch 服务目前支持 elastic search 1.5、2.3 和 5.1 版本。需要 1.x 版本的用户可以使用 1.5 版本。如果支持最新的 1.x 版本(1.7)就好了，但至少它支持软件的遗留版本。也就是说，让我们面对现实吧——即使是 Elastic 也不再支持那个版本了，所以升级是明智的。

2.3 版是 2.x 系列的发行版。同样，它不是最新的(2.4 是撰写本文时的最新版本)，但它比 1.x 更接近当前版本。我怀疑亚马逊会将该版本升级到 2.4，该版本最初于 2016 年 8 月发布，最近的补丁来自当年 11 月。

大多数努力都集中在 5.1 版(2016 年 12 月)上。5.2 版本于 2017 年 1 月发布。我认为，用不了多久，5.2 就可以在亚马逊上买到了。

对于许多用例来说，这些版本可能就足够了。

## 访问控制

在访问控制方面，变化不大。你有三个选择:

1.  用户访问(选择 IAM 或 AWS 用户/角色)
2.  基于 IP 地址的白名单
3.  签名的请求

关于用户的文档写得很巧妙。它明确指出您需要一个 AWS 帐户(即 root)或一个 IAM 用户。我尝试了一个我们用于实例的 IAM 角色，虽然我能够指定角色，但是访问不起作用。处理这个问题的最好方法可能是让特定的 IAM 用户用于特定的目的，然后使用密码。

使用 IP 地址白名单的访问非常有效。这是让事情运转的最简单的方法。需要注意的一点是，Elasticsearch 实例并不在您的 VPC 中，因此流量总是会到达外部地址。这感觉有点难看，但很实用。请注意不要向任何地方开放白名单的警告。如果您的实例在 VPC 中是私有的，那么将 NAT 网关的 IP 地址列入白名单就很好了。

签名请求可能是最强大的，但也是最难实现的。我不会在这里详细说明，只是说对于我们的用例来说，这意味着大量修改我们客户的代码，这是我们通常不做的事情。还有，卷发也不行。

一旦您限制了谁可以访问，就他们可以访问的内容而言，您还可以做更多的事情。Amazon 允许您限制 URI 路径、HTTP 方法等等。所有这些能力可能对用户访问或签名请求最有用。

最终，签署的请求将使您获得最大的控制权，但是它们需要一些努力。

## 更多专业主选择

Amazon 还增强了关于专用主节点的设置，用于提高集群的稳定性。现在可以指定实例数量和类型了。这是一个很好的功能。拥有三个 t2.small.elasticsearch 实例可以降低成本，并在试图避免大脑分裂时提高信心。

## 附加功能

Elasticsearch 的 AWS 控制台非常不透明，不能让你看到引擎罩下的一切。似乎当您使用相同的设置更新集群时，它仍然会更新内容。这似乎包括更换引擎盖下的所有实例。这有点沉重，但是我在测试中没有发现实际更新的问题。

对集群进行更改似乎需要一段时间。至少需要 10 分钟，这也适用于访问权限的更改。然而，这些变化似乎没有问题。我测试了增加和减少实例数量，使用不同的实例类型(主节点和节点)以及添加和删除 EBS 卷。所有这些行为都干净利落地发生了(尽管，同样，并不迅速)。一个很好的特性是，如果您正在减少实例数量或存储大小，AWS 将检查以确保您有足够的空间。虽然我没有对这个特性进行广泛的测试，但它确实阻止了我在几次测试中试图将太多的数据塞入太少的空间。

也就是说，当我更改 IP 白名单时，发生了一件奇怪的事情。有一段时间，我在收到拒绝许可的错误和成功之间交替，这表明 Amazon 正在使用保守的方法来替换实例。换句话说，在删除现有实例之前，会完全添加新实例。我猜这种方法是从现有资源中适当地腾出数据。这是一个很好的接触。

## 摘要

总体而言，亚马逊 Elasticsearch 服务已经取得了长足的进步。它仍然没有包括几个令人高兴的功能，包括在 VPC 中运行 Elasticsearch 域的能力和 IAM 的完全集成。尽管如此，这是一个非常可靠的系统，可能非常适用于许多用途。