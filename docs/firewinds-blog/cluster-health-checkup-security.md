# 如何解决 Kubernetes 集群安全问题

> 原文：<https://www.fairwinds.com/blog/cluster-health-checkup-security>

 构建一个有效、可靠的 Kubernetes 集群是很困难的。安全地构建它更加困难。通常，让事情正常运行的最简单的方法是忽略安全考虑，或者甚至绕过默认的安全配置。对于资源受限的工程团队来说，一个典型的游戏计划是:(1)让它工作，(2)让它安全。遗憾的是，第二步经常被忽视。

如果您正在运行 Kubernetes，那么您需要考虑一些不同的攻击媒介。不存在不可战胜的集群，因此了解权衡利弊以及最大的漏洞在哪里，对于拥有适合您组织需求的安全配置文件至关重要。

### 拒绝服务

运行云软件时，你将面临的最明显的威胁是拒绝服务(DoS)攻击。请记住，并不是每一次 DoS 攻击都是有意的——有时，只需要一次失控的部署，就可以让您的 API 承受比以前多几个数量级的负载。

您可能认为 Kubernetes 凭借其广泛的自动伸缩特性，可以抵御 DoS 攻击，在一定程度上这是真的。如果您有多余的容量，您的工作负载应该能够扩展以响应流量的激增。如果您正在使用 cluster-autoscaler 之类的项目，您可以在容量开始填满时供应新节点。但是请记住，新的节点是要花钱的，请确保您已经设置了一些硬性限制，以防止成本失控。

你可以采取几个步骤来确保你为意外的流量突发做好准备:

*   在您的应用以及服务网格或入口控制器中设置速率限制。这将防止任何单个机器使用太多的带宽。例如，nginx-ingress 可以限制每秒或每分钟的请求、有效负载大小以及来自单个 IP 地址的并发连接数。
*   运行负载测试，了解应用程序的伸缩性。您将希望在一个临时集群上设置您的应用程序，并对其进行流量处理。测试分布式拒绝服务(d DoS)攻击有点困难，因为流量可能同时来自许多不同的 IP，但有一些服务可以帮助解决这一问题。
*   利用 Cloudflare 等第三方服务来提供 DoS/DDoS 保护

### 外来威胁

如果您有面向公众的应用程序，外人总有可能找到利用您的应用程序逻辑的方法。即使您的应用程序不是面向公众的，您的云中的一个错误配置的网络策略也会突然打开一个全新的攻击媒介。

不幸的是，Kubernetes 无法为您修复代码。但是它可以减轻应用程序中的安全漏洞造成的损害。有几种方法可以确保一个受损的应用程序不会导致全面违规:

*   使用网络策略来限制哪些 pods 可以相互通话。如果攻击者获得了对特定 pod 的访问权限，但它与您的集群的其他部分隔离，他们将无法进一步前进。
*   审核每个工作负载的安全配置。像 [Fairwinds Polaris](https://github.com/FairwindsOps/polaris) 这样的工具将进行检查，以确保工作负载没有以 root 身份运行，它没有访问主机网络的权限，以及其他潜在的不安全配置。
*   使用临时基础映像构建您的映像。如果攻击者无法进行系统调用，这个
    将留给他们很少的工作。

### 内部威胁

并非所有威胁都来自组织外部。持有您的群集钥匙的心怀不满的员工可能会窃取数据或导致长时间停机。如果没有适当的控制措施，以前的员工仍然可以访问您的基础架构。即使每个人都有良好的意图，诚实的错误也会带来灾难性的后果。如果您是一个小型组织，采取措施来防止内部威胁可能看起来有些矫枉过正，但是在发展之前建立良好的安全实践是非常重要的。

防止内部威胁的最重要方法是避免共享凭据。如果每个人都使用相同的凭证与您的集群进行交互，一名员工的离开将会扰乱整个组织。此外，您将无法审计谁做了什么，因此集群中的每个操作实际上都是匿名的。

一旦为与集群交互的每个人提供了单独的凭据，遵守最小特权原则就非常重要。Kubernetes 内置了基于角色的访问控制(RBAC)来帮助您管理谁可以做什么。仅授予个人执行工作所需的资源和操作的访问权限。这不仅对恶意员工有帮助，也有助于防止诚实的错误。

主要的 Kubernetes 服务，如谷歌的 GCP 和 AWS 的 EKS，在他们的 IAM 档案和 Kubernetes 证书之间有一个内置的链接。像 [rbac-manager](https://github.com/FairwindsOps/rbac-manager) 这样的开源项目也可以帮助您保持 rbac 配置的简单和可管理性。

### 包扎

在为 Kubernetes 实现安全策略时，最重要的是坚持最小特权原则。确保将用户限制在合理的范围内，确保 docker 映像尽可能隔离和精简，并确保您的员工只能访问他们完成工作所需的资源。有了合理的措施，即使是应用程序代码中的安全漏洞也可以被限制在一个很小的爆炸半径内。

想要更多吗？[看看这篇文章](https://www.fairwinds.com/blog/security-basics-for-your-first-kubernetes-cluster)，它通过一些实际操作的例子进行了更深入的探讨。

[![Use Fairwinds Insights for Free Security, Cost and Developer Enablement In One](img/7c86296320eb01b215d8e2755e9c5b9d.png)](https://cta-redirect.hubspot.com/cta/redirect/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a)