# CVE-2022-0185:如何识别 K8S 集群中有风险的内核版本

> 原文：<https://www.fairwinds.com/blog/cve-2022-0185-how-to-identify-at-risk-kernel-versions-in-your-k8s-cluster>

 本周公布了 Linux 内核中的一个严重漏洞 CVE-2022-0185。该漏洞使得本地攻击者能够造成拒绝服务(系统崩溃)或执行任意代码。

内核修复于 1 月 18 日发布，并在 1 月 18 日发布的最新 Ubuntu AMIs 中可用。

## **识别 Kubernetes 集群中的内核版本**

如果您是 Fairwinds Insights 用户，您可以使用 OPA 策略检查集群中的内核版本。请注意，这将需要为 OPA 作业添加额外的访问权限，以便能够获取和列出节点。如果你还不是 Fairwinds Insights 的用户，你可以在这里免费注册。我们可以让您使用该软件来帮助解决这一严重漏洞。

## **见解 OPA 政策**

```
package fairwinds

allowedKernelVersion(elem) {
    v := elem.parameters.kernelVersions[_]
    elem.status.nodeInfo.kernelVersion == v
}

unsupportedKernel[actionItem] {
    not allowedKernelVersion(input)

    actionItem := {
        "title": "Kernel Version is Unsupported ",
        "description": sprintf("kernel version %s is unsupported", [input.status.nodeInfo.kernelVersion]),
        "severity": 0.5,
        "remediation": "Update the base image version.",
        "category": "Security"
    }
} 
```

在你的 YAML 中，列出你将支持的版本。例如，如果在 AWS 中使用 Ubuntu AMI，这个内核版本由使用 AMI 的节点报告: `099720109477/ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-20220118`

```
parameters:
  kernelVersions:
    - 5.11.0-1027-aws
targets:
  - apiGroups:
      - ''
    kinds:
      - Node 
```

您可以使用以下命令检查节点状态中报告的内核版本:

```
kubectl get nodes -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.status.nodeInfo.kernelVersion}{"\n"}{end}' 
```

[![Use Fairwinds Insights for Free Security, Cost and Developer Enablement In One](img/7c86296320eb01b215d8e2755e9c5b9d.png)](https://cta-redirect.hubspot.com/cta/redirect/2184645/34aa4987-a1f9-438a-a145-d7d82d5c479a)