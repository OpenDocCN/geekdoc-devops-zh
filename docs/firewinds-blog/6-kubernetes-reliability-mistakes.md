# 你永远不应该在 Kubernetes 第 3 部分:6 K8s 可靠性错误

> 原文：<https://www.fairwinds.com/blog/6-kubernetes-reliability-mistakes>

 正如我们在这个系列的第一篇文章中所概述的，有些事情你绝对不应该在 Kubernetes 上做。[duck bill Group 的首席云经济学家 Corey Quinn](https://twitter.com/QuinnyPig) 与 Fairwinds 的总裁 Kendall Miller 和 Fairwinds 的高级站点可靠性工程师 Stevie Caldwell 进行了一次生动的对话，讨论了开发和运营团队如果想从领先的容器协调器中获得最大收益，就不应该在 Kubernetes 中做的事情。如果你想最大限度地提高 Kubernetes 的可靠性，以下是你需要避免的...

(请记住，这是绝对不应该的，所以标题可能看起来有点奇怪，有点明显，甚至令人惊讶！)

## 1.通过图形用户界面配置所有的东西

通过图形用户界面(GUI)配置一切的问题是，你最终会有一个人 ***也许*** 记得他们按下的所有按钮来设置一切。然后，如果他们不记得这个过程，或者如果那个人离开了，就很难通过点击复制你的环境。您当然可以通过 GUI 进行配置，但是如果您选择这样做，您必须在工作簿中写下所有内容，描述如何完成步骤以及单击什么(和哪里)，然后交叉手指，希望您知道在真正需要工作簿时在哪里可以找到它(也许不要这样做)。

假设一切都倒了，你需要进去重新创建你的集群。通过指向和单击来实现这一点是重建集群的最慢方式。也就是说，从最低级到最高级的设置有一个演变过程，所以你可以从使用控制台开始，点击鼠标。然后你会升级到类似于 [Terraform](https://www.terraform.io/) 或 [CloudFormation](https://aws.amazon.com/cloudformation/) (都是作为代码工具的基础设施)。除此之外，您还可以使用更动态的解决方案，比如云开发工具包( [CDK](https://cdk8s.io/) )，它允许您使用熟悉的语言定义 Kubernetes 和基础设施组件。最后一步是使用控制台。控制台有一个很棒的用户界面，值得使用，但必须有一些东西来捕捉所做的改变并加以整理。有些提供者会这样做，所以如果你改变了什么，你可以点击一个按钮，它就会给出所有设置的代码。

如果你的供应商不这样做(例如 AWS)[控制台记录器](https://github.com/iann0036/AWSConsoleRecorder)是伊恩·麦凯制作和维护的扩展。它位于 Chrome 或 Firefox 中，可以观察你在控制台中所做的一切，然后用你想要的任何语言生成你所做的一切。它还为您刚才所做的事情提供了一个 scope IAM 策略。这是一个非常有用的扩展。

## 2.让你的 SREs 做 RDD

你应该永远不让你的站点可靠性工程师恢复驱动开发吗(RDD)？如果你的运营团队说他们想使用 XYZ，因为它是最热门的新事物 ***因为*** 他们希望能够把它放在他们的简历上，那*可能*不是决定如何建立你的整个基础设施的最佳方式。这并不是说没有很多有趣的技术，你的团队应该有机会探索它，但是，不要仅仅为了让你的简历成为他们的下一份工作而这样做。探索新技术很重要，但不要为了填写简历而牺牲基础设施的可靠性(总有非生产环境可以利用！).

## 3.在库贝内特斯的游牧部落上运行 Docker Swarm

光是这个标题就让你觉得，哇，也许我不该那么做？你是对的——不要在 Kubernetes 上运行 [Docker Swarm](https://docs.docker.com/get-started/swarm-deploy/) 在 [Nomad](https://www.nomadproject.io/) 之上。这听起来很荒谬，但我们已经看到公司试图做同样复杂的事情；他们使用一种工具来完成编排的一部分，使用另一种工具来完成调度，使用另一种工具来完成其他工作。出于某种原因，增加复杂性对一些人来说很有吸引力。在[云原生计算基金会](https://www.cncf.io/)生态系统中，您可以探索许多伟大的解决方案，但目标是降低复杂性和增加可靠性，而不是相反。

## 4.复活节彩蛋单点故障

当我们说复活节彩蛋单点故障时，我们的意思是知道并隐藏真正有趣的单点故障。你永远都不应该藏起来。最常见的例子是“每个人”都知道的未记录在案的事情——直到你环顾四周，发现所有那些知道的人都在别处工作了。

总会有单点故障，问题只是它在堆栈中的位置。即使你认为你已经摆脱了他们，仍然有一些在那里。诀窍是现实地看待如何关闭你的网站，知道你的失败点是什么，而不是隐藏它们。

## 5.在伯尼的周末你的活跃度调查

如果你没有在伯尼的看过[周末，那是一部人们假装死去的东西还活着的电影。这是你不想用你的活性探针做的事情。不要忽视事物已经死亡的事实，目标是确保您的 ***do*** 具有工作的活性探测器，以便您可以相应地做出响应。](https://en.wikipedia.org/wiki/Weekend_at_Bernie%27s)

对于很多商店来说，他们关注的监控系统是 Twitter 或客户支持台。这是他们知道情况不妙的唯一方法。不要那样做。

## 6.“暂时”跳过监控

有很多人只是想进入生产阶段，然后决定以后再研究如何监控。您不应该这样做的原因是，您越早开始监控，您就可以越早获得应用程序应该如何运行的基线。这些数据将为你做出的很多决定提供信息，比如你如何扩展，你的流量峰值在哪里，等等。

监控有助于你提高效率。如果你一直在监控，你的基线将帮助你决定如何配置，如何调整大小，以及如何适当地扩大或缩小规模。

[观看](/never)完全娱乐性的网上研讨会点播，了解你在 Kubernetes 上不应该做的其他事情。

[![Never Should You Ever in Kubernetes](img/257f64e9f957e014bd33223364c91406.png)](https://cta-redirect.hubspot.com/cta/redirect/2184645/3cf32ad5-63de-4c49-92fb-1b13a93ade0b)