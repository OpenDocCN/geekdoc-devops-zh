# 合并层次结构

> 原文：[`refactoringguru.cn/collapse-hierarchy`](https://refactoringguru.cn/collapse-hierarchy)

### 问题

您有一个类层次结构，其中子类几乎与其超类相同。

### 解决方案

合并子类和超类。

之前！合并层次结构 - 之前之后！合并层次结构 - 之后

### 为什么要重构

您的程序随着时间的推移而增长，子类和超类几乎变得相同。一个功能从子类中删除，一个方法移到超类……现在您有两个相似的类。

### 好处

+   程序复杂性降低。更少的类意味着您头脑中需要理清的事物更少，并且在将来代码更改时需要担心的可破坏的活动部分也更少。

+   当方法在一个类中早期定义时，浏览您的代码会更容易。您无需遍历整个层次结构来找到特定方法。

### 什么时候不使用

+   您正在重构的类层次结构是否有多个子类？如果是这样，重构完成后，剩余的子类应成为合并层次结构的类的继承者。

+   但请记住，这可能导致违反*里斯科夫替换原则*。例如，如果您的程序模拟城市交通网络，您不小心将`Transport`超类合并到`Car`子类中，那么`Plane`类可能会成为`Car`的继承者。哎呀！

### 如何重构

1.  选择哪个类更容易删除：超类还是其子类。

1.  如果您决定去掉子类，请使用提升字段和提升方法。如果您选择删除超类，请使用下推字段和下推方法。

1.  将您要删除的类的所有用法替换为字段和方法要迁移到的类。通常这将涉及创建类的代码、变量和参数类型定义，以及代码注释中的文档。

1.  删除空类。

</images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56>

</images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4>

您的浏览器不支持 HTML 视频。

### 厌倦阅读？

不奇怪，阅读我们这里所有文本需要 7 小时。

尝试我们的交互式重构课程。它提供了一种不那么乏味的学习新知识的方法。

*让我们看看……*
