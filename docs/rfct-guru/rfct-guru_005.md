# 如何重构

> 原文：[`refactoringguru.cn/refactoring/how-to`](https://refactoringguru.cn/refactoring/how-to)

重构应作为一系列小改动进行，每次改动使现有代码稍微变得更好，同时保持程序正常运行。

## *正确重构的清单*

*#### *代码应该变得更干净。*

*如果重构后代码依然不整洁……好吧，我很抱歉，但你刚刚浪费了一个小时的生命。试着找出原因。*

当你不再进行小改动的重构，而是将大量重构混合为一次大改动时，这种情况经常发生。因此，特别是在有时间限制的情况下，很容易失去理智。

但这也可能发生在处理极其糟糕的代码时。无论你改进什么，整体代码依然是一场灾难。

在这种情况下，值得考虑完全重写代码的某些部分。但在此之前，你应该编写测试并留出充足的时间。否则，你最终会得到我们在第一段中讨论的那种结果。

#### *在重构期间不应创建新功能。*

*不要混合重构与新功能的直接开发。尽量将这两个过程分开，至少在单个提交的范围内。

#### *所有现有测试在重构后必须通过。*

*重构后测试可能崩溃的两种情况是：*

+   **你在重构过程中犯了错误。** 这显而易见：去修复这个错误。

+   **你的测试过于底层。** 例如，你在测试类的私有方法。

    在这种情况下，问题出在测试上。你可以重构测试本身，或编写一整套新的高层测试。避免这种情况的一个好方法是编写 BDD 风格的测试。****
