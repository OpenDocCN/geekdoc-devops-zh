# 重复观察到的数据

> 原文：[`refactoringguru.cn/duplicate-observed-data`](https://refactoringguru.cn/duplicate-observed-data)

### 问题

域数据是否存储在负责 GUI 的类中？

### 解决方案

然后，将数据分离到不同的类中是个好主意，以确保域类和 GUI 之间的连接和同步。

前！重复观察到的数据 - 前后！重复观察到的数据 - 后

### 为什么重构

你想要为相同的数据提供多个接口视图（例如，你同时有桌面应用和移动应用）。如果未能将 GUI 与域分离，你将很难避免代码重复和大量错误。

### 好处

+   你将责任分配给业务逻辑类和表示类（参见*单一职责原则*），这使你的程序更具可读性和可理解性。

+   如果需要添加新的接口视图，创建新的表示类；你不需要触碰业务逻辑的代码（参见*开闭原则*）。

+   现在不同的人可以同时处理业务逻辑和用户界面。

### 何时不使用

+   这种重构技术在其经典形式中使用观察者模板进行，但不适用于网页应用程序，因为所有类在对网页服务器的查询之间都会被重建。

+   尽管如此，将业务逻辑提取到单独类中的一般原则对于网页应用也是合理的。但这将根据你的系统设计采用不同的重构技术来实现。

### 如何重构

1.  在*GUI 类*中隐藏对域数据的直接访问。为此，最好使用自我封装字段。因此，你需要为这些数据创建获取器和设置器。

1.  在*GUI 类*事件的处理程序中，使用设置器来设置新字段值。这将使你能够将这些值传递给相关的*域对象*。

1.  创建一个域类，并将*GUI 类*中的必要字段复制到其中。为所有这些字段创建获取器和设置器。

1.  为这两个类创建一个观察者模式：

    +   在*域类*中，创建一个用于存储观察者对象（*GUI 对象*）的数组，以及注册、删除和通知它们的方法。

    +   在*GUI 类*中，创建一个用于存储对*域类*的引用的字段，以及`update()`方法，该方法将响应对象的变化并更新*GUI 类*中的字段值。请注意，值的更新应直接在方法中进行，以避免递归。

    +   在*GUI 类*构造函数中，创建一个*域类*的实例并将其保存在你创建的字段中。将*GUI 对象*注册为*域对象*的观察者。

    +   在*领域类*字段的 setter 中，调用通知观察者的方法（换句话说，在*GUI 类*中的更新方法），以便将新值传递给 GUI。

    +   修改*GUI 类*字段的 setter，以便它们直接在领域对象中设置新值。注意确保值不是通过*领域类*的 setter 设置的——否则将导致无限递归。

</images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56>

</images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4>

您的浏览器不支持 HTML 视频。

### 读累了吗？

不奇怪，阅读我们这里所有的文本需要 7 小时。

尝试我们的交互式重构课程。它提供了一种不那么乏味的学习新知识的方法。

*让我们看看…*
