# 将双向关联转换为单向关联

> 原文：[`refactoringguru.cn/change-bidirectional-association-to-unidirectional`](https://refactoringguru.cn/change-bidirectional-association-to-unidirectional)

### 问题

你在类之间有双向关联，但其中一个类不使用另一个的特性。

### 解决方案

删除未使用的关联。

之前![将双向关联转换为单向关联 - 之前](img/798cc372424c2131fa86cfbcb618d86c.png)之后![将双向关联转换为单向关联 - 之后](img/0e008dd4ff7cbff40b3af99c0b584c66.png)

### 为什么重构

双向关联通常比单向关联更难维护，需要额外的代码来正确创建和删除相关对象。这使得程序变得更加复杂。

此外，实施不当的双向关联可能会导致垃圾收集问题（反过来会导致未使用对象的内存膨胀）。

示例：垃圾收集器从内存中移除不再被其他对象引用的对象。假设创建了一对对象`User`-`Order`，使用后被遗弃。但这些对象不会从内存中清除，因为它们仍然互相引用。也就是说，随着编程语言的进步，这个问题变得不那么重要，现在语言会自动识别未使用的对象引用并将其从内存中移除。

还有类之间的相互依赖问题。在双向关联中，两个类必须互相了解，这意味着它们不能单独使用。如果存在许多这样的关联，程序的不同部分变得过于相互依赖，任何一个组件的变化可能会影响其他组件。

### 好处

+   简化不需要该关系的类。更少的代码意味着更少的代码维护。

+   减少类之间的依赖。独立的类更容易维护，因为对一个类的任何更改只影响该类。

### 如何重构

1.  确保以下条件之一对你的类成立：

    +   不使用任何关联。

    +   还有另一种获取关联对象的方法，例如通过数据库查询。

    +   相关对象可以作为参数传递给使用它的方法。

1.  根据你的情况，包含与另一个对象关联的字段应该被替换为参数或方法调用，以不同的方式获取该对象。

1.  删除将关联对象分配给字段的代码。

1.  删除现在未使用的字段。

</images/refactoring/banners/tired-of-reading-banner-1x.mp4?id=7fa8f9682afda143c2a491c6ab1c1e56>

</images/refactoring/banners/tired-of-reading-banner.png?id=1721d160ff9c84cbf8912f5d282e2bb4>

你的浏览器不支持 HTML 视频。

### 厌倦了阅读？

不奇怪，这里所有文本的阅读时间达到 7 小时。

尝试我们的交互式重构课程。这提供了一种不那么枯燥的学习新知识的方法。

*让我们看看…*
