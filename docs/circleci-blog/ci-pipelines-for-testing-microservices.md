# 用于测试微服务的 CI 管道| DeployHub 和 CircleCI

> 原文：<https://circleci.com/blog/ci-pipelines-for-testing-microservices/>

测试微服务与测试单一应用程序应该没什么不同。然而，我们必须应对一些挑战，以使这种转变变得容易。要回答的问题是，“我们如何在一个分解的应用程序上执行功能测试？”

随着我们从单一实践转向 Kubernetes 微服务环境，我们失去了应用程序版本的概念。相反，我们面对的是大量松散耦合的独立函数和 RESTful APIs。虽然 API 契约测试的概念适用于单元测试级别，但是我们还有工作要做，以整合我们的功能测试工具。

## 在功能级别测试微服务

对单个 API 或微服务进行单元测试并不能验证一个完整应用版本的就绪性。由于这个原因，我们不能完全消除功能测试过程。如果我们这样做，我们可能会错过一个微服务使用另一个微服务的旧版本的情况，这将导致负面影响。只有当我们将应用程序作为一个完整的产品进行功能测试时，才能发现这种程度的异常。

在单一环境中，应用程序版本是我们的发布候选。一个新的发布候选启动了我们的功能测试工具所做的工作，这在很多情况下落后于在 API 契约上执行单元测试的开发冲刺。虽然开发团队可能会进行增量编码更改，但是功能测试是基于一个完整的候选发布，并且该候选发布会导致一组完全不同的链接测试用例的执行。在测试微服务时，这种级别的功能测试仍然是必需的和关键的。

理想情况下，即使我们的应用程序构建在一组松散耦合的服务之上，我们也希望保留我们的功能测试。为此，我们需要对逻辑应用程序版本的可见性。为了在功能测试层面保持高效，我们需要对两个应用程序版本之间的变化有所了解，从而使功能测试有针对性。我们希望避免的是，仅仅因为我们没有参考哪个微服务导致了应用版本的新发布，就不断地重新测试一切。

## 重新想象持续集成

在单一环境中，我们依靠我们的应用程序构建(编译/链接)来创建应用程序的新版本，创建新的发布候选。然后，这个新版本被推送到测试团队来执行功能测试。有了微服务，这种构建就不复存在了。相反，我们的构建采用单个微服务并构建一个新的容器映像。然后，该容器映像被推送到容器注册中心。现在我们有了一个新的微服务发布候选，这反过来又创建了一个新的应用版本发布候选。欢迎来到新的[持续集成](https://circleci.com/continuous-integration/)流程。

## 测试微服务

[DeployHub](https://www.deployhub.com/) 在微服务实现中恢复应用版本，以支持您的功能测试。它使用自动配置管理来实现这一点，每次注册新的微服务时，自动创建新的应用版本。由于微服务是共享的，一个新的微服务通常会创建多个应用发布候选。DeployHub 跟踪微服务对所有消费应用的影响。这种影响分析允许 DeployHub 随后通知 CircleCI 启动多个应用程序的测试工作流，提供关于哪些微服务导致了新应用程序发布的详细信息。

## 部署中心球

一旦创建并注册了新的容器， [DeployHub orb](https://circleci.com/developer/orbs/orb/deployhub/deployhub-orb) 就会集成到 CircleCI 中，以执行自动化的配置管理。然后，DeployHub 会自动增加所有受影响应用程序的应用程序版本，并运行每个应用程序的工作流。DeployHub 在应用程序级别使用一个键值对来指定部署的默认测试环境和 CircleCI 测试管道的名称，以便在部署后运行。此外，DeployHub 提供了一个影响分析视图，该视图在每个应用程序级别显示了哪个微服务发起了更改。

## 看看它的实际效果

我们让你轻松了。查看我们的 DeployHub-CircleCI 集成演示。

## 结论

通过将 DeployHub 集成到您的 CircleCI [管道](https://circleci.com/blog/what-is-a-ci-cd-pipeline/)中，测试微服务及其消费应用变得更加容易。测试变得由发布候选事件触发的自动化过程驱动，就像我们在单一环境中所做的一样。您的功能测试套件保持不变，insights 向您展示单个微服务更新对所有应用的影响。

## 关于 DeployHub

DeployHub 使组织能够通过受管的微服务方法实现业务敏捷性。DeployHub 通过提供微服务使用的 SaaS 集中视图以及跨集群和团队的共享，消除了微服务常见的混乱和复杂性。

要了解更多信息并使用 DeployHub CircleCI orb，请在 [CircleCI orb 注册表](https://circleci.com/developer/orbs/orb/deployhub/deployhub-orb/)上找到我们。您还可以在 DeployHub.com 的[了解更多关于 DeployHub 的信息。DeployHub 基于 T4 的开源项目 T5。](http://www.deployhub.com)