# 通过 Code | CircleCI 配置为您的管道添加可追溯性

> 原文：<https://circleci.com/blog/configuration-as-code/>

通过修改纯文本文件来配置应用程序、服务和环境是现代软件开发的标准部分。代码配置(CaC)通过系统地生成、存储和管理配置文件，更进一步。CaC 允许开发团队自动化他们的应用程序和环境的配置管理，同时确保整个开发生命周期的一致性和可追溯性。

在 DevOps 术语中，CaC 意味着在源代码库中定义配置文件以及代码和测试。其思想是，不要在每个新部署的文本文件中手动进行更改，而是在版本控制中以编程方式进行相同的更改，以避免手动错误的风险。这种方法为您的开发过程增加了更多的安全性和自动化层。

在本文中，您将了解什么是 CaC，它是如何工作的，以及它对 DevOps 团队的价值。您还将探索 CaC 与 GitOps 的关系，它如何应用于 CI/CD 管道，以及它如何与作为代码的基础设施进行比较。

使用新的触发器和权限控制来管理您的生态系统中的变化

[Learn More](/blog/announcing-gitlab-support/)

## 什么是配置？

配置是系统的一组标准、属性和设置。开发人员使用配置文件来定义他们的应用程序、基础设施和持续集成管道的设置和参数。

### 应用程序配置

应用程序配置包括一组定义应用程序如何运行的设置。这些设置允许您更改应用程序的行为或功能。现代程序有许多[分布式组件](https://circleci.com/blog/distributed-systems/)托管在云上，运行在托管在多个区域或虚拟机的容器上。如果您将配置设置分散到所有组件中，那么在排除错误或部署过程中，您可能会面临复杂化的风险。应用程序配置意味着从一个安全的中心位置存储和管理您的所有应用程序设置。

### 基础设施配置

基础架构配置是定义和配置支持应用程序所需的物理和逻辑资源的过程。它包括您需要采取的所有步骤，从选择硬件和软件到安装，最后配置它们供您的应用程序使用。

基础架构配置会影响从性能到可靠性和可伸缩性的一切，这些都是构建应用程序时需要考虑的重要因素。

### 管道配置

CI/CD 管道是容器化、源代码控制、监控、配置管理和构建工具的集合。这些工具自动化了应用程序和基础设施的构建、测试和部署过程。管道配置指的是一组描述自动化流程应该如何执行的指令，这些指令反过来会受到应用程序和基础架构配置的影响。这些指令包含在以 [YAML](https://circleci.com/blog/what-is-yaml-a-beginner-s-guide/) 、JSON、XML 或其他格式编写的管道配置文件中。

## 什么是配置即代码？

通常，应用程序代码被提交给版本控制存储库。配置存储在这个存储库之外，开发人员手动创建和定制他们每个部署的配置。

CaC 是不同的，因为配置设置(包括资源供应和环境设置)是在可执行代码中定义的。这意味着您像对待代码一样对待配置设置(包括在版本控制中维护设置),并在管理代码的同时管理配置文件。

CaC 作为 CI/CD 管道的一部分运行良好，自动化了与基础设施维护、供应和软件配置相关的许多方面和任务。这种自动化通过减少开发人员必须执行的容易出错、耗时的手动任务来支持他们。

## 基础设施即代码与配置即代码

基础设施即代码(IaC)是将基础设施视为软件的实践。当您将基础设施视为软件堆栈中的另一个应用程序时，这意味着您可以编写代码来描述基础设施的外观。一旦经过测试，您就可以根据该描述自动创建或销毁基础结构。

IaC 和 CaC 都可以自动提供和配置您的软件，但是它们的方式不同。

在 IaC 中，您用代码对基础设施进行建模，以便机器可以管理它。在部署系统之前，您需要编写脚本来描述您希望系统是什么样子，以及您希望如何配置它。IaC 通常用于自动化物理和虚拟服务器的部署和配置。

在 CaC 中，您在部署应用程序之前对其配置进行建模。当您推出新的软件配置时，您的整个应用程序配置设置都会更新，无需手动干预。CaC 可以用于任何应用类型，包括容器和微服务。

IaC、CI/CD 和合并请求是 GitOps 的[核心实践。GitOps 是一种管理声明性基础设施的方法，它使用 Git 作为唯一的事实来源。使用 GitOps，基础设施变更是软件集成和交付过程的核心组件，您可以将它们集成到同一个 CI/CD 管道中。这种集成使得更改配置更加容易。开发人员需要做的就是创建配置变更并将其推送到源代码控制库。在此 repo 中，使用 CI/CD 工具测试代码，并将更改应用于底层基础架构。](https://circleci.com/blog/ci-with-gitops/)

## 将配置作为开发运维代码的优势

作为代码的配置为开发团队提供了许多好处:

*   降低了配置错误的风险
*   开发过程的标准化
*   提高对应用和基础架构变更的可见性和控制力

### 避免错误配置漏洞

通常，开源软件安全事故的原因可以追溯到[配置错误](https://circleci.com/blog/cloud-misconfiguration/)。这个问题在大规模云环境中非常普遍，在这种环境中，数千甚至数百万个实例需要以完全正确的方式进行配置。CaC 通过实现自动化和促进一致性和简洁性，有助于减少配置错误。

自动化日常流程减少了人为错误，并为开发团队腾出时间来从事更有价值的任务。CaC 提供了跨独特的开发、测试和生产环境轻松更改配置的能力。使用 CaC 的团队可以确信他们在所有环境中以相同的方式部署他们的应用程序。

当所有配置都集中存储时，团队可以很容易地看到他们的更改如何影响他们的基础架构或应用程序环境的其他方面。这有助于确保更改不会破坏其他服务器或网络上的任何内容。当一切都被描述为代码和自动化时，一组明确的指令控制一切，大大降低了部署变更时的错误风险。

### 支持管道标准化

使用 CaC，您可以创建针对所有环境运行相同脚本的管道。这有助于确保所有环境都运行相同的应用程序版本。在实现开发最佳实践时，将配置编写为源代码有助于实现您的目标。您可以优化您的配置以适应最佳实践，例如[安全扫描](https://circleci.com/blog/security-best-practices-for-ci-cd/)、[代码质量分析](https://circleci.com/blog/ci-cd-code-quality-metrics/)和[参数化](https://circleci.com/blog/parameters-in-pipeline-config/)。

如果您维护微服务，您可以使用 CaC 来验证您是否有类似的构建计划。通过实现标准流程，您可以确保您的微服务协同工作。您还有机会检查和测试配置文件，并确保它们在提交到主分支之前遵循了设定的标准。

### 改善合规性和变更管理

CaC 提供了配置项和相关策略之间的可跟踪性。当配置项在部署到生产环境之前必须符合规定时，开发人员必须有一种方法来记录这个过程并证明它发生了。可追溯性通过提供一种创建确保系统安全性和稳定性的策略的方法，帮助 DevOps 从业者改进遵从性和变更管理。

管理 CaC 的监督和法规遵从性方面是用户的一个主要优势。当您有一个配置工件的单一存储库时，在变更点会有一个审计跟踪。这有助于确定谁做了什么改变，他们改变了什么，以及何时改变的。由于可以通过版本控制系统或其他跟踪机制来跟踪和审计变更，因此如果出现问题(意外的或恶意的),可以识别变更并追溯到其发起人。

您可以通过在配置文件中定义合规性标准来实施这些标准。除非被用户或管理员明确覆盖，否则这些文件中的任何更改都将在所有环境中传播。您可以通过以下方式轻松控制应用程序随时间的变化:

*   在配置代码本身中定义基础设施的确切状态
*   审核对该应用程序的配置文件所做的所有更改

这两个过程创建了对应用程序所做的所有更改的可审核记录。通过识别应用程序配置文件在一段时间内出现的任何错误或问题，可以维护对安全标准的遵从，并确保应用程序正常运行。

## 结论

将配置作为代码实现到您的开发过程中可以为您的开发团队提供巨大的好处。它自动化了跨环境应用配置的过程，使应用更新更容易，并确保一切都能协同工作。因为它使用单个存储库，所以更改易于管理和跟踪。配置为代码是一个强大的工具，用于管理和控制复杂的基础设施和管道，同时改进代码的开发和部署。结果是您需要的可见性和控制力，以加速您的开发，而不牺牲您对部署的信心。

CircleCI 使[实施 CaC 方法](https://circleci.com/docs/config-intro/)来管理您的管道、应用程序和基础设施变得简单。你可以[注册一个免费计划](https://circleci.com/signup/)并开始使用 CaC 来使你的开发过程更加稳定、安全和合规。