# 混沌测试:云原生应用的可靠性

> 原文：<https://circleci.com/blog/chaos-testing-for-app-reliability/>

可靠性是软件交付团队的一个关键问题。性能低下或服务中断的每一秒都会带来高昂的成本。其后果不仅仅是金钱上的支出，还会对公司的声誉产生巨大影响。[在 2022 年](https://www.businesswire.com/news/home/20220608005265/en/Uptime-Institute%E2%80%99s-2022-Outage-Analysis-Finds-Downtime-Costs-and-Consequences-Worsening-as-Industry-Efforts-to-Curb-Outage-Frequency-Fall-Short)进行的一项调查中，参与者报告称，超过 60%的数字基础设施故障会导致 10 万美元或更多的损失。

尽管对每一种可能的情况都进行测试可能是不现实的，但是创建可靠的应用程序的重要性给开发人员带来了巨大的激励，使他们在整个软件开发生命周期中实施广泛的测试，以消除错误和模拟故障。

随着应用程序(尤其是云原生应用程序)变得越来越相互关联，越来越依赖于各种各样的系统，预测系统如何响应故障变得更加复杂。云原生应用依赖于跨多个环境运行的许多依赖项和微服务。为了理解这些系统如何相互影响，开发人员必须开发新的解决方案和策略来测试软件。

混沌测试是一种在问题产生之前找到弱点的方法。创造受控的混乱和模拟真实的故障给开发人员和站点可靠性工程师(SREs)一个机会来弄清楚为什么以及如何可能发生中断。

## 什么是混沌测试？

把混沌测试看作一个更大的框架——混沌工程的一个组成部分。混沌工程对应用程序在压力条件下的表现做出假设，然后对应用程序进行模拟实际故障条件的混沌测试。

混乱测试可能包括关闭虚拟机或阻止对微服务的访问。其他 chaos 测试采用了一种更精细的方法，引入了一些问题(如延迟或连接错误)，以研究这些因素如何影响应用程序性能或导致中断。

## 混沌工程的起源

虽然开发人员已经寻找模拟故障的方法很长时间了，但现代混沌工程的概念始于 2010 年代初的网飞。一位名叫 Greg Orzell 的工程师有了一个聪明的想法，他创建了一个工具，可以终止网飞生产环境中的随机实例——允许团队对他们的应用程序进行压力测试。

奥泽尔的工具——现在被称为[混沌猴](https://netflix.github.io/chaosmonkey/)——最终在网飞之外找到了出路，并于 2012 年向公众推出。虽然很新颖，但 Chaos Monkey 是一个简单的工具，在生产或测试环境中通过简单地关闭随机的服务器组来工作。

Chaos Monkey 项目后来扩展成一整套工具，能够创建许多不同类型的混沌测试。被称为[猿猴军](https://netflixtechblog.com/the-netflix-simian-army-16e57fbab116)的这个项目带来了诸如潜伏猴、一致性猴、安全猴等工具，以及各种各样的混沌测试能力来补充混沌猴的基本功能。

## 混沌测试的好处和挑战

通过适当的规划和实施，混沌测试可以识别错误，并为应用程序及其环境提供宝贵的见解。以下是一些主要的好处:

*   **理解系统操作**:一个设计良好的混沌测试可以揭示应用程序如何响应紧急情况的许多有价值的见解。在进行混沌测试之前，工程师首先测量稳定条件，然后制定一个关于系统如何处理特定类型压力的理论。通过将实验结果与理论模型进行比较，团队可以深入了解他们的系统如何工作以及哪些方面可以改进。
*   **增强可靠性**:混沌测试通常可以揭示潜在危害可靠性的缺陷。系统经常以难以预测的方式对故障做出反应。例如，混乱测试可能揭示看似不相关的微服务在停机期间如何相互影响。这对于具有许多离散服务的云原生应用程序来说尤其有用。随着软件变得越来越复杂和相互关联，模拟问题通常是理解系统不同部分如何相互影响的最快方法。
*   **压力测试事件响应**:确保可靠性是主动和被动的同等部分。虽然大部分混沌工程侧重于收集信息，以主动提高可靠性，但它也可以协助反应方面:事件响应。通过混沌测试模拟实际事件，组织有一个难得的机会看到他们的事件响应策略在发挥作用，使他们能够评估其性能并做出调整，以更好地为实际事件做准备。

然而，混沌测试并非没有挑战，包括:

*   **假设和建模失败**:为了使混沌测试有效，首先了解系统的常规操作以及它将如何响应混沌测试是至关重要的。没有一个明确的假设和模型，结果可能是不确定的，混沌测试的洞察力可能是有限的。因此，有必要强调正确规划混沌测试的重要性。
*   意外的损害:有时，测试的“受控”混乱会产生意想不到的后果。在生产环境中进行测试时，如果“爆炸半径”(给定测试的最坏情况)没有得到适当控制，模拟事件有可能变成实际事件。应该采取措施确保混沌测试只影响预期的系统。测试人员应该能够停止混乱测试，并在不造成损坏的情况下将系统恢复到正常运行状态。
*   **不充分的可观测性**:为了使混沌工程有效，测试人员依赖健壮的可观测性工具来监控和记录测试的影响。如果没有合适的工具来监控性能和收集系统指标，混沌测试可能会白费力气，无法生成提高系统可靠性所需的数据。

## 作为 DevOps 的一部分实现混沌测试

混沌工程实验已经迅速成为测试可靠性的主要手段。随着它越来越受欢迎，新的工具和技术已经发展到允许更有效的混沌测试。

像 [Gremlin](https://www.gremlin.com/) 和[混沌网](https://chaos-mesh.org/)这样的平台使得团队能够设计、执行和测量混沌测试。这些工具甚至可以帮助自动化混沌测试的过程。你可以[定期设置测试](https://circleci.com/blog/benefits-of-scheduling-ci-pipelines/)或者配置成随机运行来模拟不可预知的故障。按计划运行自动化混乱测试允许团队定期了解他们的系统如何处理紧急情况。通过定期对系统进行模拟故障，一致的、预定的测试有助于团队了解其可靠性和事件响应的发展。

因为混乱测试经常在生产环境中运行，团队需要设计混乱测试方法来隔离测试的影响。混沌工程师应该试图理解和控制测试的“爆炸半径”。在准备混乱测试时，工程师应该关注对系统的直接受影响部分和任何其他互连服务进行测试的潜在后果。

例如，影响交付前端内容的微服务的测试可能能够运行，而不会产生许多意想不到的影响。相比之下，影响基本网络服务的测试可能会导致更深远和不可预测的问题。

## 增强云原生可靠性

无论您是想确保关键任务系统的可靠性，还是想更好地了解应用程序如何处理故障，混沌测试都可以提供宝贵的数据。在微服务彼此高度依赖的云原生系统中，即使是一个小问题也会产生间接后果，影响远程连接的服务。幸运的是，现代混沌工程工具可以帮助开发人员识别这些系统在发生故障时如何相互影响。

当谈到提高可靠性或压力测试事件响应时，对于导致停机的计划外事件，没有确切的模型。但是，一个设计良好的混沌测试可以提供一个接近的第二，特别是如果设计模拟一个真实的事件。混沌测试允许工程师在受控环境中探索典型或极不寻常的情况，提供可能只有在代价高昂的事件发生后才能发现的洞察力。