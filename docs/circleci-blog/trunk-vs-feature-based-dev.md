# 基于主干与基于特性的开发

> 原文：<https://circleci.com/blog/trunk-vs-feature-based-dev/>

当您是构建软件项目的唯一开发人员时，您可以根据个人偏好创建和修改您的代码。当您向团队运行的项目贡献代码时，您需要遵循一组标准化的指导原则，并与其他团队成员进行精确的协调。标准的指导方针和协调的工作对于每个基于团队的软件开发项目的成功都是至关重要的。

为了满足这一需求，世界各地的工程团队设计了许多开发工作流程。最近，大多数团队使用 Git 来版本化和管理他们的软件代码。基于 Git 的两种最流行的开发工作流是基于主干的开发和基于特性的开发。脸书、谷歌、网飞和许多其他科技企业的团队都使用这些工作流程。

在本文中，我将讨论基于主干和基于特性的开发，目的是帮助您决定哪种工作流适合您的团队。

## 什么是基于主干的开发？

基于主干的开发工作流是开发团队中最流行的开发框架之一。在此工作流中，只有一个分支(主干)被视为主要分支。它保存了项目的可部署代码。

开发人员可以直接将变更推送到主分支，但是如果编码活动需要更多的时间——可能需要几天——他们可以从主分支中签出一个分支，将变更移动到其中，然后在开发完成时将它合并回去。

然后，在将检出的分支与主分支合并之前，其他开发人员必须根据公司的指导方针执行代码审查。检出分支的关键在于它们是短暂的，最多持续两到三天。

在基于主干的工作流中，主分支应该总是生产就绪。错误的代码会破坏整个构建，并导致复杂的开发历史。这意味着团队应该在将代码变更推到主分支之前彻底测试它们。短的开发周期和自动化测试使团队能够识别缺陷并从失败的构建中快速恢复，从而降低风险。

使用基于主干的工作流要求团队中有经验丰富的开发人员。初级或无经验的成员需要对工作流程有充分的了解，才能参与项目。

## 什么是基于特性的开发？

基于特性的开发工作流——或 [GitFlow](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow) —是软件工程的经典方法。开发单个特征是基于特征的工作流的主要焦点。它与基于主干的工作流的主要区别之一是，它从不将代码变更推送到主分支。

在开发一个特性之前，开发人员检查一个“特性”分支，并在那里修改所有的代码。当特性的开发完成时，开发人员创建一个与主分支的合并请求。根据公司的政策，在将功能分支合并到主分支之前，可能会进行代码审查。最重要的是，开发人员从不将代码变更直接推送到基于特性的工作流程的主分支。

基于特性的工作流的优点是数百名开发人员可以在任何给定的时间处理数百个独特的特性。他们可以分阶段进行特性开发，这样多个合并请求就不会相互冲突。

基于功能的工作流有利于经验较少或资历较浅的团队成员。他们可以开发自己的功能，而不用担心破坏产品代码。技术领导、QA 或任何开发团队成员都可以测试每个[合并请求](https://circleci.com/docs/oss/#only-build-pull-requests)的构建。

然而，管理基于特性的开发可能是棘手的，尤其是当多个拉请求排队合并到主分支时。团队领导或高级软件工程师负责快速审查这些请求，并将它们与主代码合并。这种情况有时会导致冲突，使新开发人员感到沮丧，他们可能需要等待更长时间才能获得合并批准。较慢的集成还会导致部署频率较低，失败构建的恢复时间较长，因此产品创新可能会落后。

## 基于主干的工作流在您的 CI/CD 实践中的重要性

基于主干的工作流的最大好处之一是，它们可以与现有的[持续集成和持续交付(CI/CD)](https://circleci.com/continuous-integration/) 服务很好地集成。当您将每个提交推送到主分支时，您可以运行自动化测试(CI 的一部分)来验证新的更改不会破坏主分支。然后，在所有测试成功终止之后，您可以配置一个管道，以便在登台分支上为 QA 团队创建部署。

基于 QA 团队的反馈，发布经理——负责创建新发布的人——可以通过将主分支代码推送到发布分支来发布新的发布。然后，发布经理可以将最新的版本部署到生产环境中。

这种工作流确保了发布分支保持不变，因为每个发布都是唯一的。如果存在生产问题，高级开发人员有时可以创建一个补丁来修补发行版中的错误。

在创建了一个新的版本之后，通过将代码推送到主分支，开发工作将继续到下一个版本。随着时间的推移，旧的发布变得陈旧，团队可以安全地删除相应的发布分支。

大多数团队使用持续集成来测试和构建他们的软件。基于主干的工作流方法与 CI/CD 系统集成得很好。它允许快速迭代，并保持代码随时可以部署。

另一方面，基于特性的开发有很长的开发周期和混乱的集成。审查过程会大大增加实时预览新变更所需的时间。

## 如何在您的项目中实现基于主干的开发

尽管基于主干的开发工作流非常适合许多应用程序，但也有例外。如果您正在进行一个新项目，这个项目要么是一个最小可行的产品，要么是一个概念验证，那么基于主干的工作流可能是一个不错的选择。

团队中的开发人员可以定期推送更改，而无需等待其他人审查和合并拉取请求。唯一的要求是团队中有一些有经验的开发人员，他们可以确保团队不会将任何构建失败的变更提交给主分支。或者，更好的是，自动化 CI/CD 工具可以在推送代码之前检查新代码的错误。

您的开发人员在决定使用基于主干的开发时必须和您一样有信心。但是，在某些情况下，您和您的团队可能需要考虑基于特征的工作流。

例如，有时您必须维护多个软件版本。在这些情况下，基于主干的工作流可能很难实现。Linux 内核是基于特性的开发的经典用例，并且使用长期存在的发布分支。在这种情况下，基于特性的工作流是最明智的解决方案，因为用户可能必须维护 Linux 内核的每个发布版本好几年——甚至可能几十年。

要在项目中实现基于主干的开发，您需要:

1.  Git 版本控制的在线服务，如 GitHub T1。
2.  建立一个主要(主干)分支、一个临时分支和一个生产分支。开发人员将他们的代码推送到主分支，发布经理通过将主分支与试运行或生产分支合并来创建新的发布。
3.  持续集成(CI)系统，用于测试开发人员在发布之前提交的新变更。
4.  连续部署(CD)系统，用于构建项目并将其部署到试运行或生产环境中。

拥有健壮的 DevOps 系统和文化对于任何实现基于主干的开发的组织来说也是至关重要的。随着越来越多的客户使用您的产品，您将会收到更多的错误报告和功能请求。这些通知会让您的开发人员很忙，所以您需要一个系统来测试新的变化，然后再让软件准备好发布。

查看一些[最佳 CI/CD 实践](https://circleci.com/blog/top-5-ci-cd-best-practices/),了解关于建立自动化测试和部署管道的想法。

## 摘要

基于主干和基于特性的开发工作流都有优点和缺点。决定哪种解决方案最适合您的团队取决于团队的集体偏好和经验，以及对团队工作流程的整体适应性。对于采用持续集成最佳实践的团队来说，基于主干的分支模型允许快速迭代和反馈，并且可以在长特性开发周期结束时消除昂贵和耗时的合并冲突。

无论您的团队喜欢哪种开发工作流程，您都将从使用 CI/CD 系统测试和构建软件中受益。[注册一个免费的 CircleCI 计划](https://circleci.com/signup/)开始设置您项目的持续集成和部署管道。