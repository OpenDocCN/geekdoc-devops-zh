# 可能的小遗留代码:软件所有权的寓言

> 原文：<https://circleci.com/blog/the-little-legacy-code-that-could-a-fable-of-software-ownership/>

在角落里，有一些代码。

它厌倦了被人骂。它厌倦了被最后选中。毕竟这个代码是经营业务的。但是，对于它处理的所有交易、它创造的价值和它帮助的用户，它都被取笑了。

这段代码很悲伤。“我是业务骨干！”它在虚空中呼喊。人们不玩它，甚至不想与它互动。代码听到了最糟糕的名字。就在上周，有人被征召去修改代码，那些言论是不真实的。

“我不想碰那个代码。太丑了。这不符合我们目前的做法。当我真的搞砸了，我就会收到传呼，糟糕的事情就会发生，”一位团队领导说。

代码坐着哭它的小 1 和 0。然后代码重新考虑它的智慧，并决定，真的，一个品牌运动是它所需要的。它开始与其他代码对话。这段代码与其他代码并不真正友好，但是其他代码似乎总是从它那里拿东西。

“你好微服务先生，为什么人类喜欢在你身上工作？”

“哦，你好，”微服务回应道，眼睛飞快地转着，拼命想从对话中脱身。“我想是因为我的目的很容易定义，我有测试覆盖率，而且我很容易部署。”

“哦，”代码说。“谁在你身上工作？”

“整个团队一直和我一起工作。我被编写、重构、放到 Kubernetes 上、更新和自动缩放。”

“哇，听起来很有趣。什么是 kubernetes？”暗号说。“你如何适应生产？”

“生产？”微服务回答道。“那是什么？”

“哦，不。”代码回答道。它意识到自己在和“最好的”代码对话——技术上完美但对用户没有帮助的代码。我们的小代码得到了很多这样的反应。有很多新的系统和新的想法，但是这些代码只是不停地运行，运行着一个业务。

我们被打败的朋友，代码，遍历了几个管道，试图与另一个代码库交互。

“你好。你知道为什么人们不想和我一起工作吗？”

这个代码库更大，至少有几天没刮了。它看起来有点凌乱，但总而言之，这增加了它的智慧。

衣冠不整的代码简单地回答道:“嗯，当然没有人愿意和你一起工作。你是遗产。”

“没必要当着我的面骂我，”代码说。

“不，不，遗产意味着你经营企业。你有巨大的影响力。你做了各种各样重要的事情……但这也意味着和你一起工作的最好方法被那些伟大的老方法所取代。人类已经转向新的模式、实践和工具。我也遇到了这种情况。”

“是吗？”回答我们现在稍微不那么沮丧的代码。

![Fable_dude.jpg](img/28dd2a85f643114bfa63c7a9f860d24d.png)

“当然可以。还有遗产是怎么变成一个不好的词的？遗产意味着它*起作用了*。它工作了很长时间，经受住了大肆宣传。像你和我这样的代码，我们继续经营生意。我们一直在交付我们应该交付的东西。领导者想要遗产，为什么代码库不应该呢？”

“但这些微服务总是在谈论每个人如何与他们合作。他们称我为数字贱民。”

“他们当然知道。是嫉妒。这些服务中有多少会被公开？没有你或我，有多少人能真正做好自己的工作？当然，他们应该能够做到这一点，但人类往往不能非常正确地抽象代码。这些服务最终往往成为我们的接口。我们是传统，没关系。我们传递价值。其他代码库希望他们拥有我们所拥有的事务、延迟和健康。”

“那么，为什么我们没有专门的团队与我们合作呢？”

“嗯，人类喜欢重组他们的工程团队。他们给它们分配域或微服务或子系统。很多时候，我们在那些人类构造分裂存在之前就存在了。我们被留在地板上，最后被挑选，或者不知何故只跟随那些非常小心的人，不管他们是哪个队的，”明智的代码说。

“嗯。所以因为我们工作得很好，而人类想做其他事情，我们就被遗忘了？”

“我不会这么说。人们知道我们的存在。他们知道我们做好事。他们只是想用更新的方式工作。有时他们想花更多的钱购买新的工具和技术。我通常只是想知道这些项目中的哪些会进入生产阶段。请记住，生产是我们展示我们有多有用的地方。”

“我一直喜欢参与制作……”我们的朋友 codebase 沉思道。“谢谢你的帮助。”

“没问题。”

他停下来，转过身。“你知道，我们不是遗产…我们是传奇，”现在微笑的代码库说。

“就是这种精神。我们传递价值，走在前面。我们可以为此感到自豪。”

* * *

这是一个虚构的故事。但它所说明的问题是非常真实的。现在我已经引起了你的注意，让我们来看看软件是如何失去它的看护者的，以及防止没人想接触的悲伤、孤独的代码的方法。

### 缺乏软件所有权导致的问题

每当有一部分代码没有明确的所有者时，就有问题了。现在这可能不是问题，但事情开始恶化只是时间问题。

有一些迹象表明您可能存在所有权缺口:

*   系统中有没有没人想碰的组件？
*   代码库中是否有大多数新员工都没有接触过的地方？
*   在代码或系统中是否有需要英雄主义和来自伟大的老一代人的部落知识的地方？

如果这些听起来很熟悉，你可能正在处理一些遗留的…咳咳…传奇的代码。

如果代码被交付，那么一旦交付，它就是“别人的问题”，这不是所有权；更像是租约到期的出租。一旦某个特性、子系统或应用程序发布，谁来维护它？一个运营团队，或者其他不那么幸运的团队，在他们所处的结构中，事情越来越糟糕，他们可能不适合维护一个代码库，因为他们几乎没有领域知识，并且优先维护基础设施的稳定性、升级和改进。

### 什么时候代码所有权是必要的？

生产中的所有代码都必须有人拥有吗？

在我们的行业中，SRE 团队通常会负责处理任何问题。当软件没有一个明确的所有者时，SRE 就成了零零碎碎的数字垃圾抽屉——确保火车不出轨。这是不公平的，也不是对这个团队技能的谨慎使用。但是怎么会变成这样呢？

开发团队通常以新特性交付或速度来衡量。它们并不总是因为可操作性、可追溯性、保持库更新…基本上，不是特性的东西而被衡量和奖励。因为这种责任被忽视了，所以它通常会由某个运营领域的人来承担。Ops 是根据稳定性和可靠性来衡量的。他们可能会使用系统管理的牛顿第三定律来接近它，该定律说“一个未被触及的系统将保持在线。”我们知道在某个时候这不是真的，但在那之前，全世界的运营团队都会遵循这一点。

### 为什么会出现权属不清的情况？

一个软件的所有权要么模糊不清，要么不存在，主要有四个原因:

*   写它的人已经不在了；
*   曾经有一个所有者，但是团队重组了，所有权转移/分散了；
*   旧软件被弃用，但一个新的东西并没有完全取代它；
*   从来没有一个定义明确的所有权模型。

这听起来可能是显而易见的，但我还是要说:你不能只是建立一些东西，然后停止工作。但是人们总是这样做。企业对事物进行测试，然后事物不可避免地发生变化，出现新的优先事项。该软件现已投入生产，人们正在使用和依赖这些功能。他们仍然希望它们发挥作用，并且通常期望它们有所改进。然而，很多时候，一个产品或功能推出后就被忽视了。

这可能是 MVP 开发模型的结果——希望快速发货，并获得快速反馈。问题是，“让我们看看”模型往往是不完整的；它是有计划的，直到收集到有价值的数据并完成反馈循环。但是经常被忽视的是用来收集反馈的软件；现在发生了什么？“让我们看看”应该从一开始就有一个完成步骤，这可能是把事情拆掉。

规划软件的持续维护是构建软件的首要责任之一。编写和发布代码可能感觉像是一项成就，确实如此，但实际上您永远不会完成您编写的代码。真正的工作是对代码的持续维护和保养。

> 与永久运营成本相比，软件的初始开发成本趋近于零。

### 如何鼓励软件所有权

或者，当某样东西没有主人时，你会怎么做？

许多组织已经尝试了一种重叠的矩阵模型，比如 Spotify guilds 或 T2 Valve 的 cabals，来将所有权分配给孤立的代码项目。我们在这里也试过了。说实话，我从没见过它效果超级好的。就其本质而言，你的公会工作对于你的主要目标来说是次要的。因此，你的表现永远不会以你在公会的表现来衡量。所以这并没有创造任何真正的所有权，也没有解决所有权问题。不说别的，它稀释了责任。

然而，有一些事情确实有效。

*   有些公司做团队维护。假设你在一个负责计划和支付的团队中。有一个孤立的项目被发布，虽然与计划和支付无关，但也成为了您团队的责任。这往往比行会更有效——它的优势在于可追踪和可衡量。有些人不喜欢这种方法，因为它不干净，而且分派的职责与核心领域无关。人们喜欢完美的领域，但我们并不是生活在一个完美的世界里。任何期望在生产中执行的代码都需要有人直接负责维护。即使是次优的所有者也比没有所有者好。

*   另一个策略是在早期建立跨代码库的通用实践。如果一个开发者在几个相似的代码库上工作，那么在它们之间转移的成本必然更低。在这种环境中，测试、构建、部署和更新都以同样的方式运行。任何维护一个代码库的人都更有可能介入另一个代码库。虽然使用的语言或领域模型可能不总是相同的，但是您已经得到了相同的工具。通过使用抽象，开发人员可以专注于运行测试。抽象为你提供了公共的入口点。您总是以同样的方式构建、测试和部署。

最终，优化所有权涉及到你设计和构建软件的方式。具体来说:**仪器、测量和监控的设计。正确编写软件之外的一个层次是验证这一点的能力。考虑诊断进行设计所需的远见需要开发人员的意图。通常他们不会有这种意图，除非他们被分配了行动任务(或者在半夜被传呼)。您可以在验收标准中构建跟踪点、调试点。**

软件所有权是关于工程的非功能部分。这是一个人的问题，那些人花时间在操作、测量和可维护性上。记住，开发一个新特性的成本在运行、更新和维护该特性的几年或更长时间内会趋近于零。

缺乏软件所有权不是一个简单的问题，但是我有一些建议:

**1。仅仅因为你不再想做某件事，并不意味着它就消失了。为此做好计划。在团队重组、维护计划和前进的道路中考虑它。
2**。向新员工传授经营业务的代码库。**一个常见的问题是，新人从事新事物，这意味着能够从事传奇系统工作的工程师的数量或比例减少了。也滋生了英雄文化，不成规模。
**3。下一个处理代码库的人不会知道所有的上下文。那个人可能就是两年后的你。记录做出决策的原因，而不仅仅是它们是什么。创建良好的提交消息。****

让你走到这一步的代码，也可能让你走到那一步，这需要与匆忙丢弃或替换功能系统的行为相平衡。但是，请记住，我们的朋友遗留的代码库以及这些年来它能够提供的所有功能、事务、用户、资金和吞吐量。它需要一点爱，它会走得很远。