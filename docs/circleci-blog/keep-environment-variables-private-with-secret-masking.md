# 私钥-秘密环境变量-秘密屏蔽| Circleci

> 原文：<https://circleci.com/blog/keep-environment-variables-private-with-secret-masking/>

在接下来的几周内，我们将推出一个名为秘密屏蔽的新功能。这将使项目和上下文中的环境变量变得模糊，并阻止它们在用户的构建中出现。我们刚刚开始对所有用户进行增量部署，在接下来的几周内，这个特性将在我们所有的资源/执行器类型上启用。

### 这对我有什么影响？

使用秘密屏蔽，如果你不小心`echo`，或者打印了你的环境变量或上下文，我们用`XXXXX`来代替它。在 UI 打印出构建日志之前，CircleCI 会扫描日志的输出，以确保没有打印出与项目或上下文环境变量名称相匹配的秘密。

### 你为什么建造它？

我们的客户要求针对意外秘密暴露的保护措施，我们很高兴现在能够提供这种额外的保护级别。我们认为这是采取主动和明智的安全措施的重要一步。例如，在有许多未知贡献者的开放源码项目中，或者在有许多人在库上工作的大公司中，无意中的秘密泄露可能是一个相当大的问题。在这两种情况下，意外泄露机密的成本都很高。

### 使用秘密屏蔽的安全提示

从 CircleCI 的权限角度来看，有权访问构建的用户被认为是可信的。由于这个原因，秘密屏蔽与[受限上下文](https://circleci.com/blog/protect-secrets-with-restricted-contexts/)很好地配对，因为它限制了被允许授权访问受限上下文组的可信用户的集合。如果一个用户已经可以访问您的源代码，并且可以插入恶意的命令，那么秘密屏蔽将不会对那些用户正在运行的命令提供万无一失的防御。

秘密掩盖在对参与者有信任的模型中工作得很好。有时候，构建脚本很容易和意外地混淆在提交和输出构建秘密中。虽然秘密屏蔽可以有效地防止人们无意中打印出秘密，但它不会阻止任何人使用 SSH 并手动运行`echo`。它也不会阻止某人编写或使用这个秘密，并将值上传到其他地方。

如果你处理的是不可信的参与者，那么切换到一个[分叉模型](https://help.github.com/en/articles/fork-a-repo)并且[不传递任何秘密](https://circleci.com/docs/oss/#pass-secrets-to-builds-from-forked-pull-requests)，或者限制被允许运行注入了秘密的任务的参与者，这要安全得多。

通过结合使用受限上下文和秘密屏蔽，您可以通过防止有意和无意的秘密泄露来实现相当大的安全性改进。

### 需要注意的几个问题:

*   4 个字符以下的秘密不会被屏蔽。
*   值为`true`、`TRUE`、`false`、`FALSE`的秘密不会被屏蔽。
*   这并不妨碍在您 SSH 到一个构建中时显示机密。

如果你没有看到你的团队已经可用的秘密掩蔽，你应该在接下来的几周内获得它。一旦启用，您将可以自动使用它。同时，如果你泄露了秘密，请尽快轮换你的秘密。

### 首次访问

如果你想让你的团队排在访问列表的第一位，请在这里注册:[https://forms.gle/ncmgri9bWSHSLh2k9](https://forms.gle/ncmgri9bWSHSLh2k9)。