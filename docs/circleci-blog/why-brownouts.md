# 限制功能使用:为什么公司故意下线

> 原文：<https://circleci.com/blog/why-brownouts/>

限电是一种有意但暂时的服务中断。为什么一个公司会故意造成停电，什么时候有意义？在这篇文章中，我将解释什么和为什么限电，并提供一些最近的例子。

## 什么是限电？

限电一词来自公用事业行业。对于电力公司及其客户来说，停电(或完全断电)可能是毁灭性的。电力公司的工作人员没有让事情发展到完全中断的地步，而是密切关注停电即将来临的迹象。然后，公用事业公司可以降低每个人的电压，或者在有限的时间内切断某些地区的服务。这种影响与停电有很大不同。例如，电压较低的旧房子中的照明可能会变暗，颜色从正常的黄色逐渐变暗，变成倾斜的棕色。这个想法是，这种“限电”的后果将没有影响每个人的停电严重。

科技行业已经采用了限电概念，并将其应用于服务器和运行在服务器上的服务。如果硬件出现故障，或者如果流量涌入威胁到整个网络，科技公司可能会选择性地限制对其服务的访问。科技公司发现，当一项服务或功能必须逐步淘汰时(也称为“日落”)，限电可以缓解客户的中断。

## 为什么要实施限电？

精心规划和有意识的限电是提醒用户注意关键变化、收集数据和防止未来服务损失的重要工具。以下是 CircleCI 等 SaaS 提供商在计划限电时可能会考虑的一些事情:

*   展示影响的范围
*   了解对间接用户的影响
*   吸引客户的注意力，以便他们能够应对变化

### 展示影响的范围

2022 年 2 月，CircleCI [宣布弃用我们的 Ubuntu 14.04 和 16.04 图像](https://circleci.com/blog/ubuntu-14-16-image-deprecation/)。这些图片将于 2022 年 5 月 31 日删除。这里有一个假设的场景需要考虑:

CircleCI 的客户 SavvyTech 偶然看到了我们的博文，看到了标题。他们查看了他们项目的配置，没有看到任何这些被否决的图像。太好了！他们可能会想“这不会影响我们，我们很好。”

快进到三月底，这些被否决的图像第一次出现限电。由于缺少 Linux 映像，一些项目的 SavvyTech 管道会失败 10 分钟。

*   这里发生了什么？
*   他们为什么会受到影响？

原来他们使用的是旧版本的 [CircleCI orb](https://circleci.com/blog/automate-and-scale-your-ci-cd-with-circleci-orbs/) ，它使用的是一张废弃的图片。这在他们的配置中没有显示出来，但显然仍然会影响他们。一旦 10 分钟时间到了，服务恢复了，他们就开始在日常工作的同时测试一个更新的 orb。

这种情况下的限电向 SavvyTech 展示了图像废弃的全部影响。事实上，影响比他们最初预期的要大。停电造成了 10 分钟的停机时间，而不是几个小时甚至几天，如果他们直到后来才意识到这些图像已被永久删除，这可能会发生。

### 了解对间接用户的影响

技术在许多方面将我们联系在一起。对于科技公司来说，这意味着如果 AWS 出现故障，尤其是`us-east-1`，无论我们是否是 AWS 的客户，我们都会感觉到。涓滴效应可能会影响 Slack、脸书甚至 Spotify，这可能会影响到从开发团队到临时社交媒体用户的每个人。

这种现象使得限电成为提醒非公司直接客户的用户的有效方式。

这里有一个例子。2021 年，JFrog 决定终止他们的 BinTray 托管服务。他们在博客上宣布了这一计划，向客户发送了电子邮件，并采取了其他传播策略。JFrog 没有做的是联系德国的一名开发人员(我将称她为 Molly ),她在 MacBook Pro 上运行一个旧的自定义自制程序。他们为什么要这么做？他们会怎么辨认她？JFrog 还在 BinTray 上运行了一次限电。

Molly 不是顾客，她甚至不知道 JFrog 是什么，但她仍然受到 BinTray 被日落的影响。当莫莉试图`brew install`时，她发现了这个变化，并得到了一个关于 BinTray URL 的错误。原来，家酿使用 BinTray 存储瓶子(二进制)。JFrog 运行的 BinTray 灯火管制提醒了 Molly 和成千上万的其他人，BinTray 即将日落。Molly 接触了家酿社区，并了解到她需要将她的家酿叉子升级到更现代的版本，并且何时需要这样做。

### 吸引顾客的注意力

从本质上讲，灯火管制是一种吸引某人注意力的非破坏性工具。有时电子邮件不会被发送或保持未打开状态，博客帖子不会被阅读，应用内的横幅广告会被忽略。在 DevTools 领域，你试图接触到那些把大部分时间花在终端或 VS 代码上的开发人员，那么你如何接触到他们呢？如果你幸运的话，也许有一个命令行界面可以使用。但有时你甚至没有。

这里有一个我比较熟悉的具体空间:[持续集成](https://circleci.com/continuous-integration/)。通常，开发人员除了他们的编辑器和 GitHub PR 页面之外不会查看任何东西，除非出现故障。

他们可能会跳到 web 应用程序上，看看哪些测试或下载失败了。由限电引起的故障可能是联系一个埋头苦干的开发者的唯一途径，他只是一张接一张地敲掉吉拉的门票。这位开发人员可能太热衷于实现零收件箱，以至于一封夕阳西下的电子邮件在他们看到之前就被删除了。

当谈到贬低重要或广泛使用的功能时，吸引注意力是关键。

## 评估限电风险

当用户的服务被中断时，肯定会有压力。这会引起周围人的不满，尤其是支持团队。但是有什么选择呢？

中断用户服务 10 分钟或 1 小时并不理想。但是，让用户的服务在停产日期前无限期关闭是非常非常糟糕的。取消服务或功能通常是不可逆的，用户所需的操作有时需要时间。在服务被永久移除之前引起客户的注意*,让他们有时间制定计划，然后成功执行该计划。*

## 科技限电的真实例子

以下是一些科技公司最近限电的例子。即使从这一小组例子来看，明确的限电长度和频率仍在测试和完善中。

我们已经弃用了非常旧且不安全的 Ubuntu 14.04 和 16.04 版本。为了提醒用户这些变化，我们计划在 2022 年的 3 月、4 月和 5 月进行限电。关于图片、时间线等更多信息可以在[我们的弃用公告帖子](https://circleci.com/blog/ubuntu-14-16-image-deprecation/)中找到。

GitHub-2021 年 9 月 GitHub [宣布](https://github.blog/2021-09-01-improving-git-protocol-security-github/)他们正在放弃旧的不安全的 OpenSSH 密码。他们继续对这些密码进行了一些限制，最终在 2022 年 3 月停止使用。

JFrog -正如本文前面提到的，JFrog 在 2021 年初弃用了他们的托管服务 BinTray。这导致了该服务在 2021 年 5 月被[永久关闭之前的几次限电。](https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/)

Codecov -经过反复试验，Codecov 为他们的服务推出了一个新的改进的 Bash 上传器。这意味着贬低(和淘汰)旧的 Bash 上传器。他们在这个[博客帖子](https://about.codecov.io/blog/introducing-codecovs-new-uploader/)中解释了原因并提供了计划的细节。

PyPI 不像这个名单上的其他公司，所以没有一个集中的地方让人们去了解细节。尽管如此，PyPI，一个开源项目和 Python 生态系统的一个重要部分，运行他们自己的弃用和限制。这一点在很多地方都得到了传达，包括邮件列表和几个[社区成员博客](https://lzone.de/blog/PyPI-does-brownouts-for-legacy-TLS)。

## 结论

虽然限电不是功能弃用的唯一可用工具，但它们是有效的。限电在以后的弃用过程中特别有用。在一个通知超载的时代，它们不仅是获得你自己的客户的注意和认知的方法，也是获得集成商和下游用户的注意和认知的方法。

正如我在这篇文章中多次提到的那样，CircleCI 最近弃用了旧的不安全的 Ubuntu 图像。这些图像的限电时间安排在 2022 年 3 月 29 日、4 月 26 日和 5 月 19 日。

你可以在这篇博客文章的[中获得更多关于这种形象贬低的信息，并找到全面的限电时间表。本文包含这些迁移指南的链接，帮助您迁移到使用更新的映像:](https://circleci.com/blog/ubuntu-14-16-image-deprecation/)

您可以使用这些资源来发现映像降级对您的团队的影响范围，了解影响，并管理对更安全的新映像的更改。