# Docker 图像与容器:有什么区别？圆环

> 原文：<https://circleci.com/blog/docker-image-vs-container/>

如果你是 Docker 的新手，你可能会发现理解所有的术语很有挑战性。似乎每个人对 Docker 术语的含义都有不同的理解，有时术语会互换使用。

例如，像其他正在学习 Docker 的人一样，您可能想知道 Docker 图像与 Docker 容器有何不同。他们的对比微妙但意义重大。

本文将探讨 Docker 图像和容器之间的差异，帮助您理解如何以及何时使用它们。

## Docker 概述

像 Docker、Flatpak 和 Snaps 这样的解决方案都有一个相同的目标，就是将一个应用程序打包成一个包，安装在任何 Linux 发行版中。

Solomon Hykes 在 2013 年引入 Docker 作为开源项目。他们的第一个商业版本将于 2014 年投入生产。

Docker 容器化平台有助于通过使用容器轻松创建、部署和运行应用程序。可以把容器想象成软件的运输容器——它保存重要的内容，如文件和程序，这样应用程序就可以有效地从生产者交付给消费者。

容器化最大的[好处之一是，它使开发者能够将他们的应用程序与在任何 Linux 发行版上运行所需的所有依赖项打包在一起。这消除了手动安装每个依赖项的需要。](https://circleci.com/blog/benefits-of-containerization/)

多个容器可以同时运行，每个基于相同或不同的图像。Docker 在创建操作系统的多个实例的方式上类似于虚拟机。然而，Docker 允许您创建在相同的操作系统上运行的容器。因此，在给定的硬件组合上，可以运行比虚拟机更多的容器。

Docker 容器甚至可以在虚拟机中运行。与创建虚拟机相比，Docker 提供了一个额外的抽象和自动化层，使其更易于使用。

容器化平台越来越受开发人员和系统管理员的欢迎，因为它包含了应用程序的完整文件系统及其所有依赖项。这种设置支持不可变的基础设施，并保证部署是幂等的——无论您重复操作多少次，它们都将保持完全相同。

Docker 守护进程在后台运行，管理图像、容器等。客户端和守护进程使用套接字或通过 RESTful API 进行通信。

## 什么是 Docker 图像？

图像是只读模板，包含创建容器的说明。Docker 映像创建在 Docker 平台上运行的容器。

可以把一个图像想象成一个运行时容器中内容的蓝图或快照。

图像由多个堆叠的层组成，就像照片编辑器中的层一样，每个层都会改变环境中的一些内容。映像包含运行应用程序的代码或二进制文件、运行时、依赖项和其他文件系统对象。该映像依赖于主机操作系统(OS)内核。

例如，要构建一个 web 服务器映像，从包含 Ubuntu Linux(一个基本操作系统)的映像开始。然后，在上面添加 Apache 和 PHP 之类的包。

您可以使用 Docker 文件手动构建映像，Docker 文件是一个包含创建 Docker 映像的所有命令的文本文档。您还可以使用命令`docker pull [name]`从名为 registry 的中央存储库中，或者从 Docker Hub 这样的存储库中提取图像。

当 Docker 用户运行一个图像时，它会变成一个或多个容器实例。容器的初始状态可以是开发人员想要的任何状态——它可能已经安装并配置了 web 服务器，或者除了作为根用户运行的 bash shell 之外什么也没有。然而实际上，大多数映像都包含一些预配置的软件和配置文件。

Docker 映像是不可变的，因此一旦创建就不能更改。如果需要更改某些内容，请使用所做的更改创建另一个容器，然后将这些更改保存为另一个图像。或者，只需使用现有图像作为基础运行新容器，然后更改该图像。

成功构建应用程序后，Docker 可以进一步将图像导出到其他图像中。彼此派生的映像通常称为父映像和子映像。

一个图像可能有多个标签，但每个标签都是唯一的。标签区分图像，例如 ubuntu:latest 或 ubuntu:14.04。

图像本身不会运行，但是您可以从 Docker 图像创建和运行容器。

## 什么是容器？

容器是一个隔离的地方，应用程序在其中运行，不会影响系统的其余部分，系统也不会影响应用程序。因为它们是隔离的，所以容器非常适合于安全地运行需要访问敏感资源的软件，如数据库或 web 应用程序，而无需向系统上的每个用户授予访问权限。

由于容器在 Linux 上本地运行并共享主机的内核，所以它是轻量级的，不会比其他可执行文件占用更多的内存。如果您停止一个容器，它不会自动重新启动，除非您这样配置它。然而，容器比虚拟机更有效，因为它们不需要整个操作系统的开销。它们与其他容器共享一个内核，并在几秒钟而不是几分钟内启动。

您可以使用容器来打包应用程序及其所需的所有组件，然后将它们作为一个单元发送出去。这种方法很受欢迎，因为它消除了开发、QA 和生产环境之间的摩擦，实现了更快的软件交付。在软件容器中构建和部署应用程序消除了与其他开发人员协作编写代码时“在我的机器上工作”的问题。

这些应用还可以在任何基础设施和云中运行。您可以将应用程序及其底层基础结构与其他应用程序隔离开来。

## Docker 图像与容器

Docker 映像执行 Docker 容器中的代码。您可以在 Docker 映像上添加一个核心功能的可写层来创建一个运行容器。

把 Docker 容器想象成一个运行的图像实例。您可以从同一个映像创建许多容器，每个容器都有自己唯一的数据和状态。

虽然图像不是创建容器的唯一方法，但它是一种常见的方法。

采用容器的一个主要好处是开发、操作和测试的标准化和简化。然而，为了让团队充分利用容器，他们需要确保开发人员、操作工程师和测试人员创建一致的环境。

一个[持续集成和持续部署(CI/CD)管道](https://circleci.com/blog/what-is-a-ci-cd-pipeline/)可以构建、测试和打包容器。然后，部署将该容器分发到运行时环境，在那里它可以作为应用程序的一部分执行。

像 CircleCI 这样的持续集成解决方案使开发人员能够自动化构建、测试和部署。CircleCI 可以[使用 Docker 容器](https://circleci.com/docker/)来更容易地将应用程序部署到多个环境中。

例如，CircleCI 可以[构建 Docker 映像，并将它们推送到 Docker Hub 这样的容器映像注册中心](https://circleci.com/blog/using-circleci-workflows-to-replicate-docker-hub-automated-builds/)。从那里，它可以将图像实例化到 Kubernetes、OpenShift 或其他地方的容器中。

流程是这样的:

*   您提交对 Git repo 的更改。
*   这个提交触发了一个 CircleCI 构建作业，该作业从 Git 中签出源代码，并对代码运行单元测试。
*   如果单元测试通过，CircleCI 会将构建的映像推送到 Docker Hub。
*   如果单元测试失败，CircleCI 会提醒开发人员并停止工作流。

像 [Docker 层缓存](https://circleci.com/blog/config-best-practices-docker-layer-caching/)和[测试分割](https://circleci.com/blog/a-guide-to-test-splitting/)这样的功能也可以帮助您更快地构建和测试您的映像，缩短您的部署时间。有关使用持续集成平台来协调 Docker 构建、测试和部署的更多好处，请访问[如何使用 Docker](https://circleci.com/blog/build-cicd-piplines-using-docker/) 构建 CI/CD 管道。

## 结论

虽然 Docker 图像和容器有相似的目的，但是它们有不同的用途。映像是环境的快照，容器运行软件。

容器和映像都允许用户指定应用程序依赖性和配置，并描述机器运行该应用程序所需的一切。然而，容器和图像具有不同的生命周期。例如，您可以在基于容器的系统(如 Pivotal Cloud Foundry)上使用容器，但不能使用映像。同样，在 Heroku 或 OpenShift 这样的非容器系统中，您可以使用图像，但不能使用容器。

这不是选择容器或图像的问题。它们相互依赖，你需要两者与 Docker 一起工作。

现在您已经理解了 Docker 图像和容器之间的细微差别，您可以充分利用 Docker 平台了。使用 Docker 时，自动化有助于您快速集成，并释放开发人员的时间来创建新的应用程序功能。[了解更多关于 CircleCI 的 Docker 和 Kubernetes 集成如何提高软件开发过程的效率。](https://circleci.com/docker/)