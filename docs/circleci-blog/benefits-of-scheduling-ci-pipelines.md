# 持续集成中计划管道的优势

> 原文：<https://circleci.com/blog/benefits-of-scheduling-ci-pipelines/>

调度是软件开发实践中不可或缺的一部分。用于调度作业的工具可以帮助开发团队节省时间，方法是将周期性任务(如修改数据库或定期发送电子邮件)安排在指定的时间执行。有许多可供选择，包括用于 Linux 的 cron、用于 Windows 的计划任务、用于 macOS 的 launchd、Jobber 和 anacron。在大多数情况下，用户使用设置指令编写脚本，命令在指定的时间执行脚本。

持续集成和持续交付(CI/CD)是另一个重要的工具，它允许开发人员自动化循环过程，如构建、测试、部署和发布软件。 [CI/CD 管道](https://circleci.com/blog/what-is-a-ci-cd-pipeline/)通常由特定事件触发，比如对代码库的新提交。但是在许多情况下，团队可以从根据设定的时间表运行构建、测试甚至部署中受益，而不是作为对变更事件的响应。

调度管道为您提供了常规 CI/CD 管道的所有功能，以及调度任务执行的能力。在这篇文章中，我将解释在持续集成管道中调度作业的一些好处。我还将描述一些常见的用例，您可以实现这些用例来改进您的工作流并优化您团队的开发速度。

## 在持续集成管道中调度作业

自动化是 CI/CD 的基础。许多 CI/CD 管道包含自动将代码从提交到发布的所有必要步骤:构建、标准化、测试和验证、打包、发布、部署和监控。

CI/CD 最大的好处是提高了开发速度和协作。但是如果没有自动化，您的团队将无法实现这些好处。相反，他们将手动标准化构建，以确保只有一个“最新”的软件版本，以防止同时处理多个版本。您必须手动维护所有工件、依赖项和软件性能报告的当前文档。

CI/CD 管道由一个作业队列组成，通常被称为[工作流](https://circleci.com/blog/wide-world-of-workflows-job-orchestration/)，需要执行这些作业来保持您的软件安全、有效和最新。因为自动化是至关重要的，所以如何以及何时触发管道变得同样重要。只要能为您和您的团队带来最大价值，就能触发您的渠道，这对于运营成功至关重要。

对于最佳的流水线触发，传统的链式反应执行方式是不够的。在许多情况下，团队需要根据设定的时间表灵活地执行作业，而不是响应事件触发。因此，计划作业是 CI/CD 管道中的一个自然选择。

有三类工作最常受益于计划管道:

1.  部署工件
2.  测试
3.  维护让我们进一步探讨这三种类型的定期 CI/CD 工作。

### 部署工件

部署工件是 CI/CD 工作的一部分，它受益于自动化和调度。当您手动部署工件时，您负责一致地建立和维护部署时间表。

自动调度使您能够一致且准时地部署您的工件。当您需要按时交付一个构建，以便用户在他们期望的时候得到软件时，这一点尤其重要。

例如，您可以为内部或外部测试人员安排一个每天晚上自动发布的版本——或者为那些想要尝试最新版本并且不介意遇到错误的 beta 测试人员。

有关计划应用程序夜间构建的更多信息，请查看[计划管道](https://circleci.com/blog/using-scheduled-pipelines/)入门。

### 测试

自动化测试新构建的过程至少与自动化其部署同等重要。手动测试浪费了大量的资源，因为它很少有足够的效率来彻底和一致地验证每一个构建。

您可以使用调度作业来运行任何测试，从 QA 到整个测试套件。第二天你就可以对你的软件的功能充满信心。通过调度测试作业，您可以持续运行耗时的测试，这些测试对于每次新提交来说都是低效的。

通过计划测试，您可以在一致的时间运行它们，最适合您的团队的需要。

### 维护

维护在很大程度上依赖于用户生成的数据和软件性能指标。要获得这些，你必须仔细监控你的应用程序，并运行定期扫描。即使您的 CI/CD 工作流没有持续部署，更新发布的频率也意味着您必须找到一种方法来自动监控生产中的软件，尤其是在发布的早期阶段。

通过安排维护，您可以定期、及时地运行必要的性能和安全扫描。这个系统化的过程为您提供了一个整体的工作流程，并提供了您的项目的完全可见性。

## 预定管道的用例

有许多不同的用例受益于调度管道，包括:

*   正常提交-推送周期之外的安全检查
*   刷新和重置资源
*   对构建运行常规 QA 测试
*   数据清理
*   负载测试
*   发送报告和通知

### 正常提交-推送周期之外的安全检查

随着日益频繁和严重的网络威胁，保护您的应用程序免受不良分子的攻击已经成为软件开发的一个重要组成部分。这个过程从软件被构建时就开始了，并且会无休止地继续下去。

大多数 CI 管道只有在代码库收到新提交时才会被触发运行。对于大多数组织来说，这些提交往往相隔几个小时发生。随着漏洞被发现的频率——无论是在您的软件中发现的还是在您的[软件供应链](https://circleci.com/blog/secure-software-supply-chain/)的一个组件中发现的——这已经不够了。您必须定期运行频繁、彻底的安全扫描。

一致性测试通常需要运行自动化的基于安全性的测试。在 CI/CD 中，最佳实践是将这些安全性测试构建到您的 CI/CD 工作流中。

但是，您可能更喜欢将这些安全扫描与其他自动性能和功能测试分开运行。此外，考虑到必须执行的无数安全测试，扫描可能需要比新版本触发的扫描更频繁地运行。在具有严格的[软件合规性要求](https://circleci.com/blog/automate-software-delivery-compliance/)的行业中，以及在管理关键应用程序(如支付平台或收集个人信息的应用程序)时，尤其如此。

在这些情况下，按设定的时间或间隔安排扫描，而不是使用通常用于 CI/CD 管道执行的传统 domino 风格的方法，这一点至关重要。有关如何使用调度管道调度安全扫描的示例，请查看使用调度管道运行常规安全扫描的[。](https://circleci.com/blog/scheduled-security-scans/)

### 刷新/重置资源

重置和刷新资源也受益于自动化调度。作为 CI/CD 管道的一部分，您可以选择一个时间将服务和环境重置为默认状态、归档日志以及重新部署应用程序。因为您的 CI/CD 管道已经可以访问您的环境，所以使用这个功能没有真正的缺点。

### 对构建运行常规 QA 测试

可以说，没有自动化测试就没有 CI/CD。虽然手动测试很重要，但是自动化测试是您的测试团队能够跟上 CI/CD 开发步伐的唯一方法。

通常，组织使用专用于多个项目的 QA 测试的服务器来自动化定期测试。为了使这种方法有效，必须在设定的时间将构建部署到这些服务器上。对于手动测试，在构建可以部署到测试服务器之前，必须有授权的团队成员来触发测试。

有了预定的管道，您可以将此流程纳入 CI/CD 管道。您可以计划在指定的时间将构建部署到您的测试服务器，这将自动触发测试脚本运行，而不会损害您已建立的访问控制，也不需要团队成员的干预。

### 数据清理

如果您的工作流涉及数据处理，您通常会执行数据排序、清理、转换、合并、建模、[数据库备份](https://circleci.com/blog/schedule-mongo-db-cleanup/)和批处理等任务。尽管这些任务可能不是构建，但它们对您的工作流仍然至关重要，并且在您的管道中占有一席之地。对于非调度管道，将这些任务添加到工作流是一项挑战，因为它们通常必须定期运行，而不是等待事件触发。

输入计划的管道。当您可以将任务设置为在预定义的时间运行时，您的数据工作流将成为项目管道的一部分。关于如何使用调度管道来维护和更新数据库的示例，请查看[使用调度管道自动清理数据库](https://circleci.com/blog/schedule-recurring-database-cleanup/)。

### 负载测试

团队依靠负载测试来证明他们的应用程序符合预期的性能标准。负载测试是了解产品在特定现实条件下的行为的最可靠的方法。

在 CI/CD 中，负载测试是每个构建的验证标准的一部分。让这些测试成为你的管道的一部分是有意义的。不幸的是，手动负载测试很难协调和测量，并且实现起来很昂贵。相比之下，*自动化*负载测试允许您安排这些测试在最适合您的团队的时候运行，从而更有效地利用您的资源。

例如，您可以将负载测试安排在非高峰工作时段，以节省资源。或者，您可以将测试安排在高峰使用时间运行，以获得真实世界或现场测试结果。您可以在[使用 k6](https://circleci.com/blog/k6-results-output-and-scheduling-pipelines/) 调度负载测试和持久化输出中了解如何调度重复的 API 负载测试。

### 发送报告和通知

计划管道的另一个主要好处是能够让团队成员和其他利益相关者了解应用程序和其他重要资源的最新状态。通过按计划运行您的管道，您不仅可以将构建工件部署到准备区域进行审查，还可以定期发送电子邮件、更新共享仪表板、发布文档以及执行许多其他类型的报告工作，这些工作可以帮助您的团队的其他成员对您正在进行的工作充满信心。关于如何使用 CI/CD 和调度管道定期自动生成和交付发票的示例，请查看[构建自动发票生成器应用程序](https://circleci.com/blog/build-automated-invoice-app/)。

## 预定管道的好处

正如上一节中的用例所强调的，调度管道为标准的基于事件的 CI/CD 管道提供了理想的补充。使用调度管道，您可以避免不重要或资源密集型工作的作业队列，并安排它们在最合适的时间运行。

调度管道还有助于在整个开发过程中维护应用程序的安全性。应用程序安全性至关重要，及早检测漏洞可以减少平均恢复时间(MTTR)。要检测正常周期和部署周期之间出现的漏洞，您必须持续运行安全扫描并关注其结果。除了资源管理之外，调度管道还提供了改进的保护。

最后，预定的管道有助于让经理、团队成员和其他涉众知道在哪里可以找到最新的构建、性能数据、文档和其他工件。

## 结论

向用户交付最佳软件体验从根本上依赖于管理您的构建和生产过程的 CI/CD 管道的效率。在*和*的情况下，您可能需要按计划执行某些任务，比如定期安全检查和 QA 测试，而不是在事件发生时执行。在这些情况下，您的管道必须做的不仅仅是等待触发器。

CircleCI 的调度管道允许您设计能够从事件触发器执行任务的管道，或者在最符合您的操作模型和开发团队需求的时间运行它们。

当您准备好开始转变您的 CI/CD 工作流程时，您可以[注册一个免费的 CircleCI 帐户](https://circleci.com/signup/)并了解有关如何使用预定管道启动[的更多信息。](https://circleci.com/blog/using-scheduled-pipelines/)