# 数据库测试介绍| CircleCI

> 原文：<https://circleci.com/blog/intro-db-testing/>

在软件开发中，以不同状态处理和存储数据反映了应用程序所基于的业务规则。任何软件应用程序的核心和灵魂都是保存在数据库中以供检索和进一步处理的数据。为应用程序选择的数据库系统(SQL 或非 SQL)必须满足应用程序所需的数据处理和存储需求。有什么比建立一个系统来测试数据库以确定其能力更好的方法呢？

## 什么是数据库测试？

我们已经看了测试代码以及如何正确地[测试 API](https://circleci.com/blog/testing-an-api-with-postman/)，但是我们应用程序的数据层呢？数据库测试是什么？

数据库测试主要包括构建 [SQL](https://en.wikipedia.org/wiki/SQL) 查询来断言和验证数据库应用程序所需的不同数据库操作、结构和属性。

这个过程可能包括验证模式、测试 CRUD 操作和事务，以确保数据库设置正确。这些测试可以是全自动的、全手动的，或者是混合使用手动和自动过程的混合方法。例如，在一个完全手工的测试中，您可以进入数据库管理系统并运行查询来验证假设。或者，您可以测试应用程序 UI，看它在操作后返回正确的数据。

数据库测试人员与应用程序开发人员一起工作，正确测试数据库运行的场景。除了熟悉数据库结构之外，数据库测试人员还应该完全理解应用程序的业务规则。

## 为什么数据库测试很重要？

当应用程序中的数据完整性遭到破坏时，可能会导致巨大的经济损失，进而导致整个企业的崩溃。这些后果的严重性从对数据不太敏感的特性(如一条推文的转发次数)到交易应用程序中股票的实际价值不等。虽然数据库测试不能防止所有的数据泄露或完整性损害，但通过彻底测试用于应用程序的数据库系统，可以减轻最坏的后果。

测试数据库的一些常见原因是:

*   防止攻击，如 [SQL 注入攻击](https://en.wikipedia.org/wiki/SQL_injection)
*   确保网络问题或断电不会影响数据的完整性或导致数据丢失或损坏
*   从数据库中删除错误以保持数据质量
*   验证每一条数据都以正确的格式存储
*   验证数据库中实体之间的关系

和*所以*更多。

## 应该考什么？

一旦你理解了数据库测试是什么以及它为什么重要，你就可以应用你所知道的来确保所有的测试用例都被很好的覆盖。

### create, read, update, and delete

第一组测试用例用于应用程序执行的创建、读取、更新和删除(CRUD)操作。这是为了确保以保证数据完整性的方式存储和检索数据。测试人员可以直接从应用程序界面完成这项工作，或者使用数据库管理系统(DBMS)通过 SQL 数据操作语言(DML)命令运行查询。可以破坏数据库中数据的恶意 SQL 命令也可以在测试环境中运行，以确保数据库免受 [SQL 注入攻击](https://en.wikipedia.org/wiki/SQL_injection)。

### 处理

[事务](https://en.wikipedia.org/wiki/Database_transaction)是敏感的数据库操作，因为它们需要执行不同的查询，并从故障中正确恢复。标准的数据库事务遵循 [ACID 原则](https://en.wikipedia.org/wiki/ACID)。

*   原子的:它必须完成所有的操作或者不执行任何操作
*   一致:数据库的状态必须始终有效，并且必须遵守所有约束
*   隔离:每个事务必须与同时运行的其他事务隔离执行。最终的数据库状态必须是事务按顺序运行
*   持久性:一旦提交事务，不会因为任何原因丢失数据

数据库测试人员创建 SQL 查询来检查和验证应用程序中事务操作的这些属性。这种测试在测试金融应用程序时尤其重要。

### (计划或理论的)纲要

数据库模式是数据库结构的蓝图，测试人员需要非常熟悉它。测试人员可以使用 SQL describe ( `DESC`)命令来揭示数据库模式，以确保它符合应用程序的期望。测试人员还使用正则表达式来验证表字段名称，并验证该值是否符合预期的数据类型。

### 扳机

触发器就像代码中的事件处理程序。当在表上发生操作时(例如，当添加新行时)，可以设置触发器来执行一段代码或查询，以响应刚刚发生的操作。触发器会对某些操作产生级联效应。例如，从数据库中删除用户也可以触发用户的帖子被删除。作为测试人员，您希望确保该操作准确发生，而不是删除其他用户的帖子。

测试人员可以运行 SQL 查询来启动触发级联的原始操作。测试人员也可以从应用程序的界面执行操作，以检查它对数据库记录的影响。

### 其他人

我前面描述的操作并不是唯一可以测试的操作集，它们只是大多数数据敏感应用程序中最重要的一部分。

其他可以测试的操作和属性有:

*   数据库约束
*   存储过程
*   视图
*   指数

## 如何测试数据库

现在我们知道了要测试什么，我们应该如何执行测试呢？令人惊讶的是，运行数据库测试与运行应用程序测试并没有太大的不同。

正如我前面提到的，这些测试可以通过从应用程序 UI 执行操作来手动执行，以确保每次操作后都返回正确的数据，或者通过检查数据库记录来获得操作的结果。您还可以使用一个 [DBMS](https://en.wikipedia.org/wiki/Database#Database_management_system) 来运行您的测试查询并验证结果。

如果您不愿意手动测试，那么您可能会放心，因为自动化数据库测试与应用程序代码的自动化测试非常相似。主要的区别在于，这一次，您的测试运行的是查询，而不是应用程序代码。测试应用程序代码中的以下步骤也适用:

*   准备您的测试环境
*   使用测试运行器运行您的测试(例如 [Selenium](https://www.selenium.dev/) )
*   检查并验证您的结果
*   报告你的主张

这就是为什么数据库测试人员最好的属性是能够为每个需要的测试用例设计 SQL 查询。

## 数据库测试工具

有很多数据库测试工具。您选择的数据库测试工具将取决于以下一个或多个因素:

*   测试策略(手动、自动或混合)
*   数据库类型(SQL 或非 SQL)
*   数据库供应商(MySQL、MSSQL、Oracle 或其他)

大多数数据库测试系统不仅仅由一个工具组成。例如，Selenium 可以与 [TestNG](https://testng.org/doc/) 一起用于 Java 应用程序中的数据库测试。类似地， [SeLite](https://selite.github.io/) 使用 Selenium 测试 SQLite 数据库，而 [SQL Server](https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-data-tools/jj851206(v=vs.103)) 捆绑了用于单元测试数据库的工具。

你可以在这里找到一个数据库测试工具的列表。根据前面列出的因素做出选择。

## 结论

数据库测试是确保应用程序可靠性的另一个测试驱动的开发过程。数据是所有应用程序的核心，确保用户能够信任您的应用程序始于正确获取数据。

编码快乐！

* * *

Fikayo Adepoju 是 LinkedIn Learning(Lynda.com)的作者、全栈开发人员、技术作者和技术内容创建者，精通 Web 和移动技术以及 DevOps，拥有 10 多年开发可扩展分布式应用程序的经验。他为 CircleCI、Twilio、Auth0 和 New Stack 博客撰写了 40 多篇文章，并且在他的个人媒体页面上，他喜欢与尽可能多的从中受益的开发人员分享他的知识。你也可以在 Udemy 上查看他的视频课程。

[阅读 Fikayo Adepoju 的更多帖子](/blog/author/fikayo-adepoju/)