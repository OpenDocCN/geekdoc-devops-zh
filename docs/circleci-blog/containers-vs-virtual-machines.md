# 容器与虚拟机:区别在哪里？圆环

> 原文：<https://circleci.com/blog/containers-vs-virtual-machines/>

在计算领域，[虚拟化](https://circleci.com/blog/top-6-benefits-of-virtualization/)是创建计算机硬件平台、存储设备和网络资源的虚拟版本，而不是物理版本。虚拟化从物理资源中创建虚拟资源，如硬盘、中央处理器(CPU)和图形处理器(GPU)。通过虚拟化资源，您可以将资源网络组合成一个对象呈现给用户。例如，您可以将来自一个或多个来源的数据存储在一个硬盘驱动器网络上，该网络对用户来说是一个单独的驱动器。

虚拟化是一种技术，许多流行的开发工具，如容器和虚拟机(VM)都是基于这种技术构建的。世界各地的组织都依赖于通过这些工具实现的虚拟化的安全性、可访问性和灵活性。在本文中，您将了解容器和虚拟机之间的区别，它们在现代软件开发中各自扮演的重要角色，以及如何将容器和虚拟机整合到您的开发管道中。

## 什么是容器？

有两种类型的容器:应用程序容器和系统容器。系统容器现在已经不太常见了，但在 2015 年 Docker 让容器变得常见之前，它很受欢迎。一般人们讨论容器是指应用程序容器。

容器是一个进程或一组进程，与共享内核上的其他程序相隔离。内核是位于计算机操作系统(OS)核心的计算机程序，通常完全控制系统中的一切。容器是具有虚拟资源的客户操作系统。容器不知道主机操作系统上运行的其他进程。与可以直接访问硬件的主机操作系统不同，来宾操作系统对硬件的访问是有限的，就像主机操作系统上运行的任何其他应用程序一样。

容器[是由名为 images](https://circleci.com/blog/docker-image-vs-container/) 的只读模板构建的，这些模板是从中央存储库中取出来在主机上运行的。

通常，容器运行单个进程或应用程序，尽管它们可以处理多个进程或应用程序。容器通常运行在 Linux 机器上，它们运行在一个单独的名称空间中。这些容器既不依赖于运行它们的机器上的其他进程，也不与它们直接交互。其他操作系统上的实现遵循类似的架构原则。容器与其他过程和设备之间的任何通信都是通过附加的接口软件进行的。

尽管容器封装了它们需要运行的文件和二进制文件，但是它们需要一个容器引擎来运行。有几个基本工具允许用户快速管理和创建容器。

最流行的容器系统 Docker 使用一个守护进程来创建和管理容器。其他容器系统如 Buildah 和 Kaniko 提供了无守护进程的架构。无守护进程的容器构建可以提供更高的安全性，因为 Buildah 和 Kaniko 不需要 root 访问就可以获得完整的功能。然而，这些工具本身不能运行或管理容器。开发人员可能更喜欢像 Docker 和 Podman 这样的工具，因为它们允许用户构建映像、运行和配置容器。

容器很有用，因为它们非常便于携带。大多数常见的容器引擎运行在多种环境中，并且在资源使用方面是轻量级的。因为容器打包了它们需要的所有依赖项，所以不管在什么兼容系统上实现它们，它们都可以一致地运行。这意味着，一旦您从一个或多个容器中构建了一个应用程序，您就可以在许多不同的系统上实现它。

这种可移植性使得容器非常适合需要计算机网络运行相同软件的大型组织。容器也用于进行并行测试，作为持续集成和持续部署(CI/CD)管道的一部分。容器还可以同时运行重复的任务，并将一个大型应用程序的单个进程分成单个的[微服务](https://circleci.com/blog/soa-vs-microservices/)。

## 什么是虚拟机？

像容器一样，虚拟机是一个用于虚拟化的软件。但与容器不同的是，您必须在称为管理程序的软件层之上构建虚拟机。虽然容器是为单个服务制作的隔离进程，但是虚拟机运行完整且独立的操作系统。这意味着单个虚拟机可以处理广泛的任务并同时执行它们，并且可以用于更广泛的用例集。

因为虚拟机创建了一个完整的计算环境，所以您可以在其上安装新软件，并将它们的代码更改为操作系统级别。您甚至可以为处于给定状态的虚拟机创建快照，以便在以后出现问题时将其回滚到该配置。像容器一样，虚拟机与同一硬件上的其他软件是分开的，这使得它们成为软件测试的完美环境。

因为虚拟机分配的资源低于来宾操作系统级别，所以危及一台虚拟机的恶意应用程序不太可能影响主机操作系统或访问机器的固件。这保证了在同一台机器上运行的其他虚拟机的安全。此外，由于您的虚拟机可以使用与其主机设备不同的操作系统，因此您可以使用虚拟机在不同的环境中测试软件。

有许多工具可用于构建和管理虚拟机。最重要的是虚拟机管理程序，它管理一个或多个虚拟机对底层资源的访问。其他工具帮助用户同时创建和管理许多虚拟机。一些开发人员使用预先配置的虚拟机来确保它们设置正确，并拥有启动所需的所有基本程序。

## 容器与虚拟机:您应该使用哪一种？

虚拟机和容器都是具有特定用例的强大技术。两者都提供了安全运行进程的隔离环境，但它们的具体用途不同。

与运行在 VM 中的应用程序相比，容器化的应用程序可以更直接地访问硬件，这使得容器非常适合轻量级用例。假设您希望在多个单独的实例中运行单个流程，或者彼此独立地运行许多不同的流程。在这种情况下，使用容器是有意义的。它们占用的资源很少，因此很容易快速启动并大规模运行。

关注安全性的组织可以在创建容器本身之前安全地检查容器映像，以了解它将做什么。这种透明性使集装箱易于扫描，但这是有代价的。您必须[扫描共享容器中的漏洞](https://circleci.com/blog/adding-application-and-image-scanning-to-your-cicd-pipeline/)以避免在使用这些漏洞的系统中复制这些漏洞。

更新容器化应用程序的每个实例也很容易。您制作了容器映像的更新版本，并根据该更新的映像创建了新的容器。然后，您可以删除过时和不太安全的容器，而不会影响其他进程。您甚至可以自动化更新过程，并依靠容器的快速启动时间来确保每次更新都能快速进行。

容器可以使一些复杂的任务变得简单。例如，您可以使用 Docker 映像和 CircleCI 配置文件轻松构建一个 [CI/CD 管道](https://circleci.com/blog/build-cicd-piplines-using-docker/)。管道使得快速测试一个图像，然后将它推送到 Docker Hub 或另一个容器注册中心变得容易。这让您可以在 CI/CD 管道中从构建到部署快速移动。

容器也方便了[微服务](https://circleci.com/blog/get-an-out-of-the-box-solution-for-the-most-important-services-in-your-pipeline/)的使用。微服务将较大的应用程序分割成较小的进程，为用户提供更大的灵活性，并安全地分离这些进程。在虚拟机上运行微服务将涉及为每个微服务启动一个单独的虚拟机，这是一种低效的资源分配。或者它涉及在同一个虚拟机上运行多个服务，这就失去了隔离的好处。

尽管很受欢迎，容器并没有完全取代虚拟机。在许多情况下，容器补充了虚拟机的使用。如果您想测试一个可能会危及整个操作系统的应用程序，或者需要在不同操作系统上运行的服务之间共享硬件，那么您需要一个虚拟机。因为给定机器上的所有容器共享同一个内核，所以恶意代码更容易危害整个机器。

因为容器依赖于运行它们的内核，所以从容器内部实现操作系统级的改变是具有挑战性的。例如，假设您想从一个容器中用一个`sysctl`命令修改一个系统内核。在这种情况下，您必须给予容器一定级别的特权，这将抵消从隔离中获得的任何安全好处。

相反，您可以使用一个[机器执行器](https://circleci.com/docs/using-linuxvm)从一个 VM 中完成它。这是可能的，因为虚拟机的操作系统安装在虚拟机内，而容器依赖的内核在容器外*。*

 *## CI/CD 中的容器和虚拟机

如前所述，用户可以使用容器在他们的代码中创建一个 [CI/CD 管道](https://circleci.com/blog/guide-to-using-docker-for-your-ci-cd-pipelines/)。

在 CI/CD 中使用容器和 VM 的好处之一是标准化。当多个开发人员为一个程序贡献代码时，如果他们在相同的环境中编写代码，他们就不太可能遇到问题。

团队还可以在虚拟机中部署容器，让它们在相同的环境中构建，同时保持对操作系统级别以下资源的控制。克隆的构建环境也使得包含更大的自动化成为可能，帮助您的 CI/CD 管道尽可能平稳地工作。

容器还可以通过使在机器之间移动和部署代码变得容易来促进 CI/CD 自动化。您可以构建一段代码作为容器映像，并将其作为可读文件部署到中心。像 [Wit.ai](https://circleci.com/case-studies/wit/) 这样的公司将容器集成到 CI/CD 中，以自动化他们的测试和部署管道，从而实现最大效率。

当你想用 Docker 做[漏洞管理](https://circleci.com/blog/how-to-do-vulnerability-management-with-docker-and-ci-cd/)或者自动化新容器的构建时，CI/CD 和容器也可以共生工作。例如，您可以使用容器作为频繁和增量补丁测试的自动化、持续过程的一部分，而不是发布对系统所有部分影响不太清楚的大量更新。这使得管理漏洞变得快速、顺利，并且可以在团队成员之间分配。

虚拟机和容器对 CI/CD 管道的贡献不同。它们协同工作的一种具体方式是使用 VM 作为机器执行器来运行要求更高的容器。已经使用 Docker 执行器的人可能需要[从 Docker 迁移到机器执行器](https://circleci.com/docs/docker-to-machine)。然而，机器执行器的更隔离的环境和对系统资源的更大的访问可以使这一努力变得有价值。

## 结论

从构建到测试到部署，再到漏洞管理，容器和虚拟机与您的 CI/CD 管道协同工作，保持运营平稳运行。

容器和虚拟机是虚拟化程序的两个关键工具。您使用哪一种取决于您需要做什么，并且两者都对促进您的 CI/CD 渠道做出了重要贡献。

通过结合虚拟机的安全性和容器的效率，您可以利用虚拟化的所有优势。通过使用虚拟机来保护您的应用程序和容器，以便在不同的机器之间移动和部署代码，您可以发挥它们的优势。*