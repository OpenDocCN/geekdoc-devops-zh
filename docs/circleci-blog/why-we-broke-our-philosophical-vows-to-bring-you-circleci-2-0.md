# 为什么我们打破我们的哲学誓言给你带来 CircleCI 2.0 - CircleCI

> 原文：<https://circleci.com/blog/why-we-broke-our-philosophical-vows-to-bring-you-circleci-2-0/>

**来自出版商的说明:**您已经找到了我们的一些旧内容，这些内容可能已经过时和/或不正确。尝试在[我们的文档](https://circleci.com/docs/)或[博客](https://circleci.com/blog/)中搜索最新信息。

* * *

几周前，我们发布了 CircleCI 2.0。这是一项巨大的努力，当它全面上市时，CircleCI 的每个人都参与其中。这正是我们作为 CI/CD 公司试图避免的努力。

我们从根本上改变了我们产品的内部结构，这不可能不令人害怕。在第一个客户面前展示这个花了六个月，又花了九个月才上市。很难告诉你达到这个里程碑我们有多轻松，因为这意味着我们实际上又可以开始以小块的形式交付代码了。

那么，作为一家名副其实地以“CI”命名的公司，我们为什么要花这么多时间来精心设计一个真正的版本呢？这难道不违背我们的信仰吗？

是啊！但是我们不得不这么做，因为我们绝对相信持续交付。

## 绿色的田野很可怕

对于我们许多目睹这一切发生的人来说，Joel 的话仍然是正确的:重写代码是一件你永远不应该做的事情。抛开多年的工作，停止开发来建造一个更好的版本是一个可怕的，可怕的决定:那片极具吸引力的绿色田野和它田园般的纯净是在埋藏的放射性废料上生长的。这不是我们做事的方式。

我们习惯了频繁的节奏，以稳定、快速的剪辑完成小功能。主要版本比一般的软件公司更让我们害怕。因此，更换我们整个平台的核心是双重危险的:试图再造我们的产品存在固有的风险，除了更好，我们必须在黑暗中工作几个月，没有持续验证的指导光。

这就像要求一个电视制作团队停止制作剧集并拍摄整部电影:你没有得到一个验证的试播集，你没有衡量每一集，你肯定也没有在飞行中重写故事弧。你只有一次机会和一大笔预算，你最好别搞砸了。

但是很酷。一鸣惊人就好。

## 转折点

我们的基础设施的效率正朝着本地最大值前进。我们可以看到自己和客户需求的未来，但我们看不到通向未来的渐进之路。全球最大值在另一座山上，我们需要一个飞跃。

我们绞尽脑汁，寻找一种方法来逐步更新我们的平台，但我们功亏一篑。最终，我们得出了一个严峻的结论:我们将不得不踏上一段充满危险的旅程——对我们的基础设施进行一次完整的、非持续的改造。

我们意识到，基础架构的改变不会逐渐发生。*狗屎。*

这条道路固有的危险迫使我们认真审视我们的原则:在 CI/CD 的所有好处中，我们能保留什么，我们必须抛弃什么？在重写核心产品的同时，我们如何继续在产品的其他领域取得进展？

我们可能很固执。但是相反，我们问自己这些问题，打破我们的价值观，重建它们就像我们重建 CircleCI 一样。我们投入这个项目是因为我们知道另一面会是什么:更好的持续交付。

我们完全相信这种哲学，因此暂时接受一种相反的世界观是有意义的。通过这样做，我们能够兑现我们对持续交付的承诺。最终，我们不得不迈出一大步，这样我们就可以再次迈出小步，但朝着更高的目标前进。

## CircleCI:我们持续的使命

也就是说，我们充分利用了我们能保持的原则:我们突破，我们限时，当我们失败时，我们很快就失败了。我们构建了工具，因此我们可以在 1.0 和 2.0 上并行运行我们自己的构建，在不中断交付的情况下尽早获得反馈。2.0 的新代码完全建立在 2.0 之上，所以问题不会恶化。我们尽可能快地把一个封闭的阿尔法送到了几个客户手里。打着学习的旗号。

我们学到了。有设计缺陷和架构缺陷，甚至没有任何意义的决策。但这正是我们需要知道的，我们非常感谢有客户帮助我们解决这个问题。

一旦我们解决了早期的问题，我们就进入了封闭测试阶段。beta 版和 alpha 版之间的两个主要区别是:( 1)人们可以请求访问新平台,( 2)我们将测试大规模运营。扩展是它自己的一套学习，但每一步都有助于我们更快地获得更好的产品。最终，我们用公开测试版打开了闸门，这在几周前我们发布 CircleCI 2.0 时结束了。

在整个过程中，我们也尽力约束了范围。我们找到了合适的接缝来插入修改后的构建引擎，同时最小化其他地方所需的更改。我们还通过分支级别的配置公开了新的流程，因此我们可以在不中断客户日常软件交付的情况下征求真实的反馈。

所以，我们并没有*完全*抛弃我们的哲学；不，我们借了所有我们能借的来帮助我们度过一个不舒服和危险的分娩期。但是我们迫不及待地想回到我们对客户需求做出反应和快速发布代码的日常工作中。

不可否认的是，永远继续修补产品是很诱人的，陷入了无休止的完美主义的漩涡。但是我们知道我们需要回到我们的核心理念:不断为我们的客户提供价值。因此，我们承诺将 CircleCI 2.0 作为我们的默认平台，我们已经在它的基础上构建新的东西。

事实上，如果没有 CircleCI 2.0，我们就无法为您带来第一个使用新架构的主要功能 [Workflows](https://circleci.com/docs/workflows/) 。

## 探索陌生的新工作流程

以前的 CircleCI 固执己见:我们告诉你应该如何工作:构建、测试、部署——按照这个顺序。这些阶段被敲进了我们的配置中，无论您的组织喜欢与否，您都必须接受它。如果一次测试失败了，你就不得不从头开始，从头再来一遍。

但是 CircleCI 2.0 允许我们将这些步伐一致的阶段分解成松散耦合的工作，这让我们可以构建工作流。现在你不必每次测试失败都重新编译你的代码；只需从上一次失败的作业重新运行您的构建即可。更好的是，每个作业可以有一个相关的分支和并行级别。在较慢的测试上投入资源，在一些分支上运行测试，并且只部署 master…这个世界真的是你的可配置牡蛎。

我们不再告诉你如何做你的工作——你在告诉我们如何做你在 T2 的工作。

## TL；速度三角形定位法(dead reckoning)

我们为我们所取得的成就感到自豪:基于 CircleCI 2.0 的构建速度非常快，强大的 Docker 支持意味着它可以更好地与我们的客户的工作方式保持一致，并且我们已经将更多的控制权交给了开发人员。但是我们不认为这个“释放”是这个故事的结束；这只是序幕。

现在我们有了这个坚实的基础，我们正跃跃欲试地在它的基础上进行建设。工作流只是我们将用 CircleCI 2.0 构建的一系列功能中的第一个。无论您已经与我们共事多年，还是刚刚加入我们，我们都很高兴能与您同行。

所以，不要再等待伟大的事情发生——去创造伟大的事情。