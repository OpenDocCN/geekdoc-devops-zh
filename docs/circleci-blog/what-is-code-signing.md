# 代码签名:防范供应链漏洞| CircleCI

> 原文：<https://circleci.com/blog/what-is-code-signing/>

在创建应用程序时，开发人员通常依赖于许多不同的工具、程序和人员。参与软件开发生命周期(SDLC)的代理和参与者的集合被称为[软件供应链](https://circleci.com/blog/secure-software-supply-chain/)。软件供应链是指在开发、生产和部署过程中接触或影响应用程序的任何东西，包括开发人员、依赖关系、网络接口和开发运维实践。

因为您正在处理几个移动的部分——包括开源材料、API 等等——所以了解您的软件供应链的每个组件有多安全是至关重要的。加强软件供应链的安全性可以确保源代码在供应链中传播时，不会给网络攻击者或其他恶意攻击者留下渗透的空间。这确保了发布的应用程序的安全性和真实性。

加强安全性的一个重要方法是应用代码签名。代码签名确保最终发布的软件来自原始发布者，并且不包含来自未授权方的篡改。

本文探讨了代码签名，它是如何工作的，以及它在加强应用程序安全性方面的重要性。然后，讨论了对应用程序进行代码签名时的一些最佳实践。

## 什么是代码签名？

代码签名使用应用程序、脚本、驱动程序和其他软件组件的数字签名来确认其原始作者。每当软件的作者进行修改时，他们都会在代码上签名，以确保没有未经授权的行为。

组织通常会签署代码，以确认所有的变更都是真实的和有文档记录的。这种做法保证了用户不会得到有漏洞或安全风险的应用程序。

在团队环境中工作时，代码签名也很有帮助。在整个 SDLC 中交换源代码时，您可以使用代码签名来确保双重身份验证，防止攻击，甚至防止名称空间冲突。

代码签名遵循三步过程:创建公钥-私钥、哈希、描述和验证。

## 第一步:创建唯一的公私密钥

代码签名从创建一个唯一的公钥-私钥对开始，这个公钥-私钥对可以通过 OpenSSL 等工具在本地生成。之后，您将公钥发送到受信任的证书颁发机构(CA ),验证您和您的组织的身份。在 CA 验证这些身份之后，它发回公钥和数字签名的代码签名证书。

## 第二步:散列

在返回代码签名证书和公钥之后，代码经过一个哈希函数。哈希函数是一种单向加密方法，它不可逆地将文本转换为混合值。然后，私钥对散列函数的输出(摘要)进行加密，并防止外部篡改。之后，散列函数、其摘要和代码签名证书被捆绑到签名块中并发送给消费者。

## 第三步:解密和验证

下载软件后，用户的计算机检查代码签名证书以验证其真实性。在验证之后，来自公钥-私钥对的公钥解密来自捆绑签名块的摘要。散列函数然后作用于软件代码，并将结果输出(摘要)与您解密的摘要进行比较。如果两个摘要匹配，则确认该软件可以安全安装。

## 加强应用程序安全性的重要性

在整个 SDLC 中，确保软件安全性仍然是一项持续的任务。通过代码签名等实践来加强应用程序安全性有助于减少攻击面并降低安全漏洞的几率。

最常见的是，SDLC 使用依赖关系来实现最佳功能。这些依赖关系通常还需要其他依赖关系，从而增加了 SDLC 中出现漏洞的途径。

为了帮助降低将恶意软件和其他漏洞引入源代码的风险，您应该只下载来自可信供应商的第三方软件和依赖项。依赖混淆和简单的[配置错误](https://circleci.com/blog/cloud-misconfiguration/)会迅速破坏你的代码签名实践。因此，在实现依赖关系时，一定要小心谨慎。

攻击者也可能使用[域名仿冒](https://support.microsoft.com/en-us/topic/what-is-typosquatting-54a18872-8459-4d47-b3e3-d84d9a362eb0)。攻击者使用这种技术来锁定在 web 浏览器中输入错误或拼写错误的 URL 的互联网用户。访问这些网站可能会将恶意软件下载到计算机系统中，或者允许访问敏感信息。

## 苹果应用商店和谷歌 Play 商店的代码签名

作为软件分发平台，苹果的 App Store 和谷歌 Play 商店要求开发者在向潜在用户进行商业分发之前对应用进行代码签名。要了解代码签名的实际工作方式，并强调其安全性优势，请考虑苹果应用商店和谷歌 Play 商店如何在其移动应用版本和更新系统中实现代码签名。

在[谷歌 Play 商店](https://developer.android.com/studio/publish/app-signing)上发布应用程序之前，您必须签署您的代码。为此，您必须生成一个密钥，由每个用户的设备包管理器和谷歌 Android 包套件(APK)进行检查。这个密钥是 Google 验证应用程序及其更新的真实性和来源的方式。

以前，开发人员负责管理这些密钥的安全性。现在，谷歌提供了 Play 应用签名，它将用于将您的工件上传到 Google Play 的上传密钥与您的应用签名密钥(有助于将 apk 签名到分布式设备)分开。通过 Play 应用程序签名，Google 将应用程序签名密钥存储在其安全基础架构中，从而提高了安全性。

[苹果的应用商店](https://developer.apple.com/support/code-signing/)采用非对称加密技术(公钥和私钥)来确保发布到其平台的应用程序的安全性，用于其代码签名过程。首先，您(作为应用程序发行者)必须在本地机器上创建一个证书签名请求(CSR)。一旦您制作了 CSR，本地设备就会生成一个公钥-私钥，将公钥附加到 CSR，并下载一个用于向 Apple 申请证书的 certSigningRequest。请记住，证书只能使用为其生成的私钥。

然后，您下载证书并将其推送到钥匙串，钥匙串与他们的私钥配对。证书和私钥共同构成了用于发布 iOS 应用程序的代码签名身份。

## 代码签名最佳实践

这里有一些代码签名的最佳实践，以确保您的应用程序代码是安全的。

### 确保私钥的安全

当代码签名私钥暴露、丢失或泄露时，就会出现严重的安全威胁。泄露的密钥赋予黑客和恶意用户很大的权力。暗网上也需要这些代码签名证书密钥。

避免这种情况的一些常见方法包括:

*   仅授予授权人员访问密钥的权限
*   通过采用物理安全控制和限制可以访问私钥的计算机数量来限制对私钥的访问
*   使用加密硬件产品来保护密钥

### 使用严格的访问角色和权限

实施严格的策略和角色，确保只有获得授权的人才能访问私钥，以限制风险暴露。此外，如果您使用日志来执行事件报告的审计，那将是最好的。

### 使用 CI/CD 自动化签名流程

自动化代码签名流程涉及一种端到端的集中式方法来执行代码签名工作流，同时实施安全策略。这一自动化流程使用粒度访问控制，并与 [CI/CD 管道](https://circleci.com/blog/what-is-a-ci-cd-pipeline/)集成，而不会降低 SDLC 的速度。

通过使用连续签名(CS)通过 CI/CD 管道自动进行代码签名，可以确保端到端的安全性。借助 CS，当代码通过 SDLC 的不同阶段时，集中式证书管理器会自动部署代码签名证书。此过程消除了停止开发周期以生成代码签名证书的需要，从而提高了开发速度。

您可以使用 CI/CD 工具来应用 CS，这些工具在管道的每个阶段执行安全检查，例如 [CircleCI runner](https://circleci.com/blog/code-signing-with-runner/) ，它有助于在 CS 期间保持证书的安全和签名。通过使用 CS，您可以有效地提高开发生命周期的速度，并确保您发布的产品是安全的，同时维护自动化、高效的 CI/CD 管道。

### 对代码使用时间戳

当您使用代码签名证书对代码进行签名时，它会附加附加数据(即时间戳)来记录签名时间。这个时间戳有助于在使用时向用户保证代码签名证书的有效性，提高整体安全性，并使用户在使用您的应用程序时感到安全。

### 签名前扫描代码中的病毒和漏洞

虽然自动化有助于提高总体生产力，但这也意味着审查实际代码的工作量减少了。在某些情况下，这为漏洞留下了空间。为了防止这种情况，您可以在提交源代码之前仔细扫描软件代码中的病毒和其他漏洞。这种实践有助于检测潜在的风险并提高代码质量。例如，你可以使用像 [Snyk orb](https://docs.snyk.io/more-info/getting-started/snyk-integrations/circleci/scan-terraform-with-the-snyk-orb/add-the-snyk-orb-to-your-circleci-config) 这样的工具来[扫描你的代码库的漏洞](https://circleci.com/blog/security-with-snyk-in-the-circleci-workflow/)。

## 结论

您的软件供应链很可能是复杂的、相互关联的、冗长的。因此，它很容易受到攻击和利用。漏洞可能是无辜的，也可能是无意的，就像错误配置或意外输入错误一样。它们可能是严重的，有针对性的，因为攻击者将恶意代码注入到您的软件中，在发布后导致严重的网络攻击。

代码签名是确保软件供应和分发链安全的一个重要组成部分，也是向用户保证已发布应用程序安全的一种方式。此外，您可以将代码签名用于与安全相关的目的，例如防止易受攻击的依赖项的恶意软件攻击。

为了确保您的应用程序是安全的，并使您的代码签名工作彻底而有效，请遵循最佳实践，例如维护安全密钥、扫描漏洞以及在签名时使用时间戳。当您准备好加速和扩展您的软件构建、测试和代码签名实践时，将持续集成工具整合到您的开发工作流中。你可以从今天[注册一个免费的 CircleCI 账户](https://circleci.com/signup/)开始。