# 设计分布式系统的技巧

> 原文：<https://circleci.com/blog/distributed-systems/>

随着公司期望软件产品能够处理不断增长的请求量和网络带宽使用量，应用程序必须为规模化做好准备。如果你需要快速交付的弹性、资源节约的系统，是时候设计一个[分布式系统](https://en.wikipedia.org/wiki/Distributed_computing)了。要成功地构建一个异构的、安全的、容错的、高效的分布式系统，您需要有责任心和一定的经验。本行动手册将帮助您避开可能破坏您的设计工作的常见问题。

在我们开始设计您的分布式系统的技巧和最佳实践之前，回顾一下软件架构的发展可能会有所帮助。

## 软件架构简史

想象一下所有不同的、复杂的和(现在经常是)物理上遥远的组件和服务，它们必须相互通信，以确保谷歌地图把你带到堪萨斯州的曼哈顿，而不是纽约的曼哈顿。

这个行业并没有在一夜之间达到这种效率和及时性。相反，一系列需求驱动的进步让我们走到了今天。当我们回顾和欣赏迄今为止的旅程时，我们可以更清晰地展望(并最终创造)未来。

### 整体设计

过去，当应用程序开发人员希望他们的应用程序处理大型数据集时，他们会构建基于大型机的应用程序。这种方法在个人电脑(PC)使用不广泛，最终用户比普通消费者有更多的电脑经验时是有效的。

随着个人电脑变得越来越普遍，用户群变得越来越缺乏经验，可以在独立机器上运行的直观软件程序变得越来越重要。这种独立性带来了新的挑战:应用程序到应用程序的通信。我们用网络计算的进步来应对这一挑战，比如基于网络协议的远程过程调用:传输控制协议和互联网协议(TCP/IP)。

然而，出现了环境限制。用户在许多不同的操作系统、硬件平台和网络协议上部署应用程序。这种多样性进一步增加了应用程序间交互和数据共享的压力。

分布式计算成为不可避免的下一步。

### 分布式计算

在分布式计算软件体系结构模型中，独立开发的对象和组件构成由网络基础设施连接的应用程序。这种网络基础设施支持和管理功能之间的通信，而不管它们的网络位置如何。

不同的组件和对象可以驻留在不同的计算机上。这些组件只需要对应用程序透明，并像调用它们的应用程序一样进行交互。

### 客户机-服务器体系结构

客户机-服务器体系结构是分布式计算的先驱。在其两层设计中，上层管理应用程序的用户界面(UI)和业务逻辑(客户端)，而下层管理组织和数据管理(服务器)。

UI 和业务逻辑必须与数据库服务器紧密耦合，以便顺利访问数据。像企业资源规划(ERP)软件这样的应用程序通常使用这种模型，其中客户端与中央数据库服务器的交互对于业务流程至关重要。

然而，客户机-服务器应用程序有其缺点。由于算法和逻辑在客户端，保护应用程序免受黑客攻击是一个巨大的挑战。客户的个性和频繁的呼叫使得系统维护成本高，资源密集(相对于今天)，并且难以扩展，特别是对于复杂的业务流程，

值得注意的是，客户机-服务器系统仍然存在，尽管它们最适合于面向数据库的独立应用程序。开发人员通常应该避免使用这种架构来构建相当大的面向组件的应用程序。

### 面向服务的架构(SOA)

我们已经从传统的客户机-服务器体系结构走了很长一段路。随着. com 时代的到来，开发人员创建了面向服务的体系结构来升级传统的客户机-服务器体系结构。

在这种体系结构中，应用程序组件通过网络进行通信，相互提供服务。虽然 SOA 架构为我们带来了业务价值和可重用、松耦合服务的额外好处，但它们仍然依赖于规模有限的整体系统。

随着业务需求逐渐超过 SOA 价值，我们不可避免地要寻找更好的东西。

### 微服务架构

在微服务架构中，开发人员将应用构建为离散服务(模块)的集合，并通过高效的通信协议将它们绑定在一起。开发人员将应用程序分成独立的模块，处理业务流程的不同方面。

这些单独的模块可以使用不同的数据库，用不同的编程语言编写，存储在不同的计算机上，并且可以独立部署。

## 分布式系统最佳实践

尽管越来越多的应用程序正在采用分布式架构，但发现一个应用程序在设计时以微服务开始，但在部署时却以近乎整体的形式结束的情况并不少见。遵循这些最佳实践应该有助于避免这种结果。

### 最佳实践 1 -根据功能拆分服务

您必须做的第一件事是有效地组件化您的应用程序。

理想的组件是一个软件单元，您可以在不依赖于应用程序的其他单元的情况下开发和管理它。在微服务中，这意味着将您的应用程序分解成其组成服务。

构建分布式系统的目标是开发一个像编排一样执行的应用程序:即使每个部分都保持独立，它也必须与整体保持同步。我们希望能够隔离表现不佳的成员或修改序列，而不会无意中影响其他成员。

### 最佳实践 2 -明确定义服务界限

在软件世界里，就像在许多其他感兴趣的领域一样，你必须注意组成整体的部分。如何将应用程序分解成组件服务将影响流程同步和功能间的通信。

### 最佳实践 3 -确定分布式服务如何通信

在微服务中，组成服务的是进程外组件。它们通过 web 服务请求或远程过程调用进行通信。

您应该尽量减少服务之间的通信，但是，如果您的服务需要进行几次外部调用，例如像支付网关，这个限制是不可能的。

### 最佳实践 4 -选择交互式还是批处理

您的微服务需要相互通信以及与其他应用程序通信，因此要确定最佳的数据处理策略。

当最终用户与您的微服务交互时，您希望以最小的延迟提供快速响应。为了实现这一点，您需要评估微服务将如何以及何时管理和处理数据。您还需要确定组件应该存储哪些数据，以及它应该如何有效地管理这些数据，以确保这些数据可以随时访问。

您的应用程序可能需要实时(交互式)处理数据，或者按计划在后台执行(批处理)。例如，像优步这样的微服务应用程序必须适应高流量。因此，最好实时处理配置文件设置数据，并在后台了解您的客户(KYC)数据。

## 在哪里托管您的应用程序

彻底的软件架构从一个概念开始，并在那里成长。为什么要花时间去设计优秀的软件，却因为一个不那么优秀的虚拟机或操作系统而让它表现不佳？

考虑功能，而不是整个应用程序。对于持续集成(CI)，您希望您的功能是完全可移动的和自动化友好的。你需要问自己:

*   哪些功能应该放在虚拟机中，哪些应该放在容器中？
*   哪个操作系统是实现这一功能的最佳环境:Windows、Linux、Unix 还是另一个？
*   函数应该使用哪种编程语言和数据库管理器，我们应该在云中还是在企业数据中心执行它？
*   我们的主机系统应该有什么系统架构:x64，x86，大型机，还是别的？

诸如此类。

不要局限于硬件解决方案。虚拟化让您可以用虚拟内存、虚拟机和虚拟桌面基础架构(VDI)等替代产品来替代服务器、内存和网络设备等传统硬件。

与硬件解决方案相比，这些解决方案更易于管理、部署更快，并且通常更具弹性。如果出现问题，它们不太可能出故障，也更容易修复。借助虚拟环境，您可以通过优化数据来降低成本和硬件需求。

这种划分是您可以获得分布式系统最重要的好处之一的地方:您可以为每个组件做最好的事情。

> **提示:**根据每个组件的需求选择托管。

## 性能和维护

当您定义了流程流后，您下一步要考虑的应该是您期望该流程在标准条件下如何执行。是否存在会影响性能的资源或环境限制，如内存和处理能力？如果有，你应该意识到并在设计中明确这些限制。

确保性能和易于维护可能意味着审查您的组件，以进一步划分或合并一些组件。您希望设计能够在标准条件下发挥最佳性能。但是，您不希望它变得如此复杂，以至于危及安全性，并将维护变成一项艰巨的任务。

关键是保持开放的心态，这样你就不会偏向于你的设计或任何特定的解决方案。你的衡量标准应该是效率。如果有更好的方法，那就选择更好的。

> 提示:保持开放的心态，做好适应的准备。

## 可靠性

事实上，服务失败并不是 100%可以避免的。有些故障是由网络中断、系统资源不足或其他与代码无关的原因造成的。

你很难阻止这种类型的失败。有*是*你可以做的事情，以确定当故障出现时你的应用程序如何表现:你需要维护安全性和流畅的用户体验。

最佳实践是设计您的函数，使部分执行的更新完全回滚，以确保数据完整性。在服务失败的情况下，管理系统应该正确地记录报告。您还应该确定受影响的函数在失败后是否应该重新运行，以及它们是否应该重新输入数据。

## 安全性和隐私

正确保护您的分布式系统是您面临的最大挑战之一。采用设计安全方法是非常重要的。除了保护每个功能之外，您还必须保护通信通道，防止对敏感部件的未授权访问。

隐私也不能是事后的想法。仔细考虑您的目标用户所在地理区域的隐私政策和法规。

> **提示:**从一开始就将安全性设计到您的架构中。

## 结论

设计一个分布式系统就像解决一个难题。如果你做得好(尤其是在 DevOps 中)，它会带来长期的好处，但是你必须从设计阶段就把它做好。首先，花足够的时间来评估，然后根据需要重新设计或修改你的设计。

集中式系统仍然有效。从单片架构过渡到微服务架构并不像从模拟过渡到数字。

您的业务需求和应用程序的效用应该驱动您对软件架构模型的选择。然而，随着行业构建更复杂的系统，分布式系统变得更加重要。