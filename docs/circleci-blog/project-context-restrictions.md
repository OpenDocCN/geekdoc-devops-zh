# 使用项目上下文限制与独立项目共享机密| CircleCI

> 原文：<https://circleci.com/blog/project-context-restrictions/>

为 GitLab 组织引入项目上下文限制。此功能支持对不与 VCS 关联的独立项目的上下文**进行基于项目的限制。独立项目目前仅在 [GitLab 与](https://circleci.com/docs/gitlab-integration)circle ci 整合后可用。**在这篇博文中，我们希望解释该功能的价值，以及如何利用它来进一步保护您的工作流程。

## 什么是项目限制？

上下文提供了一种在项目间保护和共享环境变量的机制。默认情况下，CircleCI 上的上下文是不受限制的。你们中的一些人可能已经熟悉了[GitHub 组织以安全组的形式可用的上下文限制](https://circleci.com/docs/contexts/#restricting-a-context)。安全组限制建立在 GitHub 的“团队”之上，允许用户将他们的上下文限制在特定的人群中。

因为安全组限制目前仅适用于 GitHub 组织，所以我们希望为用户提供一种方法来保护其 GitLab 组织内的上下文。项目限制允许用户将上下文及其环境变量限制在一个或多个项目中。这意味着，在运行时，上下文不受限制的项目下的任何工作流都不能访问上下文及其环境变量。如果作业试图使用受限的上下文，它们将会失败，并显示一个`Unauthorized`状态。

## 为什么要使用项目限制？

如果没有限制，默认情况下，存储在上下文中的机密在整个组织范围内共享。项目受限环境允许 CircleCI 用户通过进一步保护其 CI/CD 管道来遵守更高的安全标准。项目限制提供了一种更安全的方式来授予对整个组织的机密的访问权限。他们可以完全由组织管理员管理，组织管理员可以创建、修改和删除项目限制。

对于组限制，需要特权用户来启动管道，以便使用上下文。项目限制通过允许批准的代码运行(基于项目的触发器和配置)改进了组限制，而不管哪个用户实际合并了上游 PR。

通过组织范围的上下文，项目的工作流可以使用上下文，即使它不需要该上下文；JavaScript 库的工作流可以将上下文用于一些不相关的东西，比如 Maven 存储库的凭证。通过项目上下文限制，您可以强制实施哪些项目需要哪些凭据。您的 JavaScript 库只需要带有 [npm 访问令牌](https://docs.npmjs.com/about-access-tokens)的上下文；它不需要 Maven 存储库凭证的上下文。

项目限制也适用于项目角色。任何 Org 贡献者都可以创建项目，这反过来会使他们成为项目管理员。通过添加限制，我们只允许**组织管理员**限制对“已批准”项目的上下文访问。然而，任何被分配了项目管理员角色的人都可以决定项目如何被触发，它使用哪个配置，以及它的作业将如何使用它可以访问的秘密。通过项目限制和角色的组合，用户能够以更精细的方式提高其管道的安全性和配置。

## 如何使用项目限制

您可以从“组织设置”中的“上下文”页面访问项目限制，在该页面中也可以找到环境变量。按照以下步骤设置您自己的项目限制。

您必须是组织管理员才能通过此方法限制上下文。如果您没有管理员权限，则**添加项目限制**按钮将不可用。根据您的角色，您可能能够查看限制列表。

进入 [CircleCI web app](https://app.circleci.com/) 中您所在 GitLab 组织的**组织设置>上下文**页面。上下文列表将可用。

1.  选择现有上下文的名称，或者如果您想使用新的上下文，单击**创建上下文**按钮。
2.  点击**添加项目限制**按钮查看对话框。
3.  选择要添加到上下文中的项目名称，并单击**添加**按钮。现在，上下文的使用仅限于指定的项目。目前，必须单独添加多个项目。
4.  已定义的项目限制列表显示在上下文页面上。
5.  如果您有环境变量，它们也应该出现在页面上。如果没有，您可以点击**添加环境变量**将它们添加到上下文中。然后点击**添加**按钮完成。这些环境变量的使用现在仅限于上面指定的项目。

现在，只有指定项目下的工作流可以使用上下文及其环境变量。关于设置和使用该功能的更详细的操作方法可以在[这里](https://circleci.com/docs/contexts/#project-restrictions)找到。

## 下一步是什么？

除了基于项目的限制，我们希望在未来提供更细粒度的方法来保护上下文。我们正在考虑的这个特性的一些扩展是基于分支和标签的限制。

## 问题和评论

如果您有关于如何改进此功能或其他限制的想法，请访问 Canny 浏览或提交新想法。目前，这仅提供给 GitLab 组织，但如果您对该功能的扩展是否对其他 VCS 组织有用有反馈，我们很乐意听取您的想法。

您也可以查看我们的社区论坛，[讨论](https://discuss.circleci.com/t/self-hosted-runners-on-every-plan-draft/43846/)，让我们知道您是如何使用项目限制的。有关该功能的更多详细信息，请访问[文档](https://circleci.com/docs/contexts/#project-restrictions)。