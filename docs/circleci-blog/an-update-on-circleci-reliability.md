# CircleCI 可靠性的更新

> 原文：<https://circleci.com/blog/an-update-on-circleci-reliability/>

## 可靠性更新 2023-01-30

在过去的四个月中，我一直在向您介绍可靠性更新，与您分享我们的成功和挑战，以及我们在幕后所做的工作，以确保我们的平台随时可以构建。

这个月，我们经历了一次[安全事件](https://circleci.com/blog/jan-4-2023-incident-report/),它破坏了您的许多团队的能力。

所以，尽管可靠性在过去的一个月里有所提高，我还是想长话短说，留给你们两件事:

1.  此时此刻，我们的首要任务是继续关注事件的后果，与我们的客户合作，确保您的管道是安全的，您的秘密是循环的。我们会一直这样做下去，但是一旦我们像往常一样回到工作中，我会带着一个更注重数字的更新回来，给你们带来实质性的指标，你们可以把它作为我们一直在做的工作的指标。
2.  当我思考系统时，可靠性和安全性实际上是一致的:让我们更可靠的东西也让我们更安全。因此，我们为提高可靠性所做的工作(即更干净地隔离系统的各个部分，维护第三方验证的审计点和日志记录)也增强了我们从安全事故中恢复的能力。您的工作需要安全性和可靠性，我们的目标是继续提高拥有高度安全、高度可用的系统的标准。

如果你还没有轮换你的秘密，请[这样做](https://support.circleci.com/hc/en-us/articles/11816211460891)。如果有，谢谢。

下个月我会带着更多的可靠性更新回来。

抢劫

## 可靠性更新 2022-12-21

在最近的几个更新中，我谈到了我们一直在采取的一些行动，以建立我们服务核心的长期可靠性。在这次更新中，我想描述一下我们是如何发现潜在问题的。具体来说，围绕系统问题定位，无论它们是组织的还是架构的。

像许多组织一样，在 CircleCI，我们有一个“您构建它，您运行它”的软件交付方法，这意味着团队对他们自己的交付流的整个生命周期负责。我们还分享了事故调查和跟进的实践。然而，随着团队能够独立管理整个生命周期，我们开始忽略更多的系统问题，认为它们只存在于处理后续工作的单个团队中。

今年早些时候，我们通过汇总所有来源的数据，将注意力转向了这些系统性问题。这包括查看事故后报告、相关历史数据以及各个团队完成的所有后续工作。清点所有数据是重要的，但最突出的是获得进行更改所需的聚合视图需要什么。

我们的大多数工具都是面向单个事件的，而不是总的回顾。即使显示事件数据的工具也没有揭示我们想要的东西。我们查看了从事故响应中花费的时间到原因分类的所有内容，以便我们能够组织自己和我们的系统以获得最大的影响。

虽然我们能够在电子表格中完成大部分汇总工作，但大部分事件后跟进工作都是由叙述驱动的。对这些历史数据进行充分的组织以得出结论是很困难的，但这对于看到更大的图景非常有帮助。通过阅读一份事故报告或与我们的一个团队深入探讨，我们能够看到一些不清楚的事情。

所有这些工作都强调了一种有趣的张力，即保持我们快速发展的、与流一致的 DevOps 文化，同时为我们的团队带来一个消除系统范围挑战的有利位置。这项工作为我们提供了更清晰的见解，我们需要在哪里解决在我们的组织或架构(或两者)中发现的问题。因此，我们正在缓解本质上更系统的问题，并提供防护栏，以便我们的团队仍然可以快速移动并拥有他们所构建的东西。有了这个总体视图，我们在发现和解决故障点方面取得了进展。

为了更好的建筑，

罗伯·朱伯

罗布@ circles . com

## 可靠性更新 2022-10-27

上个月，我向你承诺，我会给你带来我们可靠性工作的每月更新:进展如何，什么在起作用，我们还有哪些工作要做。

我想通过这些更新实现三个目标:

1.  加强我们对可靠性的承诺，
2.  分享更多我们的可靠性路线图，以便您对我们在这项工作上分享的任何未来更新有更广泛的了解
3.  公开我们的工作和见解，这样社区也可以从我们的经历中受益。

在软件社区中，当服务中断时，我们都会受到影响，但是我们通过分享我们的经验而共同进步。

上个月(向下滚动查看完整更新)，我分享了我们一直致力于隔离平台的各个部分，以保护客户的构建并保持它们运行。

今天，我想分享更多关于我们当前方法的细节:系统隔离，以便无论如何保护你的构建。我想强调的是，这不仅仅是我们做的和报告的事情，而是保护构建的原则将指导我们完成即将到来的可靠性投资，以及平台上所有新的开发工作。

像所有平台一样，我们是通过进化来到这里的，所以让我带你看一段 CircleCI 平台的(简略)历史。

像许多其他公司一样，我们从一个整体开始。默认情况下，在 monolith 中你所有的工作都是混合在一起的。这必然会产生耦合，并导致级联故障的可能性。如果没有分离，代码库中某个地方的失败会导致其他地方的失败。

当我们分解这个整体时，我们是基于工作阶段，或者在不同的点上发生了什么(比如工作流编排和作业执行)。这种方法简化了我们的代码库，使交付更加容易，但是在这些阶段中，我们结合了活动的工作和工作的历史报告。

我们现在正在做的工作是在这些阶段中的每一个阶段进行隔离，这样运行活动构建的每个组件都可以免受其他任何东西的影响。

我们正在逐步开展这项工作，以确保快速取得成果，同时最大限度地减少中断。第一阶段涉及简单的工具，比如在需要时禁用历史查看的功能。这就产生了一个释放阀。

我们还增加了只读副本在历史查询中的使用。我们正在利用这些服务的分离部署来隔离计算资源，即使代码是共享的。

我们正在进入的下一个阶段包括完全分离系统。换句话说，实时构建的代码路径和数据与历史构建的代码路径和数据不同。虽然副本有助于分配负载，但它们要求所有存储具有相同的数据量。这可以通过分片来解决，但是即使这样，您仍然会被试图支持两种访问模式的模式设计所困扰。当它们完全分离时，我们可以优化每个设计，包括规模和产品功能。我们在这方面还处于起步阶段，但我们再次采取渐进措施，开始尽快实现收益。

这给我们带来了一个很好的问题:为什么我们一开始没有这样做？这是规模的需要，一开始就这么做是错误的。为什么？当你第一次创建一个像我们这样的平台，并做出早期的架构决策时，我相信做出让你能够快速转向并响应早期客户需求的决策是非常重要的。你不知道他们想要什么，因此你也不知道你的团队会继续构建什么样的功能来支持和取悦这些客户。在开始的时候，可以想象我们最终会面对这样一个项目，但是我不认为我们能够知道我们会达到一系列的临界点中的哪一个。

总之，我希望你从这次更新中得到的是，我们正在认真对待这件事，并以我们对待所有工作的方式来对待它:循序渐进，将你的需求作为我们决策的核心。虽然我们不希望系统崩溃，但它还是发生了。更好的隔离意味着我们可以朝着真正的目标前进:确保你的构建每天都在运行，不管我们的平台或者更大的生态系统中发生了什么。

如果你对我们在这个旅程中的渐进步骤感兴趣，请回来查看每月更新。如果不是，那也没关系；回去做支持和取悦你的顾客的事情，但是我们想让你知道 CircleCI 幕后发生了什么。

为了更好的建筑，

罗伯·朱伯

罗布@ circles . com

## 可靠性更新 2022-09-19

上周，管道页面在一天中的大部分时间都不可用。这阻碍了许多团队按照预期管理他们的工作。作为一名工程师和一名领导者，我知道保持心流，并在需要时随时准备好工具是多么重要。我们很抱歉给你的团队工作带来的干扰。

正如我在四月份所说的(全文如下)，**作为首席技术官，我的首要任务是减少 CircleCI 事故的持续时间和影响。**

但当事情看起来像上周那样时，我们取得的进展可能并不明显。

除了从我们的原始帖子开始关注诊断速度之外，我们已经开始投资保护您完成工作的能力(即，运行管道)，即使在出现问题时。虽然我们的工作仍在进行中，但我们已经取得了一些重要成果。但是如果你到目前为止还看不到或感觉不到这项工作的影响，那么我们就没有成功。不是作为一个技术团队，也不是为了建立我们希望与您建立的信任关系。

一个值得注意的收获是团队已经开始分离我们架构的部分。这使我们能够限制事故影响，并在事情发生意外时保护您的管道。它允许我们做一些事情，比如暂时关闭一些用户界面，以确保管道仍然可以运行，这就是我们上周所做的。但是我们没有告诉你。相反，您看到站点关闭了，并合理地假设什么都没有改变。

再说一遍，我们在这方面还有更多工作要做，我们仍然对此投入很大。我们不能阻止事情的发展，但是我们可以继续寻找新的方法来确保您的构建可以一直运行，并且为您提供更好、更及时的关于如何完成工作的信息，即使 A 计划失败了。

此外，距离我们上次的可靠性更新已经过去了 5 个月，我们可以做得更好。展望未来，我承诺每月向您更新我们新的可靠性开发。同时，我欢迎您的反馈。

## 可靠性更新 2022-04-13

在 CircleCI，我们的使命是管理变化，以便软件团队能够更快地创新。但是最近，我们知道我们的可靠性没有达到客户的期望。作为客户运输管道的核心，我们知道当我们停机时，您的运输能力也会停止。我们对您的工作中断感到抱歉，并对给您和您的团队带来的不便表示歉意。

## 发生了什么事

我们平台或基础架构的任何一个部分都不会因为最近的中断而出现问题。相反，我们已经看到了各种各样的问题，从导致 bug 的更新到依赖性问题，以及上游提供者的不稳定性。我们的定价计划的[1 月更新为我们的平台带来了更高的流量和使用率。虽然我们为此进行了规划和建模，但它促使我们在一些系统中达到了拐点。](https://circleci.com/blog/most-generous-free-cicd-plan/)

虽然最近事件的原因没有明确的模式，但我们知道我们解决问题的总时间太长了。深入我们的事件响应协议有助于我们发现我们的团队在压力下的执行力对我们没有帮助的地方。我们完全接受无可指责的工程文化和 DevOps 原则“你构建它，你运行它”，但是我们的系统和我们的团队的分布式本质使得这种联系、交流和解决变得困难。

为什么？在过去的 12 个月里，我们的工程团队几乎增加了一倍。这种增长是有意的，并提供了一些令人难以置信的速度-仅在上周，我们就部署了 850 多次。但这种增长也意味着我们的直觉知识基础变得不那么重要和有凝聚力。我们需要在我们所有的团队中重建广泛和深入的系统理解。

## 我们正在做什么来前进

对我们来说，技术与人息息相关，提高我们的可靠性需要以人为本的方法。从上周开始，我们建立了一个老虎小组，包括我自己在内的第一反应人员随叫随到，随叫随到。这是一个由个人组成的全球团队，能够通过流程和技术快速解决问题并实现长期变革。我们的目标是加强工程师的影响力，他们可以推动事件从识别到解决，然后帮助与更大的团队分享见解。

过去，我们将可靠性工作的重点放在系统“热点”上，这些“热点”是停机时间的已知来源，包括车队管理和机器供应。我们在那里进行了深度投资，并取得了回报。但是随着我们组织的成长，我们的问题不再是服务级别的中断，而是大型分布式系统的复杂交互。我们 tiger 团队的目标是让您尽快恢复工作，然后利用我们学到的知识解决这些事件的根本原因。

我们还对我们的平台进行投资，着眼于未来进行构建和重建。我们最近聘请了一位新的首席架构师来领导我们在平台可扩展性和构建长期产品创新方面的工作。

## 你如何知道我们正在取得进展

虽然这是不明智的(而且难以置信！)为了保证我们永远不会再发生事故，我们*可以*承诺减轻客户的负担。

随着我们继续投资于我们的长期平台稳定性，我们的短期重点是减少事件长度。对于客户影响超过一小时的事件，我们承诺在 status.circleci.com 上发布事件报告。

作为首席技术官，提高事件响应能力是我的首要任务。我们知道我们在这方面还有工作要做，我们相信我们现有的计划和团队将帮助我们立即做出改进。感谢我们的客户和社区一直以来的支持和耐心。