# 如何使用工件获得构建和测试结果

> 原文：<https://circleci.com/blog/piecing-together-build-and-test-results-with-artifacts/>

想象一下:你在一个偏远的沙漠地区，那里发现了一个历史性的考古定居点。通过最初的调查，这一群人似乎没有幸存下来的好运气。这就是你在那里的原因。你在寻找线索，看看你是否能拼凑出一幅准确的图像，来解释为什么他们的运气用完了。

通过你的搜索和搜索，你没有发现多少有用的东西，突然-砰！你发现了一个似乎是解释这里发生的事情的关键的物体。你找到的这件艺术品正是你所需要的，它能告诉你并帮助你理解发生了什么。

想象一下，对于您的测试运行、构建等等，有这些类型的关键线索！CircleCI 已经涵盖了你，虽然因为我们不能给系统像陶器的沙片，剑，或银猴之类的人工制品，让我们来看看我们可以*创造*什么，以及我们可以使用这些物品的一些方法。

## 让我们回顾一下什么是人工制品

神器到底是什么？摘自文档中的[，“工件在一项工作完成后保存数据，并可用于长期存储您的构建过程的输出。”如果这对你来说仍然模糊不清，让我们来分解它。](https://circleci.com/docs/artifacts/)

在整个工作流程中，每个作业都有自己的数据和文件，每次运行后都会被擦除。为了跨作业传送数据，可以将数据保存到工作区，工作区是特定于每个工作流的临时数据存储区。与作业一样，工作流完成后，工作空间数据也将消失。怎么回事？我们如何在工作流之后保留可能对我们有用的项目？

我们将这些物品作为艺术品保存。如下图所示，您有了一个额外的步骤来将文件移动到存储，即使在您的工作流完成后，这些文件也不会丢失。

![](img/4a2dc594d0816beade606f2cf7b661e5.png)

## 我们如何使用工件，它们在哪里配置？

为了让工件有用，它们需要是可访问的。简单地把它们埋在土里，然后希望一千年后有人会碰巧发现它们，这并没有多大帮助。幸运的是，存储工件文件是一个非常简单的过程，它发生在 config.yml 文件中，通过恰当命名的内置步骤:`store_artifacts`。假设你有一个在测试你的网站的视觉回归时拍摄的截图目录，假设这些截图存储在`/tmp/screenshots`。

将它们保存为配置中的工件的最简单方法如下所示:

```
- store_artifacts:
    path: /tmp/screenshots 
```

这是它在完整配置中的样子:

```
version: 2
jobs:        
    build_and_save: 
        docker:
        - image: circleci/golang:latest
        steps:
            - checkout
            - run: make build
            - store_artifacts:
                path: /bin/final_build
workflows:
    version: 2
    main:
        jobs:
            - build_and_save 
```

就是这样！真的就这么简单。🎉

如果您想指定一个在通过工件 API 访问工件时使用的前缀，您可以通过添加如下代码行来指定:

```
- store_artifacts:
    path: /tmp/screenshots
    destination: screenshot 
```

关于通过 API 下载工件的更多信息可以在文档中找到。

## 有哪些真实世界的人工制品的例子？

我们现在知道如何保存和访问我们的工件，我们甚至想保存什么？以下是一些可以保存下来长期使用的物品的简单列表:

*   测试步骤或失败的截图
*   试验结果
*   APKs 二进制文件
*   压力测试的性能输出
*   日志文件
*   核心转储
*   覆盖率文件

基于什么对你的需求有意义，你可以保存这些项目中的一些或者一个都不保存，这完全没问题。CircleCI 不在乎，重要的是什么对你的需求最有用、最有帮助。(如果你保存了上面没有列出的神器，请留下评论，让我们知道是什么！)

保存文件固然很好，但如果不使用它们又有什么用呢？说得好！

*   如果你有正在保存的截图，在一次失败的运行后，你可以在一个作业的工件选项卡中调出截图，并查看在可视化回归中到底有什么不同，或者当 Selenium 找不到一个按钮时你的站点在哪里。如果您想更进一步，您甚至可以设置一个与您最喜欢的消息平台的集成，并使用完全相同的屏幕截图发送失败消息，从而节省您的时间！
*   如果你正在创建应用程序，你可以保存一个版本的 Android 代码，然后再分发。
*   如果您的日志文件输出非常大，并且您希望某些软件可以访问它们进行解析，您也可以这样做。

## 最后

天空是你选择使用神器的极限。它们是一个易于学习和实施的简单概念，但是它们的威力在于使您和您的团队能够以更深层次的方式进一步微调和补充您的 CI/CD 流程，而不仅仅是通过/失败。

感谢阅读！

* * *

Gemini Smith 是一名不断学习的软件工程师，对测试、交流和改进软件开发生命周期充满热情。主要用 Go 写作，她还通过公开演讲、宣传、咨询和指导对软件和测试社区做出贡献。

[阅读更多 Gemini Smith 的文章](/blog/author/gemini-smith/)