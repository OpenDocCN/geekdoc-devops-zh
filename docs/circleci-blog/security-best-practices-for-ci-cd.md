# CI/CD - CircleCI 的安全最佳实践

> 原文：<https://circleci.com/blog/security-best-practices-for-ci-cd/>

欢迎使用 DevSecOps 和 CI/CD 安全指南。浏览每个部分，找到各种相关资源，以确保您的应用程序和基础架构的安全性。

## 什么是 DevSecOps？

DevSecOps 是从构思到部署安全开发应用程序和基础设施的理念。它要求在开发生命周期的所有阶段考虑安全风险。虽然 DevOps 团队过去一直专注于自动化他们的应用程序的构建、测试和部署，但 DevSecOps 包括自动化安全实践，以允许团队在不损失速度的情况下提高安全性。

## 使用 DevSecOps 保护 CI/CD 管道

[安全的 CI/CD 管道](https://circleci.com/blog/secure-ci-pipeline/)是许多企业日常运营的一部分。这些过程，当设置正确时，通过自动化许多手工任务和显示软件是如何工作的，保持交付过程的一致性。

CI/CD 还是您的基础设施访问许多不同资源的技术堆栈，从开发和生产环境到分析密钥和代码签名凭证。管道可以访问的资源越多(安全机密、专有代码和数据库)，保证 CI/CD 系统的安全就越重要。

在本文中，我们将讨论 CI/CD 管道安全性的不同部分，并重点介绍一些改进这些方面的方法。

## CI/CD 的三种安全最佳实践

我们通常将安全实践分为三个部分，您可以使用不同种类的解决方案来解决。这些是:

1.  安全管道配置
2.  代码和 Git 历史分析
3.  安全策略实施

这三个方面同等重要。让我们更深入地了解一下这些类别以及解决它们的方法。

## 安全管道配置

可以使用您的 CI/CD 管道配置来降低发生安全问题的可能性。

首先，将秘密安全地存储在连接到数据库和第三方服务的管道中。在 CircleCI 上，您可以使用静态加密[环境变量](https://circleci.com/docs/env-vars/)，或者[上下文](https://circleci.com/docs/contexts/)特性。上下文提供了对跨项目的环境变量的访问。它们的使用也可以由组织的管理员限定为特定的安全组成员。

另一种选择是使用第三方解决方案，为您的工作从他们的安全存储中动态获取机密。为了确保您的凭证不会暴露给不应该看到它们的人，请不要以纯文本的形式将这些凭证签入到您的存储库中，即使存储库是私有的。

其次，对于像代码签名密钥这样的敏感文件，我们建议在加密文件和存储库之间增加一个额外的隔离层。这里看一个例子[。在存储库中对它们进行加密，并将解密密钥存储在环境变量或上下文中。仅在需要时，在 CI/CD 作业中解密它们。这使得暴露或泄露这些高度敏感的文件变得更加困难。](https://circleci.com/docs/ios-codesigning/)

第三，不要让您的 CI/CD 环境在没有监控的情况下运行。确保在需要敏感信息的作业完成后，销毁用于管道的容器和虚拟机。在 CircleCI 上，这在所有支持的平台上自动发生，包括 Docker 和 Machine 上的 Linux、macOS 和 [Windows](https://discuss.circleci.com/t/windows-early-access-now-available-on-circleci/30977) 。

第四，额外注意 CI/CD 系统如何处理来自存储库分叉的 pull 请求的构建。如果您的构建阶段需要秘密来工作，分叉的拉请求可能会通过您的管道获得对它们的访问。在 CircleCI 上，默认行为是从不将秘密传递给分叉的 pull 请求。

通过解决这四个方面的问题，您可以显著降低 CI/CD 管道配置带来的安全事故风险。接下来，代码和 Git 历史分析。

## 代码和 Git 历史分析

我们都喜欢 Git 全面的变更历史，能够用一个简单的 CLI 命令查看项目的历史，并看到谁最近更改了一行代码，还有其他好处。这也意味着，如果 Git 存储库被暴露，任何进入 Git 历史的敏感信息都可能被攻击者访问，即使存储库的最新状态不再包含机密。

松露猪和 [GitLeaks](https://github.com/zricethezav/gitleaks) 是帮助你识别已经提交给代码库的秘密的工具，这样你就可以停用和替换它们。这些工具扫描您的 Git 历史，寻找您的团队过去可能已经添加到存储库中的秘密的痕迹。

一旦您的 Git 历史没有秘密，您就可以进入下一个层次:确保您当前的修订版不包含任何易受攻击的依赖项。

**静态应用安全测试(SAST)** 技术可以检查您提交的应用并分析其依赖性。如果依赖项包含任何问题或已知的安全漏洞，您的提交将被标记为不安全，不会继续部署。

**动态应用程序安全测试(DAST)** 技术更进了一步，在您的 CI 作业中旋转生产环境的副本，以便您可以扫描容器和可执行文件。例如，动态方面帮助系统捕捉在启动时加载的依赖项，因为 SAST 不会捕捉这些依赖项。

## 安全策略实施

一些安全方面不能基于已知的漏洞进行静态检查，而是特定于您的特定公司。这些需要被编码为策略，可以是自动或手动的合规性检查。

某些任务，如审查有权访问您的存储库的所有帐户的列表，或确保您的入职和离职流程同步，将是手动的。我们建议您设置提醒来定期执行这些操作。

有些任务实际上可以很容易地自动化。例如，第三方服务可以提供一种便捷的方式来编纂一组规则，以匹配您的 CI 渠道。这些服务可以帮助您证明符合管理数据的法规。如果不匹配，构建将会失败。

## 用 CircleCI orbs 保护您的 CI/CD 管道

CircleCI orbs 是 CircleCI 配置的可共享包，可以在您的构建中使用。orb 定义了可重用的命令、执行器和作业，因此常用的配置可以压缩到一行代码中。orb 是 CircleCI config 的可重用、可共享的开源包，支持这些服务的即时集成。借助 orbs，您可以获得一个保护管道的开箱即用的解决方案。

寻找 orb 专用资源？查看以下博客帖子:

### CircleCI 上的私人球体

虽然到目前为止，成千上万的开发人员已经享受了我们开源 orb 的体验，但是我们在大型组织中的许多客户需要一种方法来使他们的 orb 实例私有。所有 CircleCI 计划都提供私人球体,为开发人员提供更多隐私、效率和跨团队协作。这对于在医疗保健、金融和其他具有高治理和法规遵从性标准的行业中工作的团队尤其有用。

要了解更多关于私有 orbs 如何提高隐私、效率和组织内部共享的信息，请阅读我们关于如何[在任何组织上构建私有 CircleCI orbs 的教程](https://circleci.com/blog/building-private-orbs/)或阅读我们的 [orbs 文档](https://circleci.com/docs/orb-concepts/#private-orbs)。

## 了解如何使用 CAS 的 7 个概念编写安全代码

[持续应用安全](https://circleci.com/blog/ci-cd-meet-cas-continuous-application-security/) (CAS)是一种帮助开发人员可靠地构建和运行安全应用和 API 的方法。CAS 将基于纸面的安全策略和指导转变为“安全即代码”。

通过基于工具的安全实施，CAS 使开发、安全和运营团队能够以现代软件开发的速度协同工作。在此了解如何使用 CAS [的概念。](https://circleci.com/blog/ci-cd-meet-cas-continuous-application-security/)

## 采用 DevSecOps 方法

您的团队是您最有价值的安全研究人员。他们最了解您的应用程序，并会不断改进它们。以下是支持他们的方法:

*   为您的团队成员实施清晰的安全问题报告流程
*   花时间修复已发现的安全缺陷
*   赞美那些公开报告问题的人。

想一想你团队中的某个人报告可疑活动需要多长时间。他们是否需要在多个闲置渠道发布帖子来吸引注意力，或者是否有一个简化的流程来调查这样的问题？你如何对待那些报告误报的人——你会责怪他们浪费团队的时间，还是会进行一次无可指责的事后分析，以便团队中的每个人都能从错误中吸取教训？所有这些问题都可能成就或破坏您注重安全性的开发文化。

查看将 DevOps 转变为 DevSecOps 的三条规则。

在本文中，我们介绍了实现 CI/CD 管道安全的标准安全措施的多种方法。如何使用 CI/CD 管道来发现和修补安全漏洞？在[漏洞管理中了解更多信息，并使用 CI/CD](https://circleci.com/resources/devsecops-ebook/) 进行开发。