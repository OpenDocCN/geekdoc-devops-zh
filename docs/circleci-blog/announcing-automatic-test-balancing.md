# 宣布自动测试平衡- CircleCI

> 原文：<https://circleci.com/blog/announcing-automatic-test-balancing/>

**来自出版商的说明:**您已经找到了我们的一些旧内容，这些内容可能已经过时和/或不正确。尝试在[我们的文档](https://circleci.com/docs/)或[博客](https://circleci.com/blog/)中搜索最新信息。

* * *

![Kegoneko-Balance](img/cb3e7b1960f91b62dfcbe89bded3884a.png)

TL；DR:circle ci 不再天真地在构建容器之间划分测试，而是基于执行时间智能地划分测试。

## CircleCI 的现状

多年来，CircleCI 通过在许多构建容器(引擎盖下的 LXC 容器——与 Docker 使用的轻量级容器化相同)中平均分配测试，实现了大型测试套件的快速执行。虽然我们总是提供通过[手动指定每个容器](https://circleci.com/docs/1.0/parallel-manual-setup/)上应该发生什么来设置并行动作的选项，但是使用 CircleCI 并行性的最简单方法是允许我们自动推断的测试步骤并行运行您的测试。测试分布在不同的容器中，以便在每个容器上运行相同数量的测试，所有这些都不需要使用流行的框架和语言对标准项目设置进行任何配置。

## 新的热点

现在，我们的自动并行性更进了一步，根据过去的执行时间，而不仅仅是测试数量，自动将测试划分到不同的容器中，让您的测试套件运行得更快。例如，如果您有 90 个浏览器测试，每个花费 10 秒钟，100 个单元测试，每个花费 1 秒钟，都由 RSpec 运行，那么使用 10X 并行度，CircleCI 将跨 9 个容器运行浏览器测试，并在 1 个容器上运行所有单元测试(或者平均分布它们)，以便每个容器花费相同的时间运行测试。所有这些都是自动发生的，不需要任何额外的设置，并且您的测试将会不断地重新平衡，以尽可能快地运行您的测试套件。

## 如何打开它

以下测试运行程序当前支持自动测试平衡:

*   RSpec

*   迷你测试

*   鼻子

*   黄瓜

只要您的测试使用 CircleCI 推断的命令运行，就不需要额外的配置，尽管 RSpec 和 minitest 确实要求您在项目的依赖项中简单地包含一个特殊的测试格式化程序 gem。详见[本文档](https://circleci.com/docs/1.0/test-metadata/)。

## 它是如何工作的

在引擎盖下，新的自动测试平衡使用相同的 JUnit 格式的测试输出，支持我们的[详细测试失败报告](/blog/announcing-detailed-test-failure-reporting/)。CircleCI 解析并存储每次测试的计时数据。然后，该信息被用于执行跨构建容器的时间加权测试分布，然后通过将命令行标志传递给每个测试运行程序来应用该分布。

## 后续步骤

我们将很快增加对更多测试跑步者的支持——如果您想请求对某个特定跑步者的支持，请给我们发短信到[sayhi@circleci.com](mailto:sayhi@circleci.com)!我们还将致力于将一个接口暴露给先前的测试计时数据，以便同样的自动平衡可以被定制为与不太常见的测试套件一起工作。测试愉快！